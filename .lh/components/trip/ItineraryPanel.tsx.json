{
    "sourceFile": "components/trip/ItineraryPanel.tsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 125,
            "patches": [
                {
                    "date": 1752433683232,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1752440388566,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2,8 +2,27 @@\n \r\n import { useState } from 'react';\r\n import { Trip, Destination, TripDay } from '@/types';\r\n import { format, parseISO } from 'date-fns';\r\n+import {\r\n+  DndContext,\r\n+  closestCenter,\r\n+  KeyboardSensor,\r\n+  PointerSensor,\r\n+  useSensor,\r\n+  useSensors,\r\n+  DragEndEvent,\r\n+} from '@dnd-kit/core';\r\n+import {\r\n+  SortableContext,\r\n+  sortableKeyboardCoordinates,\r\n+  verticalListSortingStrategy,\r\n+  useSortable,\r\n+} from '@dnd-kit/sortable';\r\n+import {\r\n+  CSS,\r\n+} from '@dnd-kit/utilities';\r\n+import { reorderDestinations } from '@/lib/destination-service';\r\n \r\n interface ItineraryPanelProps {\r\n   trip: Trip;\r\n   tripDays: TripDay[];\r\n@@ -13,8 +32,124 @@\n   onDestinationSelect: (destination: Destination) => void;\r\n   onDestinationsChange: (destinations: Destination[]) => void;\r\n }\r\n \r\n+// Sortable destination item component\r\n+function SortableDestination({ \r\n+  destination, \r\n+  dayColor, \r\n+  selectedDestination,\r\n+  onDestinationSelect,\r\n+  isLastItem \r\n+}: {\r\n+  destination: Destination;\r\n+  dayColor: any;\r\n+  selectedDestination: Destination | null;\r\n+  onDestinationSelect: (destination: Destination) => void;\r\n+  isLastItem: boolean;\r\n+}) {\r\n+  const {\r\n+    attributes,\r\n+    listeners,\r\n+    setNodeRef,\r\n+    transform,\r\n+    transition,\r\n+    isDragging,\r\n+  } = useSortable({ id: destination.id });\r\n+\r\n+  const style = {\r\n+    transform: CSS.Transform.toString(transform),\r\n+    transition,\r\n+  };\r\n+\r\n+  const formatTime = (time: string) => {\r\n+    if (!time) return '';\r\n+    try {\r\n+      const [hours, minutes] = time.split(':');\r\n+      const date = new Date();\r\n+      date.setHours(parseInt(hours), parseInt(minutes));\r\n+      return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });\r\n+    } catch {\r\n+      return time;\r\n+    }\r\n+  };\r\n+\r\n+  return (\r\n+    <div ref={setNodeRef} style={style} className={isDragging ? 'opacity-50' : ''}>\r\n+      <button\r\n+        onClick={() => onDestinationSelect(destination)}\r\n+        className={`w-full p-4 text-left hover:bg-gray-100 transition-colors ${\r\n+          selectedDestination?.id === destination.id ? 'bg-blue-100' : ''\r\n+        }`}\r\n+      >\r\n+        <div className=\"flex items-start space-x-3\">\r\n+          {/* Drag Handle */}\r\n+          <div \r\n+            {...attributes}\r\n+            {...listeners}\r\n+            className=\"flex-shrink-0 mt-1 cursor-grab active:cursor-grabbing\"\r\n+          >\r\n+            <svg className=\"w-4 h-4 text-gray-400 hover:text-gray-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n+              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 8h16M4 16h16\" />\r\n+            </svg>\r\n+          </div>\r\n+\r\n+          {/* Pin Number */}\r\n+          <div \r\n+            className=\"w-6 h-6 rounded-full flex items-center justify-center text-white text-xs font-medium flex-shrink-0 mt-0.5\"\r\n+            style={{ backgroundColor: dayColor.pin }}\r\n+          >\r\n+            {destination.orderIndex}\r\n+          </div>\r\n+          \r\n+          <div className=\"flex-1 min-w-0\">\r\n+            <div className=\"flex items-center justify-between\">\r\n+              <h4 className=\"font-medium text-gray-900 truncate\">\r\n+                {destination.locationName}\r\n+              </h4>\r\n+              {destination.startTime && (\r\n+                <span className=\"text-sm text-gray-500 flex-shrink-0 ml-2\">\r\n+                  {formatTime(destination.startTime)}\r\n+                </span>\r\n+              )}\r\n+            </div>\r\n+            <p className=\"text-sm text-gray-600 truncate\">\r\n+              {destination.address}\r\n+            </p>\r\n+            {destination.notes && (\r\n+              <p className=\"text-sm text-gray-500 mt-1 line-clamp-2\">\r\n+                {destination.notes}\r\n+              </p>\r\n+            )}\r\n+            <div className=\"flex items-center space-x-4 mt-2\">\r\n+              {destination.category && (\r\n+                <span className=\"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-700\">\r\n+                  {destination.category}\r\n+                </span>\r\n+              )}\r\n+              {destination.rating && (\r\n+                <div className=\"flex items-center space-x-1\">\r\n+                  <svg className=\"w-4 h-4 text-yellow-400\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n+                    <path d=\"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z\" />\r\n+                  </svg>\r\n+                  <span className=\"text-sm text-gray-600\">{destination.rating}</span>\r\n+                </div>\r\n+              )}\r\n+            </div>\r\n+          </div>\r\n+        </div>\r\n+      </button>\r\n+      \r\n+      {/* Connector line */}\r\n+      {!isLastItem && (\r\n+        <div className=\"flex justify-start ml-11\">\r\n+          <div className=\"w-0.5 h-4 bg-gray-300\"></div>\r\n+        </div>\r\n+      )}\r\n+    </div>\r\n+  );\r\n+}\r\n+\r\n export default function ItineraryPanel({\r\n   trip,\r\n   tripDays,\r\n   selectedDay,\r\n@@ -23,9 +158,21 @@\n   onDestinationSelect,\r\n   onDestinationsChange,\r\n }: ItineraryPanelProps) {\r\n   const [expandedDays, setExpandedDays] = useState<Set<number>>(new Set([1]));\r\n+  const [isReordering, setIsReordering] = useState(false);\r\n \r\n+  const sensors = useSensors(\r\n+    useSensor(PointerSensor, {\r\n+      activationConstraint: {\r\n+        distance: 8,\r\n+      },\r\n+    }),\r\n+    useSensor(KeyboardSensor, {\r\n+      coordinateGetter: sortableKeyboardCoordinates,\r\n+    })\r\n+  );\r\n+\r\n   const toggleDay = (day: number) => {\r\n     const newExpanded = new Set(expandedDays);\r\n     if (newExpanded.has(day)) {\r\n       newExpanded.delete(day);\r\n@@ -35,28 +182,92 @@\n     setExpandedDays(newExpanded);\r\n     onDaySelect(day);\r\n   };\r\n \r\n-  const formatTime = (time: string) => {\r\n-    if (!time) return '';\r\n+  const handleDragEnd = async (event: DragEndEvent) => {\r\n+    const { active, over } = event;\r\n+    \r\n+    if (!over || active.id === over.id) {\r\n+      return;\r\n+    }\r\n+\r\n+    // Find the day that contains the dragged item\r\n+    const draggedDestination = tripDays\r\n+      .flatMap(day => day.destinations)\r\n+      .find(dest => dest.id === active.id);\r\n+    \r\n+    if (!draggedDestination) return;\r\n+\r\n+    const day = tripDays.find(d => d.day === draggedDestination.day);\r\n+    if (!day) return;\r\n+\r\n+    const oldIndex = day.destinations.findIndex(dest => dest.id === active.id);\r\n+    const newIndex = day.destinations.findIndex(dest => dest.id === over.id);\r\n+\r\n+    if (oldIndex === newIndex) return;\r\n+\r\n+    setIsReordering(true);\r\n+\r\n     try {\r\n-      const [hours, minutes] = time.split(':');\r\n-      const date = new Date();\r\n-      date.setHours(parseInt(hours), parseInt(minutes));\r\n-      return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });\r\n-    } catch {\r\n-      return time;\r\n+      // Create new order array\r\n+      const newDestinations = [...day.destinations];\r\n+      const [movedItem] = newDestinations.splice(oldIndex, 1);\r\n+      newDestinations.splice(newIndex, 0, movedItem);\r\n+\r\n+      // Update order indices\r\n+      const reorderedDestinations = newDestinations.map((dest, index) => ({\r\n+        ...dest,\r\n+        orderIndex: index + 1\r\n+      }));\r\n+\r\n+      // Update local state immediately for better UX\r\n+      const updatedTripDays = tripDays.map(tripDay => {\r\n+        if (tripDay.day === day.day) {\r\n+          return {\r\n+            ...tripDay,\r\n+            destinations: reorderedDestinations\r\n+          };\r\n+        }\r\n+        return tripDay;\r\n+      });\r\n+\r\n+      // Update destinations in parent component\r\n+      const allDestinations = updatedTripDays.flatMap(d => d.destinations);\r\n+      onDestinationsChange(allDestinations);\r\n+\r\n+      // Save to database\r\n+      const destinationIds = reorderedDestinations.map(dest => dest.id);\r\n+      await reorderDestinations(trip.id, day.day, destinationIds);\r\n+\r\n+    } catch (error) {\r\n+      console.error('Error reordering destinations:', error);\r\n+      // Optionally show error message to user\r\n+    } finally {\r\n+      setIsReordering(false);\r\n     }\r\n   };\r\n \r\n   return (\r\n     <div className=\"h-full flex flex-col\">\r\n       {/* Header */}\r\n       <div className=\"p-4 border-b border-gray-200\">\r\n-        <h2 className=\"text-lg font-semibold text-gray-900\">Itinerary</h2>\r\n-        <p className=\"text-sm text-gray-600\">\r\n-          {tripDays.length} days • {tripDays.reduce((acc, day) => acc + day.destinations.length, 0)} destinations\r\n-        </p>\r\n+        <div className=\"flex items-center justify-between\">\r\n+          <div>\r\n+            <h2 className=\"text-lg font-semibold text-gray-900\">Itinerary</h2>\r\n+            <p className=\"text-sm text-gray-600\">\r\n+              {tripDays.length} days • {tripDays.reduce((acc, day) => acc + day.destinations.length, 0)} destinations\r\n+            </p>\r\n+          </div>\r\n+          {isReordering && (\r\n+            <div className=\"flex items-center text-sm text-gray-500\">\r\n+              <svg className=\"animate-spin -ml-1 mr-2 h-4 w-4\" fill=\"none\" viewBox=\"0 0 24 24\">\r\n+                <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle>\r\n+                <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\r\n+              </svg>\r\n+              Updating...\r\n+            </div>\r\n+          )}\r\n+        </div>\r\n       </div>\r\n \r\n       {/* Days List */}\r\n       <div className=\"flex-1 overflow-y-auto\">\r\n@@ -116,71 +327,31 @@\n                     <p className=\"text-sm\">No destinations added yet</p>\r\n                     <p className=\"text-xs text-gray-400 mt-1\">Click on the map to add destinations</p>\r\n                   </div>\r\n                 ) : (\r\n-                  <div className=\"space-y-0\">\r\n-                    {day.destinations.map((destination, index) => (\r\n-                      <div key={destination.id || index}>\r\n-                        <button\r\n-                          onClick={() => onDestinationSelect(destination)}\r\n-                          className={`w-full p-4 text-left hover:bg-gray-100 transition-colors ${\r\n-                            selectedDestination?.id === destination.id ? 'bg-blue-100' : ''\r\n-                          }`}\r\n-                        >\r\n-                          <div className=\"flex items-start space-x-3\">\r\n-                            <div \r\n-                              className=\"w-6 h-6 rounded-full flex items-center justify-center text-white text-xs font-medium flex-shrink-0 mt-0.5\"\r\n-                              style={{ backgroundColor: day.color.pin }}\r\n-                            >\r\n-                              {destination.orderIndex}\r\n-                            </div>\r\n-                            <div className=\"flex-1 min-w-0\">\r\n-                              <div className=\"flex items-center justify-between\">\r\n-                                <h4 className=\"font-medium text-gray-900 truncate\">\r\n-                                  {destination.locationName}\r\n-                                </h4>\r\n-                                {destination.startTime && (\r\n-                                  <span className=\"text-sm text-gray-500 flex-shrink-0 ml-2\">\r\n-                                    {formatTime(destination.startTime)}\r\n-                                  </span>\r\n-                                )}\r\n-                              </div>\r\n-                              <p className=\"text-sm text-gray-600 truncate\">\r\n-                                {destination.address}\r\n-                              </p>\r\n-                              {destination.notes && (\r\n-                                <p className=\"text-sm text-gray-500 mt-1 line-clamp-2\">\r\n-                                  {destination.notes}\r\n-                                </p>\r\n-                              )}\r\n-                              <div className=\"flex items-center space-x-4 mt-2\">\r\n-                                {destination.category && (\r\n-                                  <span className=\"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-700\">\r\n-                                    {destination.category}\r\n-                                  </span>\r\n-                                )}\r\n-                                {destination.rating && (\r\n-                                  <div className=\"flex items-center space-x-1\">\r\n-                                    <svg className=\"w-4 h-4 text-yellow-400\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n-                                      <path d=\"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z\" />\r\n-                                    </svg>\r\n-                                    <span className=\"text-sm text-gray-600\">{destination.rating}</span>\r\n-                                  </div>\r\n-                                )}\r\n-                              </div>\r\n-                            </div>\r\n-                          </div>\r\n-                        </button>\r\n-                        \r\n-                        {/* Connector line */}\r\n-                        {index < day.destinations.length - 1 && (\r\n-                          <div className=\"flex justify-start ml-7\">\r\n-                            <div className=\"w-0.5 h-4 bg-gray-300\"></div>\r\n-                          </div>\r\n-                        )}\r\n+                  <DndContext\r\n+                    sensors={sensors}\r\n+                    collisionDetection={closestCenter}\r\n+                    onDragEnd={handleDragEnd}\r\n+                  >\r\n+                    <SortableContext \r\n+                      items={day.destinations.map(dest => dest.id)}\r\n+                      strategy={verticalListSortingStrategy}\r\n+                    >\r\n+                      <div className=\"space-y-0\">\r\n+                        {day.destinations.map((destination, index) => (\r\n+                          <SortableDestination\r\n+                            key={destination.id}\r\n+                            destination={destination}\r\n+                            dayColor={day.color}\r\n+                            selectedDestination={selectedDestination}\r\n+                            onDestinationSelect={onDestinationSelect}\r\n+                            isLastItem={index === day.destinations.length - 1}\r\n+                          />\r\n+                        ))}\r\n                       </div>\r\n-                    ))}\r\n-                  </div>\r\n+                    </SortableContext>\r\n+                  </DndContext>\r\n                 )}\r\n                 \r\n                 {/* Add Destination Button */}\r\n                 <div className=\"p-4 border-t border-gray-200\">\r\n@@ -206,9 +377,12 @@\n           <div className=\"flex items-center space-x-2\">\r\n             <svg className=\"w-4 h-4 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n               <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n             </svg>\r\n-            <span className=\"text-xs text-gray-500\">Click on the map to add destinations</span>\r\n+            <span className=\"text-xs text-gray-500\">\r\n+              {day.destinations.length > 0 ? 'Drag destinations to reorder • ' : ''}\r\n+              Click on the map to add destinations\r\n+            </span>\r\n           </div>\r\n           <button className=\"text-xs text-primary-600 hover:text-primary-700\">\r\n             Export\r\n           </button>\r\n"
                },
                {
                    "date": 1752440399077,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -378,9 +378,9 @@\n             <svg className=\"w-4 h-4 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n               <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n             </svg>\r\n             <span className=\"text-xs text-gray-500\">\r\n-              {day.destinations.length > 0 ? 'Drag destinations to reorder • ' : ''}\r\n+              {tripDays.some(day => day.destinations.length > 0) ? 'Drag destinations to reorder • ' : ''}\r\n               Click on the map to add destinations\r\n             </span>\r\n           </div>\r\n           <button className=\"text-xs text-primary-600 hover:text-primary-700\">\r\n"
                },
                {
                    "date": 1752442691067,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -10,8 +10,12 @@\n   PointerSensor,\r\n   useSensor,\r\n   useSensors,\r\n   DragEndEvent,\r\n+  DragOverEvent,\r\n+  DragOverlay,\r\n+  useDraggable,\r\n+  useDroppable,\r\n } from '@dnd-kit/core';\r\n import {\r\n   SortableContext,\r\n   sortableKeyboardCoordinates,\r\n@@ -20,9 +24,9 @@\n } from '@dnd-kit/sortable';\r\n import {\r\n   CSS,\r\n } from '@dnd-kit/utilities';\r\n-import { reorderDestinations } from '@/lib/destination-service';\r\n+import { reorderDestinations, moveDestinationToDay } from '@/lib/destination-service';\r\n \r\n interface ItineraryPanelProps {\r\n   trip: Trip;\r\n   tripDays: TripDay[];\r\n"
                },
                {
                    "date": 1752442724446,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -36,8 +36,32 @@\n   onDestinationSelect: (destination: Destination) => void;\r\n   onDestinationsChange: (destinations: Destination[]) => void;\r\n }\r\n \r\n+// Droppable day container component\r\n+function DroppableDay({ \r\n+  day, \r\n+  children, \r\n+  isOver \r\n+}: { \r\n+  day: TripDay; \r\n+  children: React.ReactNode;\r\n+  isOver: boolean;\r\n+}) {\r\n+  const { setNodeRef } = useDroppable({\r\n+    id: `day-${day.day}`,\r\n+  });\r\n+\r\n+  return (\r\n+    <div \r\n+      ref={setNodeRef}\r\n+      className={`transition-colors ${isOver ? 'bg-blue-50' : ''}`}\r\n+    >\r\n+      {children}\r\n+    </div>\r\n+  );\r\n+}\r\n+\r\n // Sortable destination item component\r\n function SortableDestination({ \r\n   destination, \r\n   dayColor, \r\n"
                },
                {
                    "date": 1752442761182,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -187,8 +187,10 @@\n   onDestinationsChange,\r\n }: ItineraryPanelProps) {\r\n   const [expandedDays, setExpandedDays] = useState<Set<number>>(new Set([1]));\r\n   const [isReordering, setIsReordering] = useState(false);\r\n+  const [activeId, setActiveId] = useState<string | null>(null);\r\n+  const [overId, setOverId] = useState<string | null>(null);\r\n \r\n   const sensors = useSensors(\r\n     useSensor(PointerSensor, {\r\n       activationConstraint: {\r\n@@ -210,66 +212,153 @@\n     setExpandedDays(newExpanded);\r\n     onDaySelect(day);\r\n   };\r\n \r\n+  // Get all destinations for sortable context\r\n+  const allDestinations = tripDays.flatMap(day => day.destinations);\r\n+\r\n+  const handleDragStart = (event: any) => {\r\n+    setActiveId(event.active.id);\r\n+  };\r\n+\r\n+  const handleDragOver = (event: DragOverEvent) => {\r\n+    setOverId(event.over?.id || null);\r\n+  };\r\n+\r\n   const handleDragEnd = async (event: DragEndEvent) => {\r\n     const { active, over } = event;\r\n     \r\n+    setActiveId(null);\r\n+    setOverId(null);\r\n+    \r\n     if (!over || active.id === over.id) {\r\n       return;\r\n     }\r\n \r\n-    // Find the day that contains the dragged item\r\n-    const draggedDestination = tripDays\r\n-      .flatMap(day => day.destinations)\r\n-      .find(dest => dest.id === active.id);\r\n-    \r\n+    const draggedDestination = allDestinations.find(dest => dest.id === active.id);\r\n     if (!draggedDestination) return;\r\n \r\n-    const day = tripDays.find(d => d.day === draggedDestination.day);\r\n-    if (!day) return;\r\n+    setIsReordering(true);\r\n \r\n-    const oldIndex = day.destinations.findIndex(dest => dest.id === active.id);\r\n-    const newIndex = day.destinations.findIndex(dest => dest.id === over.id);\r\n+    try {\r\n+      // Check if we're dropping on a day container or another destination\r\n+      const isDroppedOnDay = over.id.toString().startsWith('day-');\r\n+      \r\n+      if (isDroppedOnDay) {\r\n+        // Cross-day drop - move to end of target day\r\n+        const targetDay = parseInt(over.id.toString().replace('day-', ''));\r\n+        const targetDayData = tripDays.find(d => d.day === targetDay);\r\n+        \r\n+        if (targetDayData && targetDay !== draggedDestination.day) {\r\n+          const newOrderIndex = targetDayData.destinations.length + 1;\r\n+          \r\n+          // Update in database\r\n+          await moveDestinationToDay(draggedDestination.id, targetDay, newOrderIndex);\r\n+          \r\n+          // Update local state\r\n+          const updatedDestination = {\r\n+            ...draggedDestination,\r\n+            day: targetDay,\r\n+            orderIndex: newOrderIndex\r\n+          };\r\n+          \r\n+          const updatedDestinations = allDestinations.map(dest =>\r\n+            dest.id === draggedDestination.id ? updatedDestination : dest\r\n+          );\r\n+          \r\n+          onDestinationsChange(updatedDestinations);\r\n+        }\r\n+      } else {\r\n+        // Same day or destination-to-destination drop\r\n+        const targetDestination = allDestinations.find(dest => dest.id === over.id);\r\n+        if (!targetDestination) return;\r\n \r\n-    if (oldIndex === newIndex) return;\r\n+        const sourceDay = draggedDestination.day;\r\n+        const targetDay = targetDestination.day;\r\n \r\n-    setIsReordering(true);\r\n+        if (sourceDay === targetDay) {\r\n+          // Same day reordering\r\n+          const dayData = tripDays.find(d => d.day === sourceDay);\r\n+          if (!dayData) return;\r\n \r\n-    try {\r\n-      // Create new order array\r\n-      const newDestinations = [...day.destinations];\r\n-      const [movedItem] = newDestinations.splice(oldIndex, 1);\r\n-      newDestinations.splice(newIndex, 0, movedItem);\r\n+          const oldIndex = dayData.destinations.findIndex(dest => dest.id === active.id);\r\n+          const newIndex = dayData.destinations.findIndex(dest => dest.id === over.id);\r\n \r\n-      // Update order indices\r\n-      const reorderedDestinations = newDestinations.map((dest, index) => ({\r\n-        ...dest,\r\n-        orderIndex: index + 1\r\n-      }));\r\n+          if (oldIndex === newIndex) return;\r\n \r\n-      // Update local state immediately for better UX\r\n-      const updatedTripDays = tripDays.map(tripDay => {\r\n-        if (tripDay.day === day.day) {\r\n-          return {\r\n-            ...tripDay,\r\n-            destinations: reorderedDestinations\r\n-          };\r\n-        }\r\n-        return tripDay;\r\n-      });\r\n+          // Create new order array\r\n+          const newDestinations = [...dayData.destinations];\r\n+          const [movedItem] = newDestinations.splice(oldIndex, 1);\r\n+          newDestinations.splice(newIndex, 0, movedItem);\r\n \r\n-      // Update destinations in parent component\r\n-      const allDestinations = updatedTripDays.flatMap(d => d.destinations);\r\n-      onDestinationsChange(allDestinations);\r\n+          // Update order indices\r\n+          const reorderedDestinations = newDestinations.map((dest, index) => ({\r\n+            ...dest,\r\n+            orderIndex: index + 1\r\n+          }));\r\n \r\n-      // Save to database\r\n-      const destinationIds = reorderedDestinations.map(dest => dest.id);\r\n-      await reorderDestinations(trip.id, day.day, destinationIds);\r\n+          // Update destinations in parent component\r\n+          const updatedAllDestinations = allDestinations.map(dest => {\r\n+            const updated = reorderedDestinations.find(rd => rd.id === dest.id);\r\n+            return updated || dest;\r\n+          });\r\n+          \r\n+          onDestinationsChange(updatedAllDestinations);\r\n \r\n+          // Save to database\r\n+          const destinationIds = reorderedDestinations.map(dest => dest.id);\r\n+          await reorderDestinations(trip.id, sourceDay, destinationIds);\r\n+        } else {\r\n+          // Cross-day drop next to specific destination\r\n+          const targetDayData = tripDays.find(d => d.day === targetDay);\r\n+          if (!targetDayData) return;\r\n+\r\n+          const targetIndex = targetDayData.destinations.findIndex(dest => dest.id === over.id);\r\n+          const newOrderIndex = targetIndex + 1;\r\n+\r\n+          // Update in database\r\n+          await moveDestinationToDay(draggedDestination.id, targetDay, newOrderIndex);\r\n+\r\n+          // Reorder existing destinations in target day\r\n+          const updatedTargetDestinations = [...targetDayData.destinations];\r\n+          updatedTargetDestinations.splice(targetIndex + 1, 0, {\r\n+            ...draggedDestination,\r\n+            day: targetDay,\r\n+            orderIndex: newOrderIndex\r\n+          });\r\n+\r\n+          // Update order indices for all destinations in target day\r\n+          const reorderedTargetDestinations = updatedTargetDestinations.map((dest, index) => ({\r\n+            ...dest,\r\n+            orderIndex: index + 1\r\n+          }));\r\n+\r\n+          // Update local state\r\n+          const updatedDestinations = allDestinations\r\n+            .filter(dest => dest.id !== draggedDestination.id) // Remove from source\r\n+            .map(dest => {\r\n+              // Update target day destinations\r\n+              if (dest.day === targetDay) {\r\n+                const updated = reorderedTargetDestinations.find(rd => rd.id === dest.id);\r\n+                return updated || dest;\r\n+              }\r\n+              return dest;\r\n+            })\r\n+            .concat([{\r\n+              ...draggedDestination,\r\n+              day: targetDay,\r\n+              orderIndex: newOrderIndex\r\n+            }]);\r\n+\r\n+          onDestinationsChange(updatedDestinations);\r\n+\r\n+          // Reorder target day in database\r\n+          const targetDayIds = reorderedTargetDestinations.map(dest => dest.id);\r\n+          await reorderDestinations(trip.id, targetDay, targetDayIds);\r\n+        }\r\n+      }\r\n     } catch (error) {\r\n-      console.error('Error reordering destinations:', error);\r\n-      // Optionally show error message to user\r\n+      console.error('Error handling drag:', error);\r\n     } finally {\r\n       setIsReordering(false);\r\n     }\r\n   };\r\n@@ -359,8 +448,10 @@\n                   <DndContext\r\n                     sensors={sensors}\r\n                     collisionDetection={closestCenter}\r\n                     onDragEnd={handleDragEnd}\r\n+                    onDragStart={handleDragStart}\r\n+                    onDragOver={handleDragOver}\r\n                   >\r\n                     <SortableContext \r\n                       items={day.destinations.map(dest => dest.id)}\r\n                       strategy={verticalListSortingStrategy}\r\n"
                },
                {
                    "date": 1752442774796,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -14,8 +14,9 @@\n   DragOverEvent,\r\n   DragOverlay,\r\n   useDraggable,\r\n   useDroppable,\r\n+  UniqueIdentifier,\r\n } from '@dnd-kit/core';\r\n import {\r\n   SortableContext,\r\n   sortableKeyboardCoordinates,\r\n@@ -188,9 +189,9 @@\n }: ItineraryPanelProps) {\r\n   const [expandedDays, setExpandedDays] = useState<Set<number>>(new Set([1]));\r\n   const [isReordering, setIsReordering] = useState(false);\r\n   const [activeId, setActiveId] = useState<string | null>(null);\r\n-  const [overId, setOverId] = useState<string | null>(null);\r\n+  const [overId, setOverId] = useState<UniqueIdentifier | null>(null);\r\n \r\n   const sensors = useSensors(\r\n     useSensor(PointerSensor, {\r\n       activationConstraint: {\r\n"
                },
                {
                    "date": 1752442812633,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -386,110 +386,116 @@\n           )}\r\n         </div>\r\n       </div>\r\n \r\n-      {/* Days List */}\r\n+      {/* Days List with Cross-Day Dragging */}\r\n       <div className=\"flex-1 overflow-y-auto\">\r\n-        {tripDays.map((day) => (\r\n-          <div key={day.day} className=\"border-b border-gray-100 last:border-b-0\">\r\n-            {/* Day Header */}\r\n-            <button\r\n-              onClick={() => toggleDay(day.day)}\r\n-              className={`w-full p-4 text-left hover:bg-gray-50 transition-colors ${\r\n-                selectedDay === day.day ? 'bg-blue-50' : ''\r\n-              }`}\r\n-            >\r\n-              <div className=\"flex items-center justify-between\">\r\n-                <div className=\"flex items-center space-x-3\">\r\n-                  <div \r\n-                    className={`w-6 h-6 rounded-full flex items-center justify-center text-white text-sm font-medium`}\r\n-                    style={{ backgroundColor: day.color.pin }}\r\n-                  >\r\n-                    {day.day}\r\n+        <DndContext\r\n+          sensors={sensors}\r\n+          collisionDetection={closestCenter}\r\n+          onDragStart={handleDragStart}\r\n+          onDragOver={handleDragOver}\r\n+          onDragEnd={handleDragEnd}\r\n+        >\r\n+          <SortableContext \r\n+            items={allDestinations.map(dest => dest.id)}\r\n+            strategy={verticalListSortingStrategy}\r\n+          >\r\n+            {tripDays.map((day) => (\r\n+              <div key={day.day} className=\"border-b border-gray-100 last:border-b-0\">\r\n+                {/* Day Header */}\r\n+                <button\r\n+                  onClick={() => toggleDay(day.day)}\r\n+                  className={`w-full p-4 text-left hover:bg-gray-50 transition-colors ${\r\n+                    selectedDay === day.day ? 'bg-blue-50' : ''\r\n+                  }`}\r\n+                >\r\n+                  <div className=\"flex items-center justify-between\">\r\n+                    <div className=\"flex items-center space-x-3\">\r\n+                      <div \r\n+                        className={`w-6 h-6 rounded-full flex items-center justify-center text-white text-sm font-medium`}\r\n+                        style={{ backgroundColor: day.color.pin }}\r\n+                      >\r\n+                        {day.day}\r\n+                      </div>\r\n+                      <div>\r\n+                        <h3 className=\"font-medium text-gray-900\">\r\n+                          Day {day.day}\r\n+                        </h3>\r\n+                        <p className=\"text-sm text-gray-600\">\r\n+                          {format(parseISO(day.date), 'MMM d, yyyy')}\r\n+                        </p>\r\n+                      </div>\r\n+                    </div>\r\n+                    <div className=\"flex items-center space-x-2\">\r\n+                      <span className=\"text-sm text-gray-500\">\r\n+                        {day.destinations.length} stops\r\n+                      </span>\r\n+                      <svg \r\n+                        className={`w-4 h-4 text-gray-400 transition-transform ${\r\n+                          expandedDays.has(day.day) ? 'rotate-180' : ''\r\n+                        }`}\r\n+                        fill=\"none\" \r\n+                        stroke=\"currentColor\" \r\n+                        viewBox=\"0 0 24 24\"\r\n+                      >\r\n+                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\r\n+                      </svg>\r\n+                    </div>\r\n                   </div>\r\n-                  <div>\r\n-                    <h3 className=\"font-medium text-gray-900\">\r\n-                      Day {day.day}\r\n-                    </h3>\r\n-                    <p className=\"text-sm text-gray-600\">\r\n-                      {format(parseISO(day.date), 'MMM d, yyyy')}\r\n-                    </p>\r\n-                  </div>\r\n-                </div>\r\n-                <div className=\"flex items-center space-x-2\">\r\n-                  <span className=\"text-sm text-gray-500\">\r\n-                    {day.destinations.length} stops\r\n-                  </span>\r\n-                  <svg \r\n-                    className={`w-4 h-4 text-gray-400 transition-transform ${\r\n-                      expandedDays.has(day.day) ? 'rotate-180' : ''\r\n-                    }`}\r\n-                    fill=\"none\" \r\n-                    stroke=\"currentColor\" \r\n-                    viewBox=\"0 0 24 24\"\r\n-                  >\r\n-                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\r\n-                  </svg>\r\n-                </div>\r\n-              </div>\r\n-            </button>\r\n+                </button>\r\n \r\n-            {/* Destinations List */}\r\n-            {expandedDays.has(day.day) && (\r\n-              <div className=\"bg-gray-50\">\r\n-                {day.destinations.length === 0 ? (\r\n-                  <div className=\"p-4 text-center text-gray-500\">\r\n-                    <svg className=\"w-12 h-12 mx-auto mb-2 text-gray-300\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n-                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z\" />\r\n-                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 11a3 3 0 11-6 0 3 3 0 016 0z\" />\r\n-                    </svg>\r\n-                    <p className=\"text-sm\">No destinations added yet</p>\r\n-                    <p className=\"text-xs text-gray-400 mt-1\">Click on the map to add destinations</p>\r\n-                  </div>\r\n-                ) : (\r\n-                  <DndContext\r\n-                    sensors={sensors}\r\n-                    collisionDetection={closestCenter}\r\n-                    onDragEnd={handleDragEnd}\r\n-                    onDragStart={handleDragStart}\r\n-                    onDragOver={handleDragOver}\r\n+                {/* Day Content */}\r\n+                {expandedDays.has(day.day) && (\r\n+                  <DroppableDay \r\n+                    day={day} \r\n+                    isOver={overId === `day-${day.day}`}\r\n                   >\r\n-                    <SortableContext \r\n-                      items={day.destinations.map(dest => dest.id)}\r\n-                      strategy={verticalListSortingStrategy}\r\n-                    >\r\n-                      <div className=\"space-y-0\">\r\n-                        {day.destinations.map((destination, index) => (\r\n-                          <SortableDestination\r\n-                            key={destination.id}\r\n-                            destination={destination}\r\n-                            dayColor={day.color}\r\n-                            selectedDestination={selectedDestination}\r\n-                            onDestinationSelect={onDestinationSelect}\r\n-                            isLastItem={index === day.destinations.length - 1}\r\n-                          />\r\n-                        ))}\r\n+                    <div className=\"bg-gray-50\">\r\n+                      {day.destinations.length === 0 ? (\r\n+                        <div className=\"p-4 text-center text-gray-500\">\r\n+                          <svg className=\"w-12 h-12 mx-auto mb-2 text-gray-300\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n+                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z\" />\r\n+                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 11a3 3 0 11-6 0 3 3 0 016 0z\" />\r\n+                          </svg>\r\n+                          <p className=\"text-sm\">No destinations added yet</p>\r\n+                          <p className=\"text-xs text-gray-400 mt-1\">Click on the map to add destinations</p>\r\n+                          <p className=\"text-xs text-blue-500 mt-1\">Drag destinations from other days here</p>\r\n+                        </div>\r\n+                      ) : (\r\n+                        <div className=\"space-y-0\">\r\n+                          {day.destinations.map((destination, index) => (\r\n+                            <SortableDestination\r\n+                              key={destination.id}\r\n+                              destination={destination}\r\n+                              dayColor={day.color}\r\n+                              selectedDestination={selectedDestination}\r\n+                              onDestinationSelect={onDestinationSelect}\r\n+                              isLastItem={index === day.destinations.length - 1}\r\n+                            />\r\n+                          ))}\r\n+                        </div>\r\n+                      )}\r\n+                      \r\n+                      {/* Add Destination Button */}\r\n+                      <div className=\"p-4 border-t border-gray-200\">\r\n+                        <button\r\n+                          onClick={() => onDaySelect(day.day)}\r\n+                          className=\"w-full flex items-center justify-center space-x-2 p-3 border-2 border-dashed border-gray-300 rounded-lg hover:border-gray-400 hover:bg-gray-50 transition-colors\"\r\n+                        >\r\n+                          <svg className=\"w-5 h-5 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n+                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 6v6m0 0v6m0-6h6m-6 0H6\" />\r\n+                          </svg>\r\n+                          <span className=\"text-sm text-gray-600\">Add destination</span>\r\n+                        </button>\r\n                       </div>\r\n-                    </SortableContext>\r\n-                  </DndContext>\r\n+                    </div>\r\n+                  </DroppableDay>\r\n                 )}\r\n-                \r\n-                {/* Add Destination Button */}\r\n-                <div className=\"p-4 border-t border-gray-200\">\r\n-                  <button\r\n-                    onClick={() => onDaySelect(day.day)}\r\n-                    className=\"w-full flex items-center justify-center space-x-2 p-3 border-2 border-dashed border-gray-300 rounded-lg hover:border-gray-400 hover:bg-gray-50 transition-colors\"\r\n-                  >\r\n-                    <svg className=\"w-5 h-5 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n-                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 6v6m0 0v6m0-6h6m-6 0H6\" />\r\n-                    </svg>\r\n-                    <span className=\"text-sm text-gray-600\">Add destination</span>\r\n-                  </button>\r\n-                </div>\r\n               </div>\r\n-            )}\r\n-          </div>\r\n-        ))}\r\n+            ))}\r\n+          </SortableContext>\r\n+        </DndContext>\r\n       </div>\r\n \r\n       {/* Footer */}\r\n       <div className=\"p-4 border-t border-gray-200\">\r\n@@ -498,9 +504,9 @@\n             <svg className=\"w-4 h-4 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n               <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n             </svg>\r\n             <span className=\"text-xs text-gray-500\">\r\n-              {tripDays.some(day => day.destinations.length > 0) ? 'Drag destinations to reorder • ' : ''}\r\n+              {tripDays.some(day => day.destinations.length > 0) ? 'Drag destinations to reorder or move between days • ' : ''}\r\n               Click on the map to add destinations\r\n             </span>\r\n           </div>\r\n           <button className=\"text-xs text-primary-600 hover:text-primary-700\">\r\n"
                },
                {
                    "date": 1752443267959,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2,8 +2,9 @@\n \r\n import { useState } from 'react';\r\n import { Trip, Destination, TripDay } from '@/types';\r\n import { format, parseISO } from 'date-fns';\r\n+import LocationSearch from './LocationSearch';\r\n import {\r\n   DndContext,\r\n   closestCenter,\r\n   KeyboardSensor,\r\n"
                },
                {
                    "date": 1752443278885,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -36,8 +36,9 @@\n   selectedDestination: Destination | null;\r\n   onDaySelect: (day: number) => void;\r\n   onDestinationSelect: (destination: Destination) => void;\r\n   onDestinationsChange: (destinations: Destination[]) => void;\r\n+  onLocationSelect: (destination: Destination) => void;\r\n }\r\n \r\n // Droppable day container component\r\n function DroppableDay({ \r\n"
                },
                {
                    "date": 1752443286959,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -187,8 +187,9 @@\n   selectedDestination,\r\n   onDaySelect,\r\n   onDestinationSelect,\r\n   onDestinationsChange,\r\n+  onLocationSelect,\r\n }: ItineraryPanelProps) {\r\n   const [expandedDays, setExpandedDays] = useState<Set<number>>(new Set([1]));\r\n   const [isReordering, setIsReordering] = useState(false);\r\n   const [activeId, setActiveId] = useState<string | null>(null);\r\n"
                },
                {
                    "date": 1752443300604,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -478,19 +478,33 @@\n                           ))}\r\n                         </div>\r\n                       )}\r\n                       \r\n-                      {/* Add Destination Button */}\r\n+                      {/* Add Destination - Location Search */}\r\n                       <div className=\"p-4 border-t border-gray-200\">\r\n-                        <button\r\n-                          onClick={() => onDaySelect(day.day)}\r\n-                          className=\"w-full flex items-center justify-center space-x-2 p-3 border-2 border-dashed border-gray-300 rounded-lg hover:border-gray-400 hover:bg-gray-50 transition-colors\"\r\n-                        >\r\n-                          <svg className=\"w-5 h-5 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n-                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 6v6m0 0v6m0-6h6m-6 0H6\" />\r\n-                          </svg>\r\n-                          <span className=\"text-sm text-gray-600\">Add destination</span>\r\n-                        </button>\r\n+                        <LocationSearch\r\n+                          onLocationSelect={(destination) => {\r\n+                            // Set the destination's day and order index\r\n+                            const updatedDestination = {\r\n+                              ...destination,\r\n+                              day: day.day,\r\n+                              orderIndex: day.destinations.length + 1,\r\n+                            };\r\n+                            onLocationSelect(updatedDestination);\r\n+                            onDaySelect(day.day);\r\n+                          }}\r\n+                          selectedDay={day.day}\r\n+                          tripId={trip.id}\r\n+                          placeholder={`Search places for Day ${day.day}...`}\r\n+                          className=\"w-full\"\r\n+                        />\r\n+                        \r\n+                        {/* Alternative: Click on map hint */}\r\n+                        <div className=\"mt-2 text-center\">\r\n+                          <span className=\"text-xs text-gray-500\">\r\n+                            or click on the map to add a destination\r\n+                          </span>\r\n+                        </div>\r\n                       </div>\r\n                     </div>\r\n                   </DroppableDay>\r\n                 )}\r\n"
                },
                {
                    "date": 1752479614776,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -252,25 +252,30 @@\n         const targetDay = parseInt(over.id.toString().replace('day-', ''));\r\n         const targetDayData = tripDays.find(d => d.day === targetDay);\r\n         \r\n         if (targetDayData && targetDay !== draggedDestination.day) {\r\n+          // Calculate proper sequential order index\r\n           const newOrderIndex = targetDayData.destinations.length + 1;\r\n           \r\n           // Update in database\r\n           await moveDestinationToDay(draggedDestination.id, targetDay, newOrderIndex);\r\n           \r\n-          // Update local state\r\n-          const updatedDestination = {\r\n-            ...draggedDestination,\r\n-            day: targetDay,\r\n-            orderIndex: newOrderIndex\r\n-          };\r\n+          // Create updated destinations with proper renumbering\r\n+          const updatedDestinations = allDestinations.map(dest => {\r\n+            if (dest.id === draggedDestination.id) {\r\n+              return {\r\n+                ...dest,\r\n+                day: targetDay,\r\n+                orderIndex: newOrderIndex\r\n+              };\r\n+            }\r\n+            return dest;\r\n+          });\r\n+\r\n+          // Renumber all destinations in both source and target days\r\n+          const finalDestinations = renumberDestinationsInDays(updatedDestinations, [draggedDestination.day, targetDay]);\r\n           \r\n-          const updatedDestinations = allDestinations.map(dest =>\r\n-            dest.id === draggedDestination.id ? updatedDestination : dest\r\n-          );\r\n-          \r\n-          onDestinationsChange(updatedDestinations);\r\n+          onDestinationsChange(finalDestinations);\r\n         }\r\n       } else {\r\n         // Same day or destination-to-destination drop\r\n         const targetDestination = allDestinations.find(dest => dest.id === over.id);\r\n@@ -293,9 +298,9 @@\n           const newDestinations = [...dayData.destinations];\r\n           const [movedItem] = newDestinations.splice(oldIndex, 1);\r\n           newDestinations.splice(newIndex, 0, movedItem);\r\n \r\n-          // Update order indices\r\n+          // Update order indices sequentially\r\n           const reorderedDestinations = newDestinations.map((dest, index) => ({\r\n             ...dest,\r\n             orderIndex: index + 1\r\n           }));\r\n@@ -316,48 +321,47 @@\n           const targetDayData = tripDays.find(d => d.day === targetDay);\r\n           if (!targetDayData) return;\r\n \r\n           const targetIndex = targetDayData.destinations.findIndex(dest => dest.id === over.id);\r\n-          const newOrderIndex = targetIndex + 1;\r\n-\r\n-          // Update in database\r\n-          await moveDestinationToDay(draggedDestination.id, targetDay, newOrderIndex);\r\n-\r\n-          // Reorder existing destinations in target day\r\n+          \r\n+          // Insert the destination at the target position\r\n           const updatedTargetDestinations = [...targetDayData.destinations];\r\n           updatedTargetDestinations.splice(targetIndex + 1, 0, {\r\n             ...draggedDestination,\r\n             day: targetDay,\r\n-            orderIndex: newOrderIndex\r\n+            orderIndex: targetIndex + 2 // Temporary index, will be renumbered\r\n           });\r\n \r\n-          // Update order indices for all destinations in target day\r\n-          const reorderedTargetDestinations = updatedTargetDestinations.map((dest, index) => ({\r\n-            ...dest,\r\n-            orderIndex: index + 1\r\n-          }));\r\n+          // Update in database with proper order index\r\n+          await moveDestinationToDay(draggedDestination.id, targetDay, targetIndex + 2);\r\n \r\n-          // Update local state\r\n+          // Create updated destinations array\r\n           const updatedDestinations = allDestinations\r\n             .filter(dest => dest.id !== draggedDestination.id) // Remove from source\r\n             .map(dest => {\r\n               // Update target day destinations\r\n               if (dest.day === targetDay) {\r\n-                const updated = reorderedTargetDestinations.find(rd => rd.id === dest.id);\r\n+                const updated = updatedTargetDestinations.find(rd => rd.id === dest.id);\r\n                 return updated || dest;\r\n               }\r\n               return dest;\r\n             })\r\n             .concat([{\r\n               ...draggedDestination,\r\n               day: targetDay,\r\n-              orderIndex: newOrderIndex\r\n+              orderIndex: targetIndex + 2 // Temporary, will be renumbered\r\n             }]);\r\n \r\n-          onDestinationsChange(updatedDestinations);\r\n+          // Renumber all destinations in both affected days\r\n+          const finalDestinations = renumberDestinationsInDays(updatedDestinations, [sourceDay, targetDay]);\r\n+          \r\n+          onDestinationsChange(finalDestinations);\r\n \r\n-          // Reorder target day in database\r\n-          const targetDayIds = reorderedTargetDestinations.map(dest => dest.id);\r\n+          // Reorder target day in database with proper sequential IDs\r\n+          const targetDayDestinations = finalDestinations.filter(dest => dest.day === targetDay);\r\n+          const targetDayIds = targetDayDestinations\r\n+            .sort((a, b) => (a.orderIndex || 0) - (b.orderIndex || 0))\r\n+            .map(dest => dest.id);\r\n           await reorderDestinations(trip.id, targetDay, targetDayIds);\r\n         }\r\n       }\r\n     } catch (error) {\r\n@@ -366,8 +370,29 @@\n       setIsReordering(false);\r\n     }\r\n   };\r\n \r\n+  // Helper function to renumber destinations sequentially within specified days\r\n+  const renumberDestinationsInDays = (destinations: Destination[], daysToRenumber: number[]): Destination[] => {\r\n+    return destinations.map(dest => {\r\n+      if (daysToRenumber.includes(dest.day)) {\r\n+        // Get all destinations for this day and sort by current order\r\n+        const dayDestinations = destinations\r\n+          .filter(d => d.day === dest.day)\r\n+          .sort((a, b) => (a.orderIndex || 0) - (b.orderIndex || 0));\r\n+        \r\n+        // Find the new sequential index\r\n+        const newIndex = dayDestinations.findIndex(d => d.id === dest.id) + 1;\r\n+        \r\n+        return {\r\n+          ...dest,\r\n+          orderIndex: newIndex\r\n+        };\r\n+      }\r\n+      return dest;\r\n+    });\r\n+  };\r\n+\r\n   return (\r\n     <div className=\"h-full flex flex-col\">\r\n       {/* Header */}\r\n       <div className=\"p-4 border-b border-gray-200\">\r\n"
                },
                {
                    "date": 1752479732221,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -150,8 +150,23 @@\n               <p className=\"text-sm text-gray-500 mt-1 line-clamp-2\">\r\n                 {destination.notes}\r\n               </p>\r\n             )}\r\n+            \r\n+            {/* Photo display */}\r\n+            {destination.photos && destination.photos.length > 0 && (\r\n+              <div className=\"mt-2\">\r\n+                <img \r\n+                  src={destination.photos[0]} \r\n+                  alt={destination.locationName}\r\n+                  className=\"w-full h-24 object-cover rounded-lg\"\r\n+                  onError={(e) => {\r\n+                    (e.target as HTMLImageElement).style.display = 'none';\r\n+                  }}\r\n+                />\r\n+              </div>\r\n+            )}\r\n+            \r\n             <div className=\"flex items-center space-x-4 mt-2\">\r\n               {destination.category && (\r\n                 <span className=\"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-700\">\r\n                   {destination.category}\r\n"
                },
                {
                    "date": 1752479963949,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -37,8 +37,9 @@\n   onDaySelect: (day: number) => void;\r\n   onDestinationSelect: (destination: Destination) => void;\r\n   onDestinationsChange: (destinations: Destination[]) => void;\r\n   onLocationSelect: (destination: Destination) => void;\r\n+  onDestinationDelete: (destinationId: string) => void;\r\n }\r\n \r\n // Droppable day container component\r\n function DroppableDay({ \r\n"
                },
                {
                    "date": 1752479974244,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -204,8 +204,9 @@\n   onDaySelect,\r\n   onDestinationSelect,\r\n   onDestinationsChange,\r\n   onLocationSelect,\r\n+  onDestinationDelete,\r\n }: ItineraryPanelProps) {\r\n   const [expandedDays, setExpandedDays] = useState<Set<number>>(new Set([1]));\r\n   const [isReordering, setIsReordering] = useState(false);\r\n   const [activeId, setActiveId] = useState<string | null>(null);\r\n"
                },
                {
                    "date": 1752479982943,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -514,8 +514,9 @@\n                               destination={destination}\r\n                               dayColor={day.color}\r\n                               selectedDestination={selectedDestination}\r\n                               onDestinationSelect={onDestinationSelect}\r\n+                              onDestinationDelete={onDestinationDelete}\r\n                               isLastItem={index === day.destinations.length - 1}\r\n                             />\r\n                           ))}\r\n                         </div>\r\n"
                },
                {
                    "date": 1752479990565,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -70,14 +70,16 @@\n   destination, \r\n   dayColor, \r\n   selectedDestination,\r\n   onDestinationSelect,\r\n+  onDestinationDelete,\r\n   isLastItem \r\n }: {\r\n   destination: Destination;\r\n   dayColor: any;\r\n   selectedDestination: Destination | null;\r\n   onDestinationSelect: (destination: Destination) => void;\r\n+  onDestinationDelete: (destinationId: string) => void;\r\n   isLastItem: boolean;\r\n }) {\r\n   const {\r\n     attributes,\r\n"
                },
                {
                    "date": 1752480005629,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -139,13 +139,27 @@\n             <div className=\"flex items-center justify-between\">\r\n               <h4 className=\"font-medium text-gray-900 truncate\">\r\n                 {destination.locationName}\r\n               </h4>\r\n-              {destination.startTime && (\r\n-                <span className=\"text-sm text-gray-500 flex-shrink-0 ml-2\">\r\n-                  {formatTime(destination.startTime)}\r\n-                </span>\r\n-              )}\r\n+              <div className=\"flex items-center space-x-2\">\r\n+                {destination.startTime && (\r\n+                  <span className=\"text-sm text-gray-500 flex-shrink-0\">\r\n+                    {formatTime(destination.startTime)}\r\n+                  </span>\r\n+                )}\r\n+                <button\r\n+                  onClick={(e) => {\r\n+                    e.stopPropagation();\r\n+                    onDestinationDelete(destination.id);\r\n+                  }}\r\n+                  className=\"text-red-500 hover:text-red-700 hover:bg-red-50 rounded-lg p-1 transition-colors opacity-0 group-hover:opacity-100 flex-shrink-0\"\r\n+                  title=\"Delete destination\"\r\n+                >\r\n+                  <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n+                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\r\n+                  </svg>\r\n+                </button>\r\n+              </div>\r\n             </div>\r\n             <p className=\"text-sm text-gray-600 truncate\">\r\n               {destination.address}\r\n             </p>\r\n"
                },
                {
                    "date": 1752480014678,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -110,9 +110,9 @@\n   return (\r\n     <div ref={setNodeRef} style={style} className={isDragging ? 'opacity-50' : ''}>\r\n       <button\r\n         onClick={() => onDestinationSelect(destination)}\r\n-        className={`w-full p-4 text-left hover:bg-gray-100 transition-colors ${\r\n+        className={`w-full p-4 text-left hover:bg-gray-100 transition-colors group ${\r\n           selectedDestination?.id === destination.id ? 'bg-blue-100' : ''\r\n         }`}\r\n       >\r\n         <div className=\"flex items-start space-x-3\">\r\n"
                },
                {
                    "date": 1752480982339,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -126,14 +126,32 @@\n               <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 8h16M4 16h16\" />\r\n             </svg>\r\n           </div>\r\n \r\n-          {/* Pin Number */}\r\n-          <div \r\n-            className=\"w-6 h-6 rounded-full flex items-center justify-center text-white text-xs font-medium flex-shrink-0 mt-0.5\"\r\n-            style={{ backgroundColor: dayColor.pin }}\r\n-          >\r\n-            {destination.orderIndex}\r\n+          {/* Pin Number - Teardrop shape matching map */}\r\n+          <div className=\"flex-shrink-0 mt-0.5\">\r\n+            <svg \r\n+              width=\"24\" \r\n+              height=\"24\" \r\n+              viewBox=\"0 0 24 24\" \r\n+              className=\"w-6 h-6\"\r\n+            >\r\n+              <path \r\n+                d=\"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z\"\r\n+                fill={dayColor.pin}\r\n+                stroke=\"#FFFFFF\"\r\n+                strokeWidth=\"2\"\r\n+              />\r\n+              <text \r\n+                x=\"12\" \r\n+                y=\"13\" \r\n+                textAnchor=\"middle\" \r\n+                className=\"text-white text-xs font-medium fill-current\"\r\n+                style={{ fontSize: '12px' }}\r\n+              >\r\n+                {destination.orderIndex}\r\n+              </text>\r\n+            </svg>\r\n           </div>\r\n           \r\n           <div className=\"flex-1 min-w-0\">\r\n             <div className=\"flex items-center justify-between\">\r\n"
                },
                {
                    "date": 1752480993044,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -488,15 +488,33 @@\n                     selectedDay === day.day ? 'bg-blue-50' : ''\r\n                   }`}\r\n                 >\r\n                   <div className=\"flex items-center justify-between\">\r\n-                    <div className=\"flex items-center space-x-3\">\r\n-                      <div \r\n-                        className={`w-6 h-6 rounded-full flex items-center justify-center text-white text-sm font-medium`}\r\n-                        style={{ backgroundColor: day.color.pin }}\r\n+                                      <div className=\"flex items-center space-x-3\">\r\n+                    <div>\r\n+                      <svg \r\n+                        width=\"24\" \r\n+                        height=\"24\" \r\n+                        viewBox=\"0 0 24 24\" \r\n+                        className=\"w-6 h-6\"\r\n                       >\r\n-                        {day.day}\r\n-                      </div>\r\n+                        <path \r\n+                          d=\"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z\"\r\n+                          fill={day.color.pin}\r\n+                          stroke=\"#FFFFFF\"\r\n+                          strokeWidth=\"2\"\r\n+                        />\r\n+                        <text \r\n+                          x=\"12\" \r\n+                          y=\"13\" \r\n+                          textAnchor=\"middle\" \r\n+                          className=\"text-white text-sm font-medium fill-current\"\r\n+                          style={{ fontSize: '14px' }}\r\n+                        >\r\n+                          {day.day}\r\n+                        </text>\r\n+                      </svg>\r\n+                    </div>\r\n                       <div>\r\n                         <h3 className=\"font-medium text-gray-900\">\r\n                           Day {day.day}\r\n                         </h3>\r\n"
                },
                {
                    "date": 1752491364244,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -3,8 +3,9 @@\n import { useState } from 'react';\r\n import { Trip, Destination, TripDay } from '@/types';\r\n import { format, parseISO } from 'date-fns';\r\n import LocationSearch from './LocationSearch';\r\n+import SmartRecommendations from './SmartRecommendations';\r\n import {\r\n   DndContext,\r\n   closestCenter,\r\n   KeyboardSensor,\r\n"
                },
                {
                    "date": 1752491386241,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -609,8 +609,17 @@\n           </SortableContext>\r\n         </DndContext>\r\n       </div>\r\n \r\n+      {/* Smart Recommendations */}\r\n+      <SmartRecommendations\r\n+        trip={trip}\r\n+        tripDays={tripDays}\r\n+        selectedDay={selectedDay}\r\n+        onDestinationAdd={onLocationSelect}\r\n+        existingDestinations={tripDays.flatMap(day => day.destinations)}\r\n+      />\r\n+\r\n       {/* Footer */}\r\n       <div className=\"p-4 border-t border-gray-200\">\r\n         <div className=\"flex items-center justify-between\">\r\n           <div className=\"flex items-center space-x-2\">\r\n"
                },
                {
                    "date": 1752492178812,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -107,14 +107,16 @@\n       return time;\r\n     }\r\n   };\r\n \r\n+  const isSelected = selectedDestination?.id === destination.id;\r\n+\r\n   return (\r\n     <div ref={setNodeRef} style={style} className={isDragging ? 'opacity-50' : ''}>\r\n       <button\r\n         onClick={() => onDestinationSelect(destination)}\r\n-        className={`w-full p-4 text-left hover:bg-gray-100 transition-colors group ${\r\n-          selectedDestination?.id === destination.id ? 'bg-blue-100' : ''\r\n+        className={`w-full p-4 text-left hover:bg-gray-100 transition-colors group relative ${\r\n+          isSelected ? 'bg-blue-50 border-l-4 border-blue-500' : ''\r\n         }`}\r\n       >\r\n         <div className=\"flex items-start space-x-3\">\r\n           {/* Drag Handle */}\r\n@@ -137,9 +139,9 @@\n               className=\"w-6 h-6\"\r\n             >\r\n               <path \r\n                 d=\"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z\"\r\n-                fill={dayColor.pin}\r\n+                fill={isSelected ? '#3B82F6' : dayColor.pin}\r\n                 stroke=\"#FFFFFF\"\r\n                 strokeWidth=\"2\"\r\n               />\r\n               <text \r\n@@ -155,11 +157,24 @@\n           </div>\r\n           \r\n           <div className=\"flex-1 min-w-0\">\r\n             <div className=\"flex items-center justify-between\">\r\n-              <h4 className=\"font-medium text-gray-900 truncate\">\r\n-                {destination.locationName}\r\n-              </h4>\r\n+              <div className=\"flex items-center space-x-2 min-w-0\">\r\n+                <h4 className=\"font-medium text-gray-900 truncate\">\r\n+                  {destination.locationName}\r\n+                </h4>\r\n+                {/* Compact photo for selected destinations */}\r\n+                {isSelected && destination.photos && destination.photos.length > 0 && (\r\n+                  <img \r\n+                    src={destination.photos[0]} \r\n+                    alt={destination.locationName}\r\n+                    className=\"w-8 h-8 object-cover rounded-lg flex-shrink-0\"\r\n+                    onError={(e) => {\r\n+                      (e.target as HTMLImageElement).style.display = 'none';\r\n+                    }}\r\n+                  />\r\n+                )}\r\n+              </div>\r\n               <div className=\"flex items-center space-x-2\">\r\n                 {destination.startTime && (\r\n                   <span className=\"text-sm text-gray-500 flex-shrink-0\">\r\n                     {formatTime(destination.startTime)}\r\n@@ -187,37 +202,39 @@\n                 {destination.notes}\r\n               </p>\r\n             )}\r\n             \r\n-            {/* Photo display */}\r\n-            {destination.photos && destination.photos.length > 0 && (\r\n-              <div className=\"mt-2\">\r\n-                <img \r\n-                  src={destination.photos[0]} \r\n-                  alt={destination.locationName}\r\n-                  className=\"w-full h-24 object-cover rounded-lg\"\r\n-                  onError={(e) => {\r\n-                    (e.target as HTMLImageElement).style.display = 'none';\r\n+            {/* Compact details for selected destinations */}\r\n+            {isSelected && (\r\n+              <div className=\"flex items-center space-x-4 mt-2 text-xs\">\r\n+                {destination.category && (\r\n+                  <span className=\"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800\">\r\n+                    {destination.category}\r\n+                  </span>\r\n+                )}\r\n+                {destination.rating && (\r\n+                  <div className=\"flex items-center space-x-1\">\r\n+                    <svg className=\"w-3 h-3 text-yellow-400\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n+                      <path d=\"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z\" />\r\n+                    </svg>\r\n+                    <span className=\"text-gray-600\">{destination.rating}</span>\r\n+                  </div>\r\n+                )}\r\n+                {/* Close button for selected destinations */}\r\n+                <button\r\n+                  onClick={(e) => {\r\n+                    e.stopPropagation();\r\n+                    onDestinationSelect(null as any);\r\n                   }}\r\n-                />\r\n+                  className=\"text-gray-400 hover:text-gray-600 transition-colors\"\r\n+                  title=\"Clear selection\"\r\n+                >\r\n+                  <svg className=\"w-3 h-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n+                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n+                  </svg>\r\n+                </button>\r\n               </div>\r\n             )}\r\n-            \r\n-            <div className=\"flex items-center space-x-4 mt-2\">\r\n-              {destination.category && (\r\n-                <span className=\"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-700\">\r\n-                  {destination.category}\r\n-                </span>\r\n-              )}\r\n-              {destination.rating && (\r\n-                <div className=\"flex items-center space-x-1\">\r\n-                  <svg className=\"w-4 h-4 text-yellow-400\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n-                    <path d=\"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z\" />\r\n-                  </svg>\r\n-                  <span className=\"text-sm text-gray-600\">{destination.rating}</span>\r\n-                </div>\r\n-              )}\r\n-            </div>\r\n           </div>\r\n         </div>\r\n       </button>\r\n       \r\n"
                },
                {
                    "date": 1752493948096,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -497,75 +497,58 @@\n             items={allDestinations.map(dest => dest.id)}\r\n             strategy={verticalListSortingStrategy}\r\n           >\r\n             {tripDays.map((day) => (\r\n-              <div key={day.day} className=\"border-b border-gray-100 last:border-b-0\">\r\n-                {/* Day Header */}\r\n-                <button\r\n-                  onClick={() => toggleDay(day.day)}\r\n-                  className={`w-full p-4 text-left hover:bg-gray-50 transition-colors ${\r\n-                    selectedDay === day.day ? 'bg-blue-50' : ''\r\n-                  }`}\r\n-                >\r\n-                  <div className=\"flex items-center justify-between\">\r\n-                                      <div className=\"flex items-center space-x-3\">\r\n-                    <div>\r\n-                      <svg \r\n-                        width=\"24\" \r\n-                        height=\"24\" \r\n-                        viewBox=\"0 0 24 24\" \r\n-                        className=\"w-6 h-6\"\r\n-                      >\r\n-                        <path \r\n-                          d=\"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z\"\r\n-                          fill={day.color.pin}\r\n-                          stroke=\"#FFFFFF\"\r\n-                          strokeWidth=\"2\"\r\n-                        />\r\n-                        <text \r\n-                          x=\"12\" \r\n-                          y=\"13\" \r\n-                          textAnchor=\"middle\" \r\n-                          className=\"text-white text-sm font-medium fill-current\"\r\n-                          style={{ fontSize: '14px' }}\r\n+              <DroppableDay\r\n+                key={day.day}\r\n+                day={day}\r\n+                isOver={overId === `day-${day.day}`}\r\n+              >\r\n+                <div className=\"border-b border-gray-100 last:border-b-0\">\r\n+                  {/* Day Header */}\r\n+                  <button\r\n+                    onClick={() => toggleDay(day.day)}\r\n+                    className={`w-full p-4 text-left hover:bg-gray-50 transition-colors ${\r\n+                      selectedDay === day.day ? 'bg-blue-50' : ''\r\n+                    }`}\r\n+                  >\r\n+                    <div className=\"flex items-center justify-between\">\r\n+                      <div className=\"flex items-center space-x-3\">\r\n+                        <div \r\n+                          className={`w-6 h-6 rounded-full flex items-center justify-center text-white text-sm font-medium`}\r\n+                          style={{ backgroundColor: day.color.pin }}\r\n                         >\r\n                           {day.day}\r\n-                        </text>\r\n-                      </svg>\r\n-                    </div>\r\n-                      <div>\r\n-                        <h3 className=\"font-medium text-gray-900\">\r\n-                          Day {day.day}\r\n-                        </h3>\r\n-                        <p className=\"text-sm text-gray-600\">\r\n-                          {format(parseISO(day.date), 'MMM d, yyyy')}\r\n-                        </p>\r\n+                        </div>\r\n+                        <div>\r\n+                          <h3 className=\"font-medium text-gray-900\">\r\n+                            Day {day.day}\r\n+                          </h3>\r\n+                          <p className=\"text-sm text-gray-600\">\r\n+                            {format(parseISO(day.date), 'MMM d, yyyy')}\r\n+                          </p>\r\n+                        </div>\r\n                       </div>\r\n+                      <div className=\"flex items-center space-x-2\">\r\n+                        <span className=\"text-sm text-gray-500\">\r\n+                          {day.destinations.length} stops\r\n+                        </span>\r\n+                        <svg \r\n+                          className={`w-4 h-4 text-gray-400 transition-transform ${\r\n+                            expandedDays.has(day.day) ? 'rotate-180' : ''\r\n+                          }`}\r\n+                          fill=\"none\" \r\n+                          stroke=\"currentColor\" \r\n+                          viewBox=\"0 0 24 24\"\r\n+                        >\r\n+                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\r\n+                        </svg>\r\n+                      </div>\r\n                     </div>\r\n-                    <div className=\"flex items-center space-x-2\">\r\n-                      <span className=\"text-sm text-gray-500\">\r\n-                        {day.destinations.length} stops\r\n-                      </span>\r\n-                      <svg \r\n-                        className={`w-4 h-4 text-gray-400 transition-transform ${\r\n-                          expandedDays.has(day.day) ? 'rotate-180' : ''\r\n-                        }`}\r\n-                        fill=\"none\" \r\n-                        stroke=\"currentColor\" \r\n-                        viewBox=\"0 0 24 24\"\r\n-                      >\r\n-                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\r\n-                      </svg>\r\n-                    </div>\r\n-                  </div>\r\n-                </button>\r\n+                  </button>\r\n \r\n-                {/* Day Content */}\r\n-                {expandedDays.has(day.day) && (\r\n-                  <DroppableDay \r\n-                    day={day} \r\n-                    isOver={overId === `day-${day.day}`}\r\n-                  >\r\n+                  {/* Destinations List */}\r\n+                  {expandedDays.has(day.day) && (\r\n                     <div className=\"bg-gray-50\">\r\n                       {day.destinations.length === 0 ? (\r\n                         <div className=\"p-4 text-center text-gray-500\">\r\n                           <svg className=\"w-12 h-12 mx-auto mb-2 text-gray-300\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n@@ -573,9 +556,8 @@\n                             <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 11a3 3 0 11-6 0 3 3 0 016 0z\" />\r\n                           </svg>\r\n                           <p className=\"text-sm\">No destinations added yet</p>\r\n                           <p className=\"text-xs text-gray-400 mt-1\">Click on the map to add destinations</p>\r\n-                          <p className=\"text-xs text-blue-500 mt-1\">Drag destinations from other days here</p>\r\n                         </div>\r\n                       ) : (\r\n                         <div className=\"space-y-0\">\r\n                           {day.destinations.map((destination, index) => (\r\n@@ -618,25 +600,25 @@\n                           </span>\r\n                         </div>\r\n                       </div>\r\n                     </div>\r\n-                  </DroppableDay>\r\n-                )}\r\n-              </div>\r\n+                  )}\r\n+                </div>\r\n+              </DroppableDay>\r\n             ))}\r\n           </SortableContext>\r\n         </DndContext>\r\n+        \r\n+        {/* Smart Recommendations - Inside scrollable area */}\r\n+        <SmartRecommendations\r\n+          trip={trip}\r\n+          tripDays={tripDays}\r\n+          selectedDay={selectedDay}\r\n+          onDestinationAdd={onLocationSelect}\r\n+          existingDestinations={tripDays.flatMap(day => day.destinations)}\r\n+        />\r\n       </div>\r\n \r\n-      {/* Smart Recommendations */}\r\n-      <SmartRecommendations\r\n-        trip={trip}\r\n-        tripDays={tripDays}\r\n-        selectedDay={selectedDay}\r\n-        onDestinationAdd={onLocationSelect}\r\n-        existingDestinations={tripDays.flatMap(day => day.destinations)}\r\n-      />\r\n-\r\n       {/* Footer */}\r\n       <div className=\"p-4 border-t border-gray-200\">\r\n         <div className=\"flex items-center justify-between\">\r\n           <div className=\"flex items-center space-x-2\">\r\n"
                },
                {
                    "date": 1752494148688,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -616,25 +616,7 @@\n           onDestinationAdd={onLocationSelect}\r\n           existingDestinations={tripDays.flatMap(day => day.destinations)}\r\n         />\r\n       </div>\r\n-\r\n-      {/* Footer */}\r\n-      <div className=\"p-4 border-t border-gray-200\">\r\n-        <div className=\"flex items-center justify-between\">\r\n-          <div className=\"flex items-center space-x-2\">\r\n-            <svg className=\"w-4 h-4 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n-              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n-            </svg>\r\n-            <span className=\"text-xs text-gray-500\">\r\n-              {tripDays.some(day => day.destinations.length > 0) ? 'Drag destinations to reorder or move between days • ' : ''}\r\n-              Click on the map to add destinations\r\n-            </span>\r\n-          </div>\r\n-          <button className=\"text-xs text-primary-600 hover:text-primary-700\">\r\n-            Export\r\n-          </button>\r\n-        </div>\r\n-      </div>\r\n     </div>\r\n   );\r\n } \n\\ No newline at end of file\n"
                },
                {
                    "date": 1752494386342,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -461,9 +461,9 @@\n     });\r\n   };\r\n \r\n   return (\r\n-    <div className=\"h-full flex flex-col\">\r\n+    <div className=\"h-full flex flex-col bg-white\">\r\n       {/* Header */}\r\n       <div className=\"p-4 border-b border-gray-200\">\r\n         <div className=\"flex items-center justify-between\">\r\n           <div>\r\n"
                },
                {
                    "date": 1752494875127,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -606,17 +606,8 @@\n               </DroppableDay>\r\n             ))}\r\n           </SortableContext>\r\n         </DndContext>\r\n-        \r\n-        {/* Smart Recommendations - Inside scrollable area */}\r\n-        <SmartRecommendations\r\n-          trip={trip}\r\n-          tripDays={tripDays}\r\n-          selectedDay={selectedDay}\r\n-          onDestinationAdd={onLocationSelect}\r\n-          existingDestinations={tripDays.flatMap(day => day.destinations)}\r\n-        />\r\n       </div>\r\n     </div>\r\n   );\r\n } \n\\ No newline at end of file\n"
                },
                {
                    "date": 1752494884675,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -3,9 +3,8 @@\n import { useState } from 'react';\r\n import { Trip, Destination, TripDay } from '@/types';\r\n import { format, parseISO } from 'date-fns';\r\n import LocationSearch from './LocationSearch';\r\n-import SmartRecommendations from './SmartRecommendations';\r\n import {\r\n   DndContext,\r\n   closestCenter,\r\n   KeyboardSensor,\r\n"
                },
                {
                    "date": 1752494907489,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -591,14 +591,20 @@\n                           placeholder={`Search places for Day ${day.day}...`}\r\n                           className=\"w-full\"\r\n                         />\r\n                         \r\n-                        {/* Alternative: Click on map hint */}\r\n-                        <div className=\"mt-2 text-center\">\r\n-                          <span className=\"text-xs text-gray-500\">\r\n-                            or click on the map to add a destination\r\n-                          </span>\r\n-                        </div>\r\n+                        {/* Day-specific recommendations */}\r\n+                        {day.destinations.length > 0 && (\r\n+                          <div className=\"mt-3 pt-3 border-t border-gray-100\">\r\n+                            <h4 className=\"text-xs font-medium text-gray-600 mb-2\">Recommended nearby</h4>\r\n+                            <div className=\"flex space-x-2 overflow-x-auto\">\r\n+                              {/* We'll add recommendations here */}\r\n+                              <div className=\"flex-shrink-0 w-32 h-16 bg-gray-100 rounded-md flex items-center justify-center\">\r\n+                                <span className=\"text-xs text-gray-500\">Loading...</span>\r\n+                              </div>\r\n+                            </div>\r\n+                          </div>\r\n+                        )}\r\n                       </div>\r\n                     </div>\r\n                   )}\r\n                 </div>\r\n"
                },
                {
                    "date": 1752494915796,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,7 +1,7 @@\n 'use client';\r\n \r\n-import { useState } from 'react';\r\n+import { useState, useEffect, useRef } from 'react';\r\n import { Trip, Destination, TripDay } from '@/types';\r\n import { format, parseISO } from 'date-fns';\r\n import LocationSearch from './LocationSearch';\r\n import {\r\n"
                },
                {
                    "date": 1752494938609,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -28,8 +28,94 @@\n   CSS,\r\n } from '@dnd-kit/utilities';\r\n import { reorderDestinations, moveDestinationToDay } from '@/lib/destination-service';\r\n \r\n+interface RecommendationItem {\r\n+  id: string;\r\n+  name: string;\r\n+  address: string;\r\n+  lat: number;\r\n+  lng: number;\r\n+  category: string;\r\n+  rating?: number;\r\n+  photos?: string[];\r\n+  description: string;\r\n+  photo?: string;\r\n+}\r\n+\r\n+// Curated recommendations\r\n+const CURATED_RECOMMENDATIONS = {\r\n+  tokyo: [\r\n+    {\r\n+      name: 'Senso-ji Temple',\r\n+      address: '2-3-1 Asakusa, Taito City, Tokyo',\r\n+      lat: 35.7148,\r\n+      lng: 139.7967,\r\n+      category: 'tourist_attraction',\r\n+      description: 'Ancient Buddhist temple',\r\n+      photo: 'https://images.unsplash.com/photo-1573822632087-b37c9d73f5f5?w=300&h=200&fit=crop',\r\n+    },\r\n+    {\r\n+      name: 'Shibuya Crossing',\r\n+      address: 'Shibuya City, Tokyo',\r\n+      lat: 35.6598,\r\n+      lng: 139.7006,\r\n+      category: 'point_of_interest',\r\n+      description: 'Famous scramble crossing',\r\n+      photo: 'https://images.unsplash.com/photo-1609813306884-a3b4c2b7f86b?w=300&h=200&fit=crop',\r\n+    },\r\n+    {\r\n+      name: 'Tsukiji Outer Market',\r\n+      address: 'Tsukiji, Chuo City, Tokyo',\r\n+      lat: 35.6654,\r\n+      lng: 139.7707,\r\n+      category: 'food',\r\n+      description: 'Fresh seafood market',\r\n+      photo: 'https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=300&h=200&fit=crop',\r\n+    },\r\n+  ],\r\n+  paris: [\r\n+    {\r\n+      name: 'Eiffel Tower',\r\n+      address: 'Champ de Mars, Paris',\r\n+      lat: 48.8584,\r\n+      lng: 2.2945,\r\n+      category: 'tourist_attraction',\r\n+      description: 'Iconic iron lattice tower',\r\n+      photo: 'https://images.unsplash.com/photo-1511739001486-6bfe10ce785f?w=300&h=200&fit=crop',\r\n+    },\r\n+    {\r\n+      name: 'Louvre Museum',\r\n+      address: 'Rue de Rivoli, Paris',\r\n+      lat: 48.8606,\r\n+      lng: 2.3376,\r\n+      category: 'museum',\r\n+      description: 'World\\'s largest art museum',\r\n+      photo: 'https://images.unsplash.com/photo-1566139327542-1f4c8fdb8e88?w=300&h=200&fit=crop',\r\n+    },\r\n+  ],\r\n+  london: [\r\n+    {\r\n+      name: 'Big Ben',\r\n+      address: 'Westminster, London',\r\n+      lat: 51.5007,\r\n+      lng: -0.1246,\r\n+      category: 'tourist_attraction',\r\n+      description: 'Famous clock tower',\r\n+      photo: 'https://images.unsplash.com/photo-1513635269975-59663e0ac1ad?w=300&h=200&fit=crop',\r\n+    },\r\n+    {\r\n+      name: 'Tower Bridge',\r\n+      address: 'Tower Bridge Rd, London',\r\n+      lat: 51.5055,\r\n+      lng: -0.0754,\r\n+      category: 'tourist_attraction',\r\n+      description: 'Victorian Gothic bridge',\r\n+      photo: 'https://images.unsplash.com/photo-1515920892043-e8b3b7b13bee?w=300&h=200&fit=crop',\r\n+    },\r\n+  ],\r\n+};\r\n+\r\n interface ItineraryPanelProps {\r\n   trip: Trip;\r\n   tripDays: TripDay[];\r\n   selectedDay: number;\r\n"
                },
                {
                    "date": 1752494948482,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -347,8 +347,9 @@\n   const [expandedDays, setExpandedDays] = useState<Set<number>>(new Set([1]));\r\n   const [isReordering, setIsReordering] = useState(false);\r\n   const [activeId, setActiveId] = useState<string | null>(null);\r\n   const [overId, setOverId] = useState<UniqueIdentifier | null>(null);\r\n+  const [dayRecommendations, setDayRecommendations] = useState<{[key: number]: RecommendationItem[]}>({});\r\n \r\n   const sensors = useSensors(\r\n     useSensor(PointerSensor, {\r\n       activationConstraint: {\r\n"
                },
                {
                    "date": 1752494987077,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -546,8 +546,77 @@\n       return dest;\r\n     });\r\n   };\r\n \r\n+  // Generate recommendations for a specific day\r\n+  const generateDayRecommendations = (dayNumber: number) => {\r\n+    const dayData = tripDays.find(d => d.day === dayNumber);\r\n+    if (!dayData || dayData.destinations.length === 0) return;\r\n+\r\n+    const recommendations: RecommendationItem[] = [];\r\n+    \r\n+    // Get curated recommendations based on trip location\r\n+    const location = trip.location.toLowerCase();\r\n+    Object.entries(CURATED_RECOMMENDATIONS).forEach(([city, recs]) => {\r\n+      if (location.includes(city)) {\r\n+        recs.forEach((rec, index) => {\r\n+          // Check if this recommendation is already in the trip\r\n+          const isAlreadyAdded = tripDays.some(day => \r\n+            day.destinations.some(dest => \r\n+              Math.abs(dest.lat - rec.lat) < 0.001 && \r\n+              Math.abs(dest.lng - rec.lng) < 0.001\r\n+            )\r\n+          );\r\n+          \r\n+          if (!isAlreadyAdded) {\r\n+            recommendations.push({\r\n+              id: `curated-${city}-${index}-day-${dayNumber}`,\r\n+              ...rec,\r\n+            });\r\n+          }\r\n+        });\r\n+      }\r\n+    });\r\n+\r\n+    // Update state\r\n+    setDayRecommendations(prev => ({\r\n+      ...prev,\r\n+      [dayNumber]: recommendations.slice(0, 3) // Limit to 3 recommendations per day\r\n+    }));\r\n+  };\r\n+\r\n+  // Generate recommendations when days change\r\n+  useEffect(() => {\r\n+    tripDays.forEach(day => {\r\n+      if (day.destinations.length > 0) {\r\n+        generateDayRecommendations(day.day);\r\n+      }\r\n+    });\r\n+  }, [tripDays, trip.location]);\r\n+\r\n+  const handleAddRecommendation = (rec: RecommendationItem, dayNumber: number) => {\r\n+    const dayData = tripDays.find(d => d.day === dayNumber);\r\n+    \r\n+    const newDestination: Destination = {\r\n+      id: crypto.randomUUID(),\r\n+      tripId: trip.id,\r\n+      locationName: rec.name,\r\n+      address: rec.address,\r\n+      lat: rec.lat,\r\n+      lng: rec.lng,\r\n+      day: dayNumber,\r\n+      orderIndex: (dayData?.destinations.length || 0) + 1,\r\n+      notes: rec.description,\r\n+      category: rec.category,\r\n+      rating: rec.rating,\r\n+      photos: rec.photo ? [rec.photo] : [],\r\n+      createdAt: new Date(),\r\n+      updatedAt: new Date(),\r\n+    };\r\n+    \r\n+    onLocationSelect(newDestination);\r\n+  };\r\n+\r\n   return (\r\n     <div className=\"h-full flex flex-col bg-white\">\r\n       {/* Header */}\r\n       <div className=\"p-4 border-b border-gray-200\">\r\n"
                },
                {
                    "date": 1752495006898,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -748,16 +748,51 @@\n                           className=\"w-full\"\r\n                         />\r\n                         \r\n                         {/* Day-specific recommendations */}\r\n-                        {day.destinations.length > 0 && (\r\n+                        {day.destinations.length > 0 && dayRecommendations[day.day] && dayRecommendations[day.day].length > 0 && (\r\n                           <div className=\"mt-3 pt-3 border-t border-gray-100\">\r\n                             <h4 className=\"text-xs font-medium text-gray-600 mb-2\">Recommended nearby</h4>\r\n                             <div className=\"flex space-x-2 overflow-x-auto\">\r\n-                              {/* We'll add recommendations here */}\r\n-                              <div className=\"flex-shrink-0 w-32 h-16 bg-gray-100 rounded-md flex items-center justify-center\">\r\n-                                <span className=\"text-xs text-gray-500\">Loading...</span>\r\n-                              </div>\r\n+                              {dayRecommendations[day.day].map((rec) => (\r\n+                                <div key={rec.id} className=\"flex-shrink-0 w-32 h-16 bg-white border border-gray-200 rounded-md overflow-hidden group hover:shadow-sm transition-shadow\">\r\n+                                  <div className=\"h-full flex\">\r\n+                                    {/* Square image */}\r\n+                                    <div className=\"w-12 h-16 bg-gray-100 flex-shrink-0\">\r\n+                                      {rec.photo ? (\r\n+                                        <img \r\n+                                          src={rec.photo} \r\n+                                          alt={rec.name}\r\n+                                          className=\"w-full h-full object-cover\"\r\n+                                        />\r\n+                                      ) : (\r\n+                                        <div className=\"w-full h-full flex items-center justify-center\">\r\n+                                          <svg className=\"w-3 h-3 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n+                                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z\" />\r\n+                                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 11a3 3 0 11-6 0 3 3 0 016 0z\" />\r\n+                                          </svg>\r\n+                                        </div>\r\n+                                      )}\r\n+                                    </div>\r\n+                                    \r\n+                                    {/* Content */}\r\n+                                    <div className=\"flex-1 p-1.5 flex flex-col justify-between\">\r\n+                                      <div className=\"min-w-0\">\r\n+                                        <p className=\"text-xs font-medium text-gray-900 truncate\">{rec.name}</p>\r\n+                                        <p className=\"text-xs text-gray-500 truncate\">{rec.description}</p>\r\n+                                      </div>\r\n+                                      <button\r\n+                                        onClick={() => handleAddRecommendation(rec, day.day)}\r\n+                                        className=\"self-end w-4 h-4 bg-primary-600 text-white rounded-full flex items-center justify-center hover:bg-primary-700 transition-colors\"\r\n+                                      >\r\n+                                        <svg className=\"w-2.5 h-2.5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n+                                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 6v6m0 0v6m0-6h6m-6 0H6\" />\r\n+                                        </svg>\r\n+                                      </button>\r\n+                                    </div>\r\n+                                  </div>\r\n+                                </div>\r\n+                              ))}\r\n                             </div>\r\n                           </div>\r\n                         )}\r\n                       </div>\r\n"
                },
                {
                    "date": 1752495066590,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,809 +1,622 @@\n-'use client';\r\n-\r\n-import { useState, useEffect, useRef } from 'react';\r\n-import { Trip, Destination, TripDay } from '@/types';\r\n-import { format, parseISO } from 'date-fns';\r\n-import LocationSearch from './LocationSearch';\r\n-import {\r\n-  DndContext,\r\n-  closestCenter,\r\n-  KeyboardSensor,\r\n-  PointerSensor,\r\n-  useSensor,\r\n-  useSensors,\r\n-  DragEndEvent,\r\n-  DragOverEvent,\r\n-  DragOverlay,\r\n-  useDraggable,\r\n-  useDroppable,\r\n-  UniqueIdentifier,\r\n-} from '@dnd-kit/core';\r\n-import {\r\n-  SortableContext,\r\n-  sortableKeyboardCoordinates,\r\n-  verticalListSortingStrategy,\r\n-  useSortable,\r\n-} from '@dnd-kit/sortable';\r\n-import {\r\n-  CSS,\r\n-} from '@dnd-kit/utilities';\r\n-import { reorderDestinations, moveDestinationToDay } from '@/lib/destination-service';\r\n-\r\n-interface RecommendationItem {\r\n-  id: string;\r\n-  name: string;\r\n-  address: string;\r\n-  lat: number;\r\n-  lng: number;\r\n-  category: string;\r\n-  rating?: number;\r\n-  photos?: string[];\r\n-  description: string;\r\n-  photo?: string;\r\n-}\r\n-\r\n-// Curated recommendations\r\n-const CURATED_RECOMMENDATIONS = {\r\n-  tokyo: [\r\n-    {\r\n-      name: 'Senso-ji Temple',\r\n-      address: '2-3-1 Asakusa, Taito City, Tokyo',\r\n-      lat: 35.7148,\r\n-      lng: 139.7967,\r\n-      category: 'tourist_attraction',\r\n-      description: 'Ancient Buddhist temple',\r\n-      photo: 'https://images.unsplash.com/photo-1573822632087-b37c9d73f5f5?w=300&h=200&fit=crop',\r\n-    },\r\n-    {\r\n-      name: 'Shibuya Crossing',\r\n-      address: 'Shibuya City, Tokyo',\r\n-      lat: 35.6598,\r\n-      lng: 139.7006,\r\n-      category: 'point_of_interest',\r\n-      description: 'Famous scramble crossing',\r\n-      photo: 'https://images.unsplash.com/photo-1609813306884-a3b4c2b7f86b?w=300&h=200&fit=crop',\r\n-    },\r\n-    {\r\n-      name: 'Tsukiji Outer Market',\r\n-      address: 'Tsukiji, Chuo City, Tokyo',\r\n-      lat: 35.6654,\r\n-      lng: 139.7707,\r\n-      category: 'food',\r\n-      description: 'Fresh seafood market',\r\n-      photo: 'https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=300&h=200&fit=crop',\r\n-    },\r\n-  ],\r\n-  paris: [\r\n-    {\r\n-      name: 'Eiffel Tower',\r\n-      address: 'Champ de Mars, Paris',\r\n-      lat: 48.8584,\r\n-      lng: 2.2945,\r\n-      category: 'tourist_attraction',\r\n-      description: 'Iconic iron lattice tower',\r\n-      photo: 'https://images.unsplash.com/photo-1511739001486-6bfe10ce785f?w=300&h=200&fit=crop',\r\n-    },\r\n-    {\r\n-      name: 'Louvre Museum',\r\n-      address: 'Rue de Rivoli, Paris',\r\n-      lat: 48.8606,\r\n-      lng: 2.3376,\r\n-      category: 'museum',\r\n-      description: 'World\\'s largest art museum',\r\n-      photo: 'https://images.unsplash.com/photo-1566139327542-1f4c8fdb8e88?w=300&h=200&fit=crop',\r\n-    },\r\n-  ],\r\n-  london: [\r\n-    {\r\n-      name: 'Big Ben',\r\n-      address: 'Westminster, London',\r\n-      lat: 51.5007,\r\n-      lng: -0.1246,\r\n-      category: 'tourist_attraction',\r\n-      description: 'Famous clock tower',\r\n-      photo: 'https://images.unsplash.com/photo-1513635269975-59663e0ac1ad?w=300&h=200&fit=crop',\r\n-    },\r\n-    {\r\n-      name: 'Tower Bridge',\r\n-      address: 'Tower Bridge Rd, London',\r\n-      lat: 51.5055,\r\n-      lng: -0.0754,\r\n-      category: 'tourist_attraction',\r\n-      description: 'Victorian Gothic bridge',\r\n-      photo: 'https://images.unsplash.com/photo-1515920892043-e8b3b7b13bee?w=300&h=200&fit=crop',\r\n-    },\r\n-  ],\r\n-};\r\n-\r\n-interface ItineraryPanelProps {\r\n-  trip: Trip;\r\n-  tripDays: TripDay[];\r\n-  selectedDay: number;\r\n-  selectedDestination: Destination | null;\r\n-  onDaySelect: (day: number) => void;\r\n-  onDestinationSelect: (destination: Destination) => void;\r\n-  onDestinationsChange: (destinations: Destination[]) => void;\r\n-  onLocationSelect: (destination: Destination) => void;\r\n-  onDestinationDelete: (destinationId: string) => void;\r\n-}\r\n-\r\n-// Droppable day container component\r\n-function DroppableDay({ \r\n-  day, \r\n-  children, \r\n-  isOver \r\n-}: { \r\n-  day: TripDay; \r\n-  children: React.ReactNode;\r\n-  isOver: boolean;\r\n-}) {\r\n-  const { setNodeRef } = useDroppable({\r\n-    id: `day-${day.day}`,\r\n-  });\r\n-\r\n-  return (\r\n-    <div \r\n-      ref={setNodeRef}\r\n-      className={`transition-colors ${isOver ? 'bg-blue-50' : ''}`}\r\n-    >\r\n-      {children}\r\n-    </div>\r\n-  );\r\n-}\r\n-\r\n-// Sortable destination item component\r\n-function SortableDestination({ \r\n-  destination, \r\n-  dayColor, \r\n-  selectedDestination,\r\n-  onDestinationSelect,\r\n-  onDestinationDelete,\r\n-  isLastItem \r\n-}: {\r\n-  destination: Destination;\r\n-  dayColor: any;\r\n-  selectedDestination: Destination | null;\r\n-  onDestinationSelect: (destination: Destination) => void;\r\n-  onDestinationDelete: (destinationId: string) => void;\r\n-  isLastItem: boolean;\r\n-}) {\r\n-  const {\r\n-    attributes,\r\n-    listeners,\r\n-    setNodeRef,\r\n-    transform,\r\n-    transition,\r\n-    isDragging,\r\n-  } = useSortable({ id: destination.id });\r\n-\r\n-  const style = {\r\n-    transform: CSS.Transform.toString(transform),\r\n-    transition,\r\n-  };\r\n-\r\n-  const formatTime = (time: string) => {\r\n-    if (!time) return '';\r\n-    try {\r\n-      const [hours, minutes] = time.split(':');\r\n-      const date = new Date();\r\n-      date.setHours(parseInt(hours), parseInt(minutes));\r\n-      return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });\r\n-    } catch {\r\n-      return time;\r\n-    }\r\n-  };\r\n-\r\n-  const isSelected = selectedDestination?.id === destination.id;\r\n-\r\n-  return (\r\n-    <div ref={setNodeRef} style={style} className={isDragging ? 'opacity-50' : ''}>\r\n-      <button\r\n-        onClick={() => onDestinationSelect(destination)}\r\n-        className={`w-full p-4 text-left hover:bg-gray-100 transition-colors group relative ${\r\n-          isSelected ? 'bg-blue-50 border-l-4 border-blue-500' : ''\r\n-        }`}\r\n-      >\r\n-        <div className=\"flex items-start space-x-3\">\r\n-          {/* Drag Handle */}\r\n-          <div \r\n-            {...attributes}\r\n-            {...listeners}\r\n-            className=\"flex-shrink-0 mt-1 cursor-grab active:cursor-grabbing\"\r\n-          >\r\n-            <svg className=\"w-4 h-4 text-gray-400 hover:text-gray-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n-              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 8h16M4 16h16\" />\r\n-            </svg>\r\n-          </div>\r\n-\r\n-          {/* Pin Number - Teardrop shape matching map */}\r\n-          <div className=\"flex-shrink-0 mt-0.5\">\r\n-            <svg \r\n-              width=\"24\" \r\n-              height=\"24\" \r\n-              viewBox=\"0 0 24 24\" \r\n-              className=\"w-6 h-6\"\r\n-            >\r\n-              <path \r\n-                d=\"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z\"\r\n-                fill={isSelected ? '#3B82F6' : dayColor.pin}\r\n-                stroke=\"#FFFFFF\"\r\n-                strokeWidth=\"2\"\r\n-              />\r\n-              <text \r\n-                x=\"12\" \r\n-                y=\"13\" \r\n-                textAnchor=\"middle\" \r\n-                className=\"text-white text-xs font-medium fill-current\"\r\n-                style={{ fontSize: '12px' }}\r\n-              >\r\n-                {destination.orderIndex}\r\n-              </text>\r\n-            </svg>\r\n-          </div>\r\n-          \r\n-          <div className=\"flex-1 min-w-0\">\r\n-            <div className=\"flex items-center justify-between\">\r\n-              <div className=\"flex items-center space-x-2 min-w-0\">\r\n-                <h4 className=\"font-medium text-gray-900 truncate\">\r\n-                  {destination.locationName}\r\n-                </h4>\r\n-                {/* Compact photo for selected destinations */}\r\n-                {isSelected && destination.photos && destination.photos.length > 0 && (\r\n-                  <img \r\n-                    src={destination.photos[0]} \r\n-                    alt={destination.locationName}\r\n-                    className=\"w-8 h-8 object-cover rounded-lg flex-shrink-0\"\r\n-                    onError={(e) => {\r\n-                      (e.target as HTMLImageElement).style.display = 'none';\r\n-                    }}\r\n-                  />\r\n-                )}\r\n-              </div>\r\n-              <div className=\"flex items-center space-x-2\">\r\n-                {destination.startTime && (\r\n-                  <span className=\"text-sm text-gray-500 flex-shrink-0\">\r\n-                    {formatTime(destination.startTime)}\r\n-                  </span>\r\n-                )}\r\n-                <button\r\n-                  onClick={(e) => {\r\n-                    e.stopPropagation();\r\n-                    onDestinationDelete(destination.id);\r\n-                  }}\r\n-                  className=\"text-red-500 hover:text-red-700 hover:bg-red-50 rounded-lg p-1 transition-colors opacity-0 group-hover:opacity-100 flex-shrink-0\"\r\n-                  title=\"Delete destination\"\r\n-                >\r\n-                  <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n-                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\r\n-                  </svg>\r\n-                </button>\r\n-              </div>\r\n-            </div>\r\n-            <p className=\"text-sm text-gray-600 truncate\">\r\n-              {destination.address}\r\n-            </p>\r\n-            {destination.notes && (\r\n-              <p className=\"text-sm text-gray-500 mt-1 line-clamp-2\">\r\n-                {destination.notes}\r\n-              </p>\r\n-            )}\r\n-            \r\n-            {/* Compact details for selected destinations */}\r\n-            {isSelected && (\r\n-              <div className=\"flex items-center space-x-4 mt-2 text-xs\">\r\n-                {destination.category && (\r\n-                  <span className=\"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800\">\r\n-                    {destination.category}\r\n-                  </span>\r\n-                )}\r\n-                {destination.rating && (\r\n-                  <div className=\"flex items-center space-x-1\">\r\n-                    <svg className=\"w-3 h-3 text-yellow-400\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n-                      <path d=\"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z\" />\r\n-                    </svg>\r\n-                    <span className=\"text-gray-600\">{destination.rating}</span>\r\n-                  </div>\r\n-                )}\r\n-                {/* Close button for selected destinations */}\r\n-                <button\r\n-                  onClick={(e) => {\r\n-                    e.stopPropagation();\r\n-                    onDestinationSelect(null as any);\r\n-                  }}\r\n-                  className=\"text-gray-400 hover:text-gray-600 transition-colors\"\r\n-                  title=\"Clear selection\"\r\n-                >\r\n-                  <svg className=\"w-3 h-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n-                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n-                  </svg>\r\n-                </button>\r\n-              </div>\r\n-            )}\r\n-          </div>\r\n-        </div>\r\n-      </button>\r\n-      \r\n-      {/* Connector line */}\r\n-      {!isLastItem && (\r\n-        <div className=\"flex justify-start ml-11\">\r\n-          <div className=\"w-0.5 h-4 bg-gray-300\"></div>\r\n-        </div>\r\n-      )}\r\n-    </div>\r\n-  );\r\n-}\r\n-\r\n-export default function ItineraryPanel({\r\n-  trip,\r\n-  tripDays,\r\n-  selectedDay,\r\n-  selectedDestination,\r\n-  onDaySelect,\r\n-  onDestinationSelect,\r\n-  onDestinationsChange,\r\n-  onLocationSelect,\r\n-  onDestinationDelete,\r\n-}: ItineraryPanelProps) {\r\n-  const [expandedDays, setExpandedDays] = useState<Set<number>>(new Set([1]));\r\n-  const [isReordering, setIsReordering] = useState(false);\r\n-  const [activeId, setActiveId] = useState<string | null>(null);\r\n-  const [overId, setOverId] = useState<UniqueIdentifier | null>(null);\r\n-  const [dayRecommendations, setDayRecommendations] = useState<{[key: number]: RecommendationItem[]}>({});\r\n-\r\n-  const sensors = useSensors(\r\n-    useSensor(PointerSensor, {\r\n-      activationConstraint: {\r\n-        distance: 8,\r\n-      },\r\n-    }),\r\n-    useSensor(KeyboardSensor, {\r\n-      coordinateGetter: sortableKeyboardCoordinates,\r\n-    })\r\n-  );\r\n-\r\n-  const toggleDay = (day: number) => {\r\n-    const newExpanded = new Set(expandedDays);\r\n-    if (newExpanded.has(day)) {\r\n-      newExpanded.delete(day);\r\n-    } else {\r\n-      newExpanded.add(day);\r\n-    }\r\n-    setExpandedDays(newExpanded);\r\n-    onDaySelect(day);\r\n-  };\r\n-\r\n-  // Get all destinations for sortable context\r\n-  const allDestinations = tripDays.flatMap(day => day.destinations);\r\n-\r\n-  const handleDragStart = (event: any) => {\r\n-    setActiveId(event.active.id);\r\n-  };\r\n-\r\n-  const handleDragOver = (event: DragOverEvent) => {\r\n-    setOverId(event.over?.id || null);\r\n-  };\r\n-\r\n-  const handleDragEnd = async (event: DragEndEvent) => {\r\n-    const { active, over } = event;\r\n-    \r\n-    setActiveId(null);\r\n-    setOverId(null);\r\n-    \r\n-    if (!over || active.id === over.id) {\r\n-      return;\r\n-    }\r\n-\r\n-    const draggedDestination = allDestinations.find(dest => dest.id === active.id);\r\n-    if (!draggedDestination) return;\r\n-\r\n-    setIsReordering(true);\r\n-\r\n-    try {\r\n-      // Check if we're dropping on a day container or another destination\r\n-      const isDroppedOnDay = over.id.toString().startsWith('day-');\r\n-      \r\n-      if (isDroppedOnDay) {\r\n-        // Cross-day drop - move to end of target day\r\n-        const targetDay = parseInt(over.id.toString().replace('day-', ''));\r\n-        const targetDayData = tripDays.find(d => d.day === targetDay);\r\n-        \r\n-        if (targetDayData && targetDay !== draggedDestination.day) {\r\n-          // Calculate proper sequential order index\r\n-          const newOrderIndex = targetDayData.destinations.length + 1;\r\n-          \r\n-          // Update in database\r\n-          await moveDestinationToDay(draggedDestination.id, targetDay, newOrderIndex);\r\n-          \r\n-          // Create updated destinations with proper renumbering\r\n-          const updatedDestinations = allDestinations.map(dest => {\r\n-            if (dest.id === draggedDestination.id) {\r\n-              return {\r\n-                ...dest,\r\n-                day: targetDay,\r\n-                orderIndex: newOrderIndex\r\n-              };\r\n-            }\r\n-            return dest;\r\n-          });\r\n-\r\n-          // Renumber all destinations in both source and target days\r\n-          const finalDestinations = renumberDestinationsInDays(updatedDestinations, [draggedDestination.day, targetDay]);\r\n-          \r\n-          onDestinationsChange(finalDestinations);\r\n-        }\r\n-      } else {\r\n-        // Same day or destination-to-destination drop\r\n-        const targetDestination = allDestinations.find(dest => dest.id === over.id);\r\n-        if (!targetDestination) return;\r\n-\r\n-        const sourceDay = draggedDestination.day;\r\n-        const targetDay = targetDestination.day;\r\n-\r\n-        if (sourceDay === targetDay) {\r\n-          // Same day reordering\r\n-          const dayData = tripDays.find(d => d.day === sourceDay);\r\n-          if (!dayData) return;\r\n-\r\n-          const oldIndex = dayData.destinations.findIndex(dest => dest.id === active.id);\r\n-          const newIndex = dayData.destinations.findIndex(dest => dest.id === over.id);\r\n-\r\n-          if (oldIndex === newIndex) return;\r\n-\r\n-          // Create new order array\r\n-          const newDestinations = [...dayData.destinations];\r\n-          const [movedItem] = newDestinations.splice(oldIndex, 1);\r\n-          newDestinations.splice(newIndex, 0, movedItem);\r\n-\r\n-          // Update order indices sequentially\r\n-          const reorderedDestinations = newDestinations.map((dest, index) => ({\r\n-            ...dest,\r\n-            orderIndex: index + 1\r\n-          }));\r\n-\r\n-          // Update destinations in parent component\r\n-          const updatedAllDestinations = allDestinations.map(dest => {\r\n-            const updated = reorderedDestinations.find(rd => rd.id === dest.id);\r\n-            return updated || dest;\r\n-          });\r\n-          \r\n-          onDestinationsChange(updatedAllDestinations);\r\n-\r\n-          // Save to database\r\n-          const destinationIds = reorderedDestinations.map(dest => dest.id);\r\n-          await reorderDestinations(trip.id, sourceDay, destinationIds);\r\n-        } else {\r\n-          // Cross-day drop next to specific destination\r\n-          const targetDayData = tripDays.find(d => d.day === targetDay);\r\n-          if (!targetDayData) return;\r\n-\r\n-          const targetIndex = targetDayData.destinations.findIndex(dest => dest.id === over.id);\r\n-          \r\n-          // Insert the destination at the target position\r\n-          const updatedTargetDestinations = [...targetDayData.destinations];\r\n-          updatedTargetDestinations.splice(targetIndex + 1, 0, {\r\n-            ...draggedDestination,\r\n-            day: targetDay,\r\n-            orderIndex: targetIndex + 2 // Temporary index, will be renumbered\r\n-          });\r\n-\r\n-          // Update in database with proper order index\r\n-          await moveDestinationToDay(draggedDestination.id, targetDay, targetIndex + 2);\r\n-\r\n-          // Create updated destinations array\r\n-          const updatedDestinations = allDestinations\r\n-            .filter(dest => dest.id !== draggedDestination.id) // Remove from source\r\n-            .map(dest => {\r\n-              // Update target day destinations\r\n-              if (dest.day === targetDay) {\r\n-                const updated = updatedTargetDestinations.find(rd => rd.id === dest.id);\r\n-                return updated || dest;\r\n-              }\r\n-              return dest;\r\n-            })\r\n-            .concat([{\r\n-              ...draggedDestination,\r\n-              day: targetDay,\r\n-              orderIndex: targetIndex + 2 // Temporary, will be renumbered\r\n-            }]);\r\n-\r\n-          // Renumber all destinations in both affected days\r\n-          const finalDestinations = renumberDestinationsInDays(updatedDestinations, [sourceDay, targetDay]);\r\n-          \r\n-          onDestinationsChange(finalDestinations);\r\n-\r\n-          // Reorder target day in database with proper sequential IDs\r\n-          const targetDayDestinations = finalDestinations.filter(dest => dest.day === targetDay);\r\n-          const targetDayIds = targetDayDestinations\r\n-            .sort((a, b) => (a.orderIndex || 0) - (b.orderIndex || 0))\r\n-            .map(dest => dest.id);\r\n-          await reorderDestinations(trip.id, targetDay, targetDayIds);\r\n-        }\r\n-      }\r\n-    } catch (error) {\r\n-      console.error('Error handling drag:', error);\r\n-    } finally {\r\n-      setIsReordering(false);\r\n-    }\r\n-  };\r\n-\r\n-  // Helper function to renumber destinations sequentially within specified days\r\n-  const renumberDestinationsInDays = (destinations: Destination[], daysToRenumber: number[]): Destination[] => {\r\n-    return destinations.map(dest => {\r\n-      if (daysToRenumber.includes(dest.day)) {\r\n-        // Get all destinations for this day and sort by current order\r\n-        const dayDestinations = destinations\r\n-          .filter(d => d.day === dest.day)\r\n-          .sort((a, b) => (a.orderIndex || 0) - (b.orderIndex || 0));\r\n-        \r\n-        // Find the new sequential index\r\n-        const newIndex = dayDestinations.findIndex(d => d.id === dest.id) + 1;\r\n-        \r\n-        return {\r\n-          ...dest,\r\n-          orderIndex: newIndex\r\n-        };\r\n-      }\r\n-      return dest;\r\n-    });\r\n-  };\r\n-\r\n-  // Generate recommendations for a specific day\r\n-  const generateDayRecommendations = (dayNumber: number) => {\r\n-    const dayData = tripDays.find(d => d.day === dayNumber);\r\n-    if (!dayData || dayData.destinations.length === 0) return;\r\n-\r\n-    const recommendations: RecommendationItem[] = [];\r\n-    \r\n-    // Get curated recommendations based on trip location\r\n-    const location = trip.location.toLowerCase();\r\n-    Object.entries(CURATED_RECOMMENDATIONS).forEach(([city, recs]) => {\r\n-      if (location.includes(city)) {\r\n-        recs.forEach((rec, index) => {\r\n-          // Check if this recommendation is already in the trip\r\n-          const isAlreadyAdded = tripDays.some(day => \r\n-            day.destinations.some(dest => \r\n-              Math.abs(dest.lat - rec.lat) < 0.001 && \r\n-              Math.abs(dest.lng - rec.lng) < 0.001\r\n-            )\r\n-          );\r\n-          \r\n-          if (!isAlreadyAdded) {\r\n-            recommendations.push({\r\n-              id: `curated-${city}-${index}-day-${dayNumber}`,\r\n-              ...rec,\r\n-            });\r\n-          }\r\n-        });\r\n-      }\r\n-    });\r\n-\r\n-    // Update state\r\n-    setDayRecommendations(prev => ({\r\n-      ...prev,\r\n-      [dayNumber]: recommendations.slice(0, 3) // Limit to 3 recommendations per day\r\n-    }));\r\n-  };\r\n-\r\n-  // Generate recommendations when days change\r\n-  useEffect(() => {\r\n-    tripDays.forEach(day => {\r\n-      if (day.destinations.length > 0) {\r\n-        generateDayRecommendations(day.day);\r\n-      }\r\n-    });\r\n-  }, [tripDays, trip.location]);\r\n-\r\n-  const handleAddRecommendation = (rec: RecommendationItem, dayNumber: number) => {\r\n-    const dayData = tripDays.find(d => d.day === dayNumber);\r\n-    \r\n-    const newDestination: Destination = {\r\n-      id: crypto.randomUUID(),\r\n-      tripId: trip.id,\r\n-      locationName: rec.name,\r\n-      address: rec.address,\r\n-      lat: rec.lat,\r\n-      lng: rec.lng,\r\n-      day: dayNumber,\r\n-      orderIndex: (dayData?.destinations.length || 0) + 1,\r\n-      notes: rec.description,\r\n-      category: rec.category,\r\n-      rating: rec.rating,\r\n-      photos: rec.photo ? [rec.photo] : [],\r\n-      createdAt: new Date(),\r\n-      updatedAt: new Date(),\r\n-    };\r\n-    \r\n-    onLocationSelect(newDestination);\r\n-  };\r\n-\r\n-  return (\r\n-    <div className=\"h-full flex flex-col bg-white\">\r\n-      {/* Header */}\r\n-      <div className=\"p-4 border-b border-gray-200\">\r\n-        <div className=\"flex items-center justify-between\">\r\n-          <div>\r\n-            <h2 className=\"text-lg font-semibold text-gray-900\">Itinerary</h2>\r\n-            <p className=\"text-sm text-gray-600\">\r\n-              {tripDays.length} days • {tripDays.reduce((acc, day) => acc + day.destinations.length, 0)} destinations\r\n-            </p>\r\n-          </div>\r\n-          {isReordering && (\r\n-            <div className=\"flex items-center text-sm text-gray-500\">\r\n-              <svg className=\"animate-spin -ml-1 mr-2 h-4 w-4\" fill=\"none\" viewBox=\"0 0 24 24\">\r\n-                <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle>\r\n-                <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\r\n-              </svg>\r\n-              Updating...\r\n-            </div>\r\n-          )}\r\n-        </div>\r\n-      </div>\r\n-\r\n-      {/* Days List with Cross-Day Dragging */}\r\n-      <div className=\"flex-1 overflow-y-auto\">\r\n-        <DndContext\r\n-          sensors={sensors}\r\n-          collisionDetection={closestCenter}\r\n-          onDragStart={handleDragStart}\r\n-          onDragOver={handleDragOver}\r\n-          onDragEnd={handleDragEnd}\r\n-        >\r\n-          <SortableContext \r\n-            items={allDestinations.map(dest => dest.id)}\r\n-            strategy={verticalListSortingStrategy}\r\n-          >\r\n-            {tripDays.map((day) => (\r\n-              <DroppableDay\r\n-                key={day.day}\r\n-                day={day}\r\n-                isOver={overId === `day-${day.day}`}\r\n-              >\r\n-                <div className=\"border-b border-gray-100 last:border-b-0\">\r\n-                  {/* Day Header */}\r\n-                  <button\r\n-                    onClick={() => toggleDay(day.day)}\r\n-                    className={`w-full p-4 text-left hover:bg-gray-50 transition-colors ${\r\n-                      selectedDay === day.day ? 'bg-blue-50' : ''\r\n-                    }`}\r\n-                  >\r\n-                    <div className=\"flex items-center justify-between\">\r\n-                      <div className=\"flex items-center space-x-3\">\r\n-                        <div \r\n-                          className={`w-6 h-6 rounded-full flex items-center justify-center text-white text-sm font-medium`}\r\n-                          style={{ backgroundColor: day.color.pin }}\r\n-                        >\r\n-                          {day.day}\r\n-                        </div>\r\n-                        <div>\r\n-                          <h3 className=\"font-medium text-gray-900\">\r\n-                            Day {day.day}\r\n-                          </h3>\r\n-                          <p className=\"text-sm text-gray-600\">\r\n-                            {format(parseISO(day.date), 'MMM d, yyyy')}\r\n-                          </p>\r\n-                        </div>\r\n-                      </div>\r\n-                      <div className=\"flex items-center space-x-2\">\r\n-                        <span className=\"text-sm text-gray-500\">\r\n-                          {day.destinations.length} stops\r\n-                        </span>\r\n-                        <svg \r\n-                          className={`w-4 h-4 text-gray-400 transition-transform ${\r\n-                            expandedDays.has(day.day) ? 'rotate-180' : ''\r\n-                          }`}\r\n-                          fill=\"none\" \r\n-                          stroke=\"currentColor\" \r\n-                          viewBox=\"0 0 24 24\"\r\n-                        >\r\n-                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\r\n-                        </svg>\r\n-                      </div>\r\n-                    </div>\r\n-                  </button>\r\n-\r\n-                  {/* Destinations List */}\r\n-                  {expandedDays.has(day.day) && (\r\n-                    <div className=\"bg-gray-50\">\r\n-                      {day.destinations.length === 0 ? (\r\n-                        <div className=\"p-4 text-center text-gray-500\">\r\n-                          <svg className=\"w-12 h-12 mx-auto mb-2 text-gray-300\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n-                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z\" />\r\n-                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 11a3 3 0 11-6 0 3 3 0 016 0z\" />\r\n-                          </svg>\r\n-                          <p className=\"text-sm\">No destinations added yet</p>\r\n-                          <p className=\"text-xs text-gray-400 mt-1\">Click on the map to add destinations</p>\r\n-                        </div>\r\n-                      ) : (\r\n-                        <div className=\"space-y-0\">\r\n-                          {day.destinations.map((destination, index) => (\r\n-                            <SortableDestination\r\n-                              key={destination.id}\r\n-                              destination={destination}\r\n-                              dayColor={day.color}\r\n-                              selectedDestination={selectedDestination}\r\n-                              onDestinationSelect={onDestinationSelect}\r\n-                              onDestinationDelete={onDestinationDelete}\r\n-                              isLastItem={index === day.destinations.length - 1}\r\n-                            />\r\n-                          ))}\r\n-                        </div>\r\n-                      )}\r\n-                      \r\n-                      {/* Add Destination - Location Search */}\r\n-                      <div className=\"p-4 border-t border-gray-200\">\r\n-                        <LocationSearch\r\n-                          onLocationSelect={(destination) => {\r\n-                            // Set the destination's day and order index\r\n-                            const updatedDestination = {\r\n-                              ...destination,\r\n-                              day: day.day,\r\n-                              orderIndex: day.destinations.length + 1,\r\n-                            };\r\n-                            onLocationSelect(updatedDestination);\r\n-                            onDaySelect(day.day);\r\n-                          }}\r\n-                          selectedDay={day.day}\r\n-                          tripId={trip.id}\r\n-                          placeholder={`Search places for Day ${day.day}...`}\r\n-                          className=\"w-full\"\r\n-                        />\r\n-                        \r\n-                        {/* Day-specific recommendations */}\r\n-                        {day.destinations.length > 0 && dayRecommendations[day.day] && dayRecommendations[day.day].length > 0 && (\r\n-                          <div className=\"mt-3 pt-3 border-t border-gray-100\">\r\n-                            <h4 className=\"text-xs font-medium text-gray-600 mb-2\">Recommended nearby</h4>\r\n-                            <div className=\"flex space-x-2 overflow-x-auto\">\r\n-                              {dayRecommendations[day.day].map((rec) => (\r\n-                                <div key={rec.id} className=\"flex-shrink-0 w-32 h-16 bg-white border border-gray-200 rounded-md overflow-hidden group hover:shadow-sm transition-shadow\">\r\n-                                  <div className=\"h-full flex\">\r\n-                                    {/* Square image */}\r\n-                                    <div className=\"w-12 h-16 bg-gray-100 flex-shrink-0\">\r\n-                                      {rec.photo ? (\r\n-                                        <img \r\n-                                          src={rec.photo} \r\n-                                          alt={rec.name}\r\n-                                          className=\"w-full h-full object-cover\"\r\n-                                        />\r\n-                                      ) : (\r\n-                                        <div className=\"w-full h-full flex items-center justify-center\">\r\n-                                          <svg className=\"w-3 h-3 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n-                                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z\" />\r\n-                                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 11a3 3 0 11-6 0 3 3 0 016 0z\" />\r\n-                                          </svg>\r\n-                                        </div>\r\n-                                      )}\r\n-                                    </div>\r\n-                                    \r\n-                                    {/* Content */}\r\n-                                    <div className=\"flex-1 p-1.5 flex flex-col justify-between\">\r\n-                                      <div className=\"min-w-0\">\r\n-                                        <p className=\"text-xs font-medium text-gray-900 truncate\">{rec.name}</p>\r\n-                                        <p className=\"text-xs text-gray-500 truncate\">{rec.description}</p>\r\n-                                      </div>\r\n-                                      <button\r\n-                                        onClick={() => handleAddRecommendation(rec, day.day)}\r\n-                                        className=\"self-end w-4 h-4 bg-primary-600 text-white rounded-full flex items-center justify-center hover:bg-primary-700 transition-colors\"\r\n-                                      >\r\n-                                        <svg className=\"w-2.5 h-2.5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n-                                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 6v6m0 0v6m0-6h6m-6 0H6\" />\r\n-                                        </svg>\r\n-                                      </button>\r\n-                                    </div>\r\n-                                  </div>\r\n-                                </div>\r\n-                              ))}\r\n-                            </div>\r\n-                          </div>\r\n-                        )}\r\n-                      </div>\r\n-                    </div>\r\n-                  )}\r\n-                </div>\r\n-              </DroppableDay>\r\n-            ))}\r\n-          </SortableContext>\r\n-        </DndContext>\r\n-      </div>\r\n-    </div>\r\n-  );\r\n+'use client';\n+\n+import { useState } from 'react';\n+import { Trip, Destination, TripDay } from '@/types';\n+import { format, parseISO } from 'date-fns';\n+import LocationSearch from './LocationSearch';\n+import SmartRecommendations from './SmartRecommendations';\n+import {\n+  DndContext,\n+  closestCenter,\n+  KeyboardSensor,\n+  PointerSensor,\n+  useSensor,\n+  useSensors,\n+  DragEndEvent,\n+  DragOverEvent,\n+  DragOverlay,\n+  useDraggable,\n+  useDroppable,\n+  UniqueIdentifier,\n+} from '@dnd-kit/core';\n+import {\n+  SortableContext,\n+  sortableKeyboardCoordinates,\n+  verticalListSortingStrategy,\n+  useSortable,\n+} from '@dnd-kit/sortable';\n+import {\n+  CSS,\n+} from '@dnd-kit/utilities';\n+import { reorderDestinations, moveDestinationToDay } from '@/lib/destination-service';\n+\n+interface ItineraryPanelProps {\n+  trip: Trip;\n+  tripDays: TripDay[];\n+  selectedDay: number;\n+  selectedDestination: Destination | null;\n+  onDaySelect: (day: number) => void;\n+  onDestinationSelect: (destination: Destination) => void;\n+  onDestinationsChange: (destinations: Destination[]) => void;\n+  onLocationSelect: (destination: Destination) => void;\n+  onDestinationDelete: (destinationId: string) => void;\n+}\n+\n+// Droppable day container component\n+function DroppableDay({ \n+  day, \n+  children, \n+  isOver \n+}: { \n+  day: TripDay; \n+  children: React.ReactNode;\n+  isOver: boolean;\n+}) {\n+  const { setNodeRef } = useDroppable({\n+    id: `day-${day.day}`,\n+  });\n+\n+  return (\n+    <div \n+      ref={setNodeRef}\n+      className={`transition-colors ${isOver ? 'bg-blue-50' : ''}`}\n+    >\n+      {children}\n+    </div>\n+  );\n+}\n+\n+// Sortable destination item component\n+function SortableDestination({ \n+  destination, \n+  dayColor, \n+  selectedDestination,\n+  onDestinationSelect,\n+  onDestinationDelete,\n+  isLastItem \n+}: {\n+  destination: Destination;\n+  dayColor: any;\n+  selectedDestination: Destination | null;\n+  onDestinationSelect: (destination: Destination) => void;\n+  onDestinationDelete: (destinationId: string) => void;\n+  isLastItem: boolean;\n+}) {\n+  const {\n+    attributes,\n+    listeners,\n+    setNodeRef,\n+    transform,\n+    transition,\n+    isDragging,\n+  } = useSortable({ id: destination.id });\n+\n+  const style = {\n+    transform: CSS.Transform.toString(transform),\n+    transition,\n+  };\n+\n+  const formatTime = (time: string) => {\n+    if (!time) return '';\n+    try {\n+      const [hours, minutes] = time.split(':');\n+      const date = new Date();\n+      date.setHours(parseInt(hours), parseInt(minutes));\n+      return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });\n+    } catch {\n+      return time;\n+    }\n+  };\n+\n+  const isSelected = selectedDestination?.id === destination.id;\n+\n+  return (\n+    <div ref={setNodeRef} style={style} className={isDragging ? 'opacity-50' : ''}>\n+      <button\n+        onClick={() => onDestinationSelect(destination)}\n+        className={`w-full p-4 text-left hover:bg-gray-100 transition-colors group relative ${\n+          isSelected ? 'bg-blue-50 border-l-4 border-blue-500' : ''\n+        }`}\n+      >\n+        <div className=\"flex items-start space-x-3\">\n+          {/* Drag Handle */}\n+          <div \n+            {...attributes}\n+            {...listeners}\n+            className=\"flex-shrink-0 mt-1 cursor-grab active:cursor-grabbing\"\n+          >\n+            <svg className=\"w-4 h-4 text-gray-400 hover:text-gray-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n+              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 8h16M4 16h16\" />\n+            </svg>\n+          </div>\n+\n+          {/* Pin Number - Teardrop shape matching map */}\n+          <div className=\"flex-shrink-0 mt-0.5\">\n+            <svg \n+              width=\"24\" \n+              height=\"24\" \n+              viewBox=\"0 0 24 24\" \n+              className=\"w-6 h-6\"\n+            >\n+              <path \n+                d=\"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z\"\n+                fill={isSelected ? '#3B82F6' : dayColor.pin}\n+                stroke=\"#FFFFFF\"\n+                strokeWidth=\"2\"\n+              />\n+              <text \n+                x=\"12\" \n+                y=\"13\" \n+                textAnchor=\"middle\" \n+                className=\"text-white text-xs font-medium fill-current\"\n+                style={{ fontSize: '12px' }}\n+              >\n+                {destination.orderIndex}\n+              </text>\n+            </svg>\n+          </div>\n+          \n+          <div className=\"flex-1 min-w-0\">\n+            <div className=\"flex items-center justify-between\">\n+              <div className=\"flex items-center space-x-2 min-w-0\">\n+                <h4 className=\"font-medium text-gray-900 truncate\">\n+                  {destination.locationName}\n+                </h4>\n+                {/* Compact photo for selected destinations */}\n+                {isSelected && destination.photos && destination.photos.length > 0 && (\n+                  <img \n+                    src={destination.photos[0]} \n+                    alt={destination.locationName}\n+                    className=\"w-8 h-8 object-cover rounded-lg flex-shrink-0\"\n+                    onError={(e) => {\n+                      (e.target as HTMLImageElement).style.display = 'none';\n+                    }}\n+                  />\n+                )}\n+              </div>\n+              <div className=\"flex items-center space-x-2\">\n+                {destination.startTime && (\n+                  <span className=\"text-sm text-gray-500 flex-shrink-0\">\n+                    {formatTime(destination.startTime)}\n+                  </span>\n+                )}\n+                <button\n+                  onClick={(e) => {\n+                    e.stopPropagation();\n+                    onDestinationDelete(destination.id);\n+                  }}\n+                  className=\"text-red-500 hover:text-red-700 hover:bg-red-50 rounded-lg p-1 transition-colors opacity-0 group-hover:opacity-100 flex-shrink-0\"\n+                  title=\"Delete destination\"\n+                >\n+                  <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n+                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\n+                  </svg>\n+                </button>\n+              </div>\n+            </div>\n+            <p className=\"text-sm text-gray-600 truncate\">\n+              {destination.address}\n+            </p>\n+            {destination.notes && (\n+              <p className=\"text-sm text-gray-500 mt-1 line-clamp-2\">\n+                {destination.notes}\n+              </p>\n+            )}\n+            \n+            {/* Compact details for selected destinations */}\n+            {isSelected && (\n+              <div className=\"flex items-center space-x-4 mt-2 text-xs\">\n+                {destination.category && (\n+                  <span className=\"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800\">\n+                    {destination.category}\n+                  </span>\n+                )}\n+                {destination.rating && (\n+                  <div className=\"flex items-center space-x-1\">\n+                    <svg className=\"w-3 h-3 text-yellow-400\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n+                      <path d=\"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z\" />\n+                    </svg>\n+                    <span className=\"text-gray-600\">{destination.rating}</span>\n+                  </div>\n+                )}\n+                {/* Close button for selected destinations */}\n+                <button\n+                  onClick={(e) => {\n+                    e.stopPropagation();\n+                    onDestinationSelect(null as any);\n+                  }}\n+                  className=\"text-gray-400 hover:text-gray-600 transition-colors\"\n+                  title=\"Clear selection\"\n+                >\n+                  <svg className=\"w-3 h-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n+                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n+                  </svg>\n+                </button>\n+              </div>\n+            )}\n+          </div>\n+        </div>\n+      </button>\n+      \n+      {/* Connector line */}\n+      {!isLastItem && (\n+        <div className=\"flex justify-start ml-11\">\n+          <div className=\"w-0.5 h-4 bg-gray-300\"></div>\n+        </div>\n+      )}\n+    </div>\n+  );\n+}\n+\n+export default function ItineraryPanel({\n+  trip,\n+  tripDays,\n+  selectedDay,\n+  selectedDestination,\n+  onDaySelect,\n+  onDestinationSelect,\n+  onDestinationsChange,\n+  onLocationSelect,\n+  onDestinationDelete,\n+}: ItineraryPanelProps) {\n+  const [expandedDays, setExpandedDays] = useState<Set<number>>(new Set([1]));\n+  const [isReordering, setIsReordering] = useState(false);\n+  const [activeId, setActiveId] = useState<string | null>(null);\n+  const [overId, setOverId] = useState<UniqueIdentifier | null>(null);\n+\n+  const sensors = useSensors(\n+    useSensor(PointerSensor, {\n+      activationConstraint: {\n+        distance: 8,\n+      },\n+    }),\n+    useSensor(KeyboardSensor, {\n+      coordinateGetter: sortableKeyboardCoordinates,\n+    })\n+  );\n+\n+  const toggleDay = (day: number) => {\n+    const newExpanded = new Set(expandedDays);\n+    if (newExpanded.has(day)) {\n+      newExpanded.delete(day);\n+    } else {\n+      newExpanded.add(day);\n+    }\n+    setExpandedDays(newExpanded);\n+    onDaySelect(day);\n+  };\n+\n+  // Get all destinations for sortable context\n+  const allDestinations = tripDays.flatMap(day => day.destinations);\n+\n+  const handleDragStart = (event: any) => {\n+    setActiveId(event.active.id);\n+  };\n+\n+  const handleDragOver = (event: DragOverEvent) => {\n+    setOverId(event.over?.id || null);\n+  };\n+\n+  const handleDragEnd = async (event: DragEndEvent) => {\n+    const { active, over } = event;\n+    \n+    setActiveId(null);\n+    setOverId(null);\n+    \n+    if (!over || active.id === over.id) {\n+      return;\n+    }\n+\n+    const draggedDestination = allDestinations.find(dest => dest.id === active.id);\n+    if (!draggedDestination) return;\n+\n+    setIsReordering(true);\n+\n+    try {\n+      // Check if we're dropping on a day container or another destination\n+      const isDroppedOnDay = over.id.toString().startsWith('day-');\n+      \n+      if (isDroppedOnDay) {\n+        // Cross-day drop - move to end of target day\n+        const targetDay = parseInt(over.id.toString().replace('day-', ''));\n+        const targetDayData = tripDays.find(d => d.day === targetDay);\n+        \n+        if (targetDayData && targetDay !== draggedDestination.day) {\n+          // Calculate proper sequential order index\n+          const newOrderIndex = targetDayData.destinations.length + 1;\n+          \n+          // Update in database\n+          await moveDestinationToDay(draggedDestination.id, targetDay, newOrderIndex);\n+          \n+          // Create updated destinations with proper renumbering\n+          const updatedDestinations = allDestinations.map(dest => {\n+            if (dest.id === draggedDestination.id) {\n+              return {\n+                ...dest,\n+                day: targetDay,\n+                orderIndex: newOrderIndex\n+              };\n+            }\n+            return dest;\n+          });\n+\n+          // Renumber all destinations in both source and target days\n+          const finalDestinations = renumberDestinationsInDays(updatedDestinations, [draggedDestination.day, targetDay]);\n+          \n+          onDestinationsChange(finalDestinations);\n+        }\n+      } else {\n+        // Same day or destination-to-destination drop\n+        const targetDestination = allDestinations.find(dest => dest.id === over.id);\n+        if (!targetDestination) return;\n+\n+        const sourceDay = draggedDestination.day;\n+        const targetDay = targetDestination.day;\n+\n+        if (sourceDay === targetDay) {\n+          // Same day reordering\n+          const dayData = tripDays.find(d => d.day === sourceDay);\n+          if (!dayData) return;\n+\n+          const oldIndex = dayData.destinations.findIndex(dest => dest.id === active.id);\n+          const newIndex = dayData.destinations.findIndex(dest => dest.id === over.id);\n+\n+          if (oldIndex === newIndex) return;\n+\n+          // Create new order array\n+          const newDestinations = [...dayData.destinations];\n+          const [movedItem] = newDestinations.splice(oldIndex, 1);\n+          newDestinations.splice(newIndex, 0, movedItem);\n+\n+          // Update order indices sequentially\n+          const reorderedDestinations = newDestinations.map((dest, index) => ({\n+            ...dest,\n+            orderIndex: index + 1\n+          }));\n+\n+          // Update destinations in parent component\n+          const updatedAllDestinations = allDestinations.map(dest => {\n+            const updated = reorderedDestinations.find(rd => rd.id === dest.id);\n+            return updated || dest;\n+          });\n+          \n+          onDestinationsChange(updatedAllDestinations);\n+\n+          // Save to database\n+          const destinationIds = reorderedDestinations.map(dest => dest.id);\n+          await reorderDestinations(trip.id, sourceDay, destinationIds);\n+        } else {\n+          // Cross-day drop next to specific destination\n+          const targetDayData = tripDays.find(d => d.day === targetDay);\n+          if (!targetDayData) return;\n+\n+          const targetIndex = targetDayData.destinations.findIndex(dest => dest.id === over.id);\n+          \n+          // Insert the destination at the target position\n+          const updatedTargetDestinations = [...targetDayData.destinations];\n+          updatedTargetDestinations.splice(targetIndex + 1, 0, {\n+            ...draggedDestination,\n+            day: targetDay,\n+            orderIndex: targetIndex + 2 // Temporary index, will be renumbered\n+          });\n+\n+          // Update in database with proper order index\n+          await moveDestinationToDay(draggedDestination.id, targetDay, targetIndex + 2);\n+\n+          // Create updated destinations array\n+          const updatedDestinations = allDestinations\n+            .filter(dest => dest.id !== draggedDestination.id) // Remove from source\n+            .map(dest => {\n+              // Update target day destinations\n+              if (dest.day === targetDay) {\n+                const updated = updatedTargetDestinations.find(rd => rd.id === dest.id);\n+                return updated || dest;\n+              }\n+              return dest;\n+            })\n+            .concat([{\n+              ...draggedDestination,\n+              day: targetDay,\n+              orderIndex: targetIndex + 2 // Temporary, will be renumbered\n+            }]);\n+\n+          // Renumber all destinations in both affected days\n+          const finalDestinations = renumberDestinationsInDays(updatedDestinations, [sourceDay, targetDay]);\n+          \n+          onDestinationsChange(finalDestinations);\n+\n+          // Reorder target day in database with proper sequential IDs\n+          const targetDayDestinations = finalDestinations.filter(dest => dest.day === targetDay);\n+          const targetDayIds = targetDayDestinations\n+            .sort((a, b) => (a.orderIndex || 0) - (b.orderIndex || 0))\n+            .map(dest => dest.id);\n+          await reorderDestinations(trip.id, targetDay, targetDayIds);\n+        }\n+      }\n+    } catch (error) {\n+      console.error('Error handling drag:', error);\n+    } finally {\n+      setIsReordering(false);\n+    }\n+  };\n+\n+  // Helper function to renumber destinations sequentially within specified days\n+  const renumberDestinationsInDays = (destinations: Destination[], daysToRenumber: number[]): Destination[] => {\n+    return destinations.map(dest => {\n+      if (daysToRenumber.includes(dest.day)) {\n+        // Get all destinations for this day and sort by current order\n+        const dayDestinations = destinations\n+          .filter(d => d.day === dest.day)\n+          .sort((a, b) => (a.orderIndex || 0) - (b.orderIndex || 0));\n+        \n+        // Find the new sequential index\n+        const newIndex = dayDestinations.findIndex(d => d.id === dest.id) + 1;\n+        \n+        return {\n+          ...dest,\n+          orderIndex: newIndex\n+        };\n+      }\n+      return dest;\n+    });\n+  };\n+\n+  return (\n+    <div className=\"h-full flex flex-col bg-white\">\n+      {/* Header */}\n+      <div className=\"p-4 border-b border-gray-200\">\n+        <div className=\"flex items-center justify-between\">\n+          <div>\n+            <h2 className=\"text-lg font-semibold text-gray-900\">Itinerary</h2>\n+            <p className=\"text-sm text-gray-600\">\n+              {tripDays.length} days • {tripDays.reduce((acc, day) => acc + day.destinations.length, 0)} destinations\n+            </p>\n+          </div>\n+          {isReordering && (\n+            <div className=\"flex items-center text-sm text-gray-500\">\n+              <svg className=\"animate-spin -ml-1 mr-2 h-4 w-4\" fill=\"none\" viewBox=\"0 0 24 24\">\n+                <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle>\n+                <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\n+              </svg>\n+              Updating...\n+            </div>\n+          )}\n+        </div>\n+      </div>\n+\n+      {/* Days List with Cross-Day Dragging */}\n+      <div className=\"flex-1 overflow-y-auto\">\n+        <DndContext\n+          sensors={sensors}\n+          collisionDetection={closestCenter}\n+          onDragStart={handleDragStart}\n+          onDragOver={handleDragOver}\n+          onDragEnd={handleDragEnd}\n+        >\n+          <SortableContext \n+            items={allDestinations.map(dest => dest.id)}\n+            strategy={verticalListSortingStrategy}\n+          >\n+            {tripDays.map((day) => (\n+              <DroppableDay\n+                key={day.day}\n+                day={day}\n+                isOver={overId === `day-${day.day}`}\n+              >\n+                <div className=\"border-b border-gray-100 last:border-b-0\">\n+                  {/* Day Header */}\n+                  <button\n+                    onClick={() => toggleDay(day.day)}\n+                    className={`w-full p-4 text-left hover:bg-gray-50 transition-colors ${\n+                      selectedDay === day.day ? 'bg-blue-50' : ''\n+                    }`}\n+                  >\n+                    <div className=\"flex items-center justify-between\">\n+                      <div className=\"flex items-center space-x-3\">\n+                        <div \n+                          className={`w-6 h-6 rounded-full flex items-center justify-center text-white text-sm font-medium`}\n+                          style={{ backgroundColor: day.color.pin }}\n+                        >\n+                          {day.day}\n+                        </div>\n+                        <div>\n+                          <h3 className=\"font-medium text-gray-900\">\n+                            Day {day.day}\n+                          </h3>\n+                          <p className=\"text-sm text-gray-600\">\n+                            {format(parseISO(day.date), 'MMM d, yyyy')}\n+                          </p>\n+                        </div>\n+                      </div>\n+                      <div className=\"flex items-center space-x-2\">\n+                        <span className=\"text-sm text-gray-500\">\n+                          {day.destinations.length} stops\n+                        </span>\n+                        <svg \n+                          className={`w-4 h-4 text-gray-400 transition-transform ${\n+                            expandedDays.has(day.day) ? 'rotate-180' : ''\n+                          }`}\n+                          fill=\"none\" \n+                          stroke=\"currentColor\" \n+                          viewBox=\"0 0 24 24\"\n+                        >\n+                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\n+                        </svg>\n+                      </div>\n+                    </div>\n+                  </button>\n+\n+                  {/* Destinations List */}\n+                  {expandedDays.has(day.day) && (\n+                    <div className=\"bg-gray-50\">\n+                      {day.destinations.length === 0 ? (\n+                        <div className=\"p-4 text-center text-gray-500\">\n+                          <svg className=\"w-12 h-12 mx-auto mb-2 text-gray-300\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n+                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z\" />\n+                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 11a3 3 0 11-6 0 3 3 0 016 0z\" />\n+                          </svg>\n+                          <p className=\"text-sm\">No destinations added yet</p>\n+                          <p className=\"text-xs text-gray-400 mt-1\">Click on the map to add destinations</p>\n+                        </div>\n+                      ) : (\n+                        <div className=\"space-y-0\">\n+                          {day.destinations.map((destination, index) => (\n+                            <SortableDestination\n+                              key={destination.id}\n+                              destination={destination}\n+                              dayColor={day.color}\n+                              selectedDestination={selectedDestination}\n+                              onDestinationSelect={onDestinationSelect}\n+                              onDestinationDelete={onDestinationDelete}\n+                              isLastItem={index === day.destinations.length - 1}\n+                            />\n+                          ))}\n+                        </div>\n+                      )}\n+                      \n+                      {/* Add Destination - Location Search */}\n+                      <div className=\"p-4 border-t border-gray-200\">\n+                        <LocationSearch\n+                          onLocationSelect={(destination) => {\n+                            // Set the destination's day and order index\n+                            const updatedDestination = {\n+                              ...destination,\n+                              day: day.day,\n+                              orderIndex: day.destinations.length + 1,\n+                            };\n+                            onLocationSelect(updatedDestination);\n+                            onDaySelect(day.day);\n+                          }}\n+                          selectedDay={day.day}\n+                          tripId={trip.id}\n+                          placeholder={`Search places for Day ${day.day}...`}\n+                          className=\"w-full\"\n+                        />\n+                        \n+                        {/* Alternative: Click on map hint */}\n+                        <div className=\"mt-2 text-center\">\n+                          <span className=\"text-xs text-gray-500\">\n+                            or click on the map to add a destination\n+                          </span>\n+                        </div>\n+                      </div>\n+                    </div>\n+                  )}\n+                </div>\n+              </DroppableDay>\n+            ))}\n+          </SortableContext>\n+        </DndContext>\n+        \n+        {/* Smart Recommendations - Inside scrollable area */}\n+        <SmartRecommendations\n+          trip={trip}\n+          tripDays={tripDays}\n+          selectedDay={selectedDay}\n+          onDestinationAdd={onLocationSelect}\n+          existingDestinations={tripDays.flatMap(day => day.destinations)}\n+        />\n+      </div>\n+    </div>\n+  );\n } \n\\ No newline at end of file\n"
                },
                {
                    "date": 1752495084299,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -592,14 +592,17 @@\n                           placeholder={`Search places for Day ${day.day}...`}\n                           className=\"w-full\"\n                         />\n                         \n-                        {/* Alternative: Click on map hint */}\n-                        <div className=\"mt-2 text-center\">\n-                          <span className=\"text-xs text-gray-500\">\n-                            or click on the map to add a destination\n-                          </span>\n-                        </div>\n+                        \n+                        {/* Smart Recommendations for this day */}\n+                        <SmartRecommendations\n+                          trip={trip}\n+                          tripDays={tripDays}\n+                          selectedDay={day.day}\n+                          onDestinationAdd={onLocationSelect}\n+                          existingDestinations={tripDays.flatMap(d => d.destinations)}\n+                        />\n                       </div>\n                     </div>\n                   )}\n                 </div>\n"
                },
                {
                    "date": 1752495217930,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -592,17 +592,14 @@\n                           placeholder={`Search places for Day ${day.day}...`}\n                           className=\"w-full\"\n                         />\n                         \n-                        \n-                        {/* Smart Recommendations for this day */}\n-                        <SmartRecommendations\n-                          trip={trip}\n-                          tripDays={tripDays}\n-                          selectedDay={day.day}\n-                          onDestinationAdd={onLocationSelect}\n-                          existingDestinations={tripDays.flatMap(d => d.destinations)}\n-                        />\n+                        {/* Alternative: Click on map hint */}\n+                        <div className=\"mt-2 text-center\">\n+                          <span className=\"text-xs text-gray-500\">\n+                            or click on the map to add a destination\n+                          </span>\n+                        </div>\n                       </div>\n                     </div>\n                   )}\n                 </div>\n"
                },
                {
                    "date": 1752495237041,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -599,8 +599,17 @@\n                             or click on the map to add a destination\n                           </span>\n                         </div>\n                       </div>\n+                      \n+                      {/* Smart Recommendations for this day */}\n+                      <SmartRecommendations\n+                        trip={trip}\n+                        tripDays={tripDays}\n+                        selectedDay={day.day}\n+                        onDestinationAdd={onLocationSelect}\n+                        existingDestinations={tripDays.flatMap(d => d.destinations)}\n+                      />\n                     </div>\n                   )}\n                 </div>\n               </DroppableDay>\n"
                },
                {
                    "date": 1752495245303,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -615,17 +615,8 @@\n               </DroppableDay>\n             ))}\n           </SortableContext>\n         </DndContext>\n-        \n-        {/* Smart Recommendations - Inside scrollable area */}\n-        <SmartRecommendations\n-          trip={trip}\n-          tripDays={tripDays}\n-          selectedDay={selectedDay}\n-          onDestinationAdd={onLocationSelect}\n-          existingDestinations={tripDays.flatMap(day => day.destinations)}\n-        />\n       </div>\n     </div>\n   );\n } \n\\ No newline at end of file\n"
                },
                {
                    "date": 1752495326503,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -592,14 +592,9 @@\n                           placeholder={`Search places for Day ${day.day}...`}\n                           className=\"w-full\"\n                         />\n                         \n-                        {/* Alternative: Click on map hint */}\n-                        <div className=\"mt-2 text-center\">\n-                          <span className=\"text-xs text-gray-500\">\n-                            or click on the map to add a destination\n-                          </span>\n-                        </div>\n+\n                       </div>\n                       \n                       {/* Smart Recommendations for this day */}\n                       <SmartRecommendations\n"
                },
                {
                    "date": 1752579737907,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -117,15 +117,14 @@\n         className={`w-full p-4 text-left hover:bg-gray-100 transition-colors group relative ${\n           isSelected ? 'bg-blue-50 border-l-4 border-blue-500' : ''\n         }`}\n       >\n-        <div className=\"flex items-start space-x-3\">\n-          {/* Drag Handle */}\n-          <div \n-            {...attributes}\n-            {...listeners}\n-            className=\"flex-shrink-0 mt-1 cursor-grab active:cursor-grabbing\"\n-          >\n+        <div className=\"flex items-start space-x-3\"\n+          {...attributes}\n+          {...listeners}\n+        >\n+          {/* Drag Handle Icon (optional, now just visual) */}\n+          <div className=\"flex-shrink-0 mt-1 cursor-grab active:cursor-grabbing\">\n             <svg className=\"w-4 h-4 text-gray-400 hover:text-gray-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n               <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 8h16M4 16h16\" />\n             </svg>\n           </div>\n"
                },
                {
                    "date": 1752580084794,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -460,9 +460,9 @@\n     });\n   };\n \n   return (\n-    <div className=\"h-full flex flex-col bg-white\">\n+    <div className=\"h-full flex flex-col min-h-0 bg-white\">\n       {/* Header */}\n       <div className=\"p-4 border-b border-gray-200\">\n         <div className=\"flex items-center justify-between\">\n           <div>\n"
                },
                {
                    "date": 1752580709478,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,7 +1,7 @@\n 'use client';\n \n-import { useState } from 'react';\n+import { useState, useRef, useImperativeHandle, forwardRef } from 'react';\n import { Trip, Destination, TripDay } from '@/types';\n import { format, parseISO } from 'date-fns';\n import LocationSearch from './LocationSearch';\n import SmartRecommendations from './SmartRecommendations';\n@@ -246,9 +246,9 @@\n     </div>\n   );\n }\n \n-export default function ItineraryPanel({\n+const ItineraryPanel = forwardRef(function ItineraryPanel({\n   trip,\n   tripDays,\n   selectedDay,\n   selectedDestination,\n@@ -256,9 +256,9 @@\n   onDestinationSelect,\n   onDestinationsChange,\n   onLocationSelect,\n   onDestinationDelete,\n-}: ItineraryPanelProps) {\n+}: ItineraryPanelProps, ref) {\n   const [expandedDays, setExpandedDays] = useState<Set<number>>(new Set([1]));\n   const [isReordering, setIsReordering] = useState(false);\n   const [activeId, setActiveId] = useState<string | null>(null);\n   const [overId, setOverId] = useState<UniqueIdentifier | null>(null);\n@@ -459,8 +459,10 @@\n       return dest;\n     });\n   };\n \n+  const scrollRef = useRef<HTMLDivElement>(null);\n+  useImperativeHandle(ref, () => scrollRef.current as HTMLDivElement);\n   return (\n     <div className=\"h-full flex flex-col min-h-0 bg-white\">\n       {/* Header */}\n       <div className=\"p-4 border-b border-gray-200\">\n@@ -483,9 +485,9 @@\n         </div>\n       </div>\n \n       {/* Days List with Cross-Day Dragging */}\n-      <div className=\"flex-1 overflow-y-auto\">\n+      <div ref={scrollRef} className=\"flex-1 overflow-y-auto hide-native-scrollbar\">\n         <DndContext\n           sensors={sensors}\n           collisionDetection={closestCenter}\n           onDragStart={handleDragStart}\n@@ -612,5 +614,15 @@\n         </DndContext>\n       </div>\n     </div>\n   );\n-} \n\\ No newline at end of file\n+});\n+\n+export default ItineraryPanel;\n+\n+/* Add this to the bottom or in a global CSS file */\n+// .hide-native-scrollbar {\n+//   scrollbar-width: none; /* Firefox */\n+// }\n+// .hide-native-scrollbar::-webkit-scrollbar {\n+//   display: none; /* Chrome, Safari */\n+// } \n\\ No newline at end of file\n"
                },
                {
                    "date": 1752582199353,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -132,24 +132,25 @@\n           {/* Pin Number - Teardrop shape matching map */}\n           <div className=\"flex-shrink-0 mt-0.5\">\n             <svg \n               width=\"24\" \n-              height=\"24\" \n-              viewBox=\"0 0 24 24\" \n+              height=\"32\" \n+              viewBox=\"0 0 24 32\" \n               className=\"w-6 h-6\"\n             >\n               <path \n-                d=\"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z\"\n+                d=\"M12 32C12 32 24 20.0163 24 12C24 5.37258 18.6274 0 12 0C5.37258 0 0 5.37258 12 32 12 32Z\"\n                 fill={isSelected ? '#3B82F6' : dayColor.pin}\n                 stroke=\"#FFFFFF\"\n                 strokeWidth=\"2\"\n               />\n-              <text \n-                x=\"12\" \n-                y=\"13\" \n-                textAnchor=\"middle\" \n-                className=\"text-white text-xs font-medium fill-current\"\n-                style={{ fontSize: '12px' }}\n+              <text\n+                x=\"12\"\n+                y={destination.orderIndex.toString().length > 1 ? \"19\" : \"18\"}\n+                textAnchor=\"middle\"\n+                fill=\"white\"\n+                fontWeight=\"bold\"\n+                fontSize={destination.orderIndex.toString().length > 1 ? \"8px\" : \"12px\"}\n               >\n                 {destination.orderIndex}\n               </text>\n             </svg>\n"
                },
                {
                    "date": 1752582293551,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -131,26 +131,27 @@\n \n           {/* Pin Number - Teardrop shape matching map */}\n           <div className=\"flex-shrink-0 mt-0.5\">\n             <svg \n-              width=\"24\" \n-              height=\"32\" \n-              viewBox=\"0 0 24 32\" \n+              width=\"32\" \n+              height=\"42\" \n+              viewBox=\"0 0 32 42\" \n               className=\"w-6 h-6\"\n             >\n               <path \n-                d=\"M12 32C12 32 24 20.0163 24 12C24 5.37258 18.6274 0 12 0C5.37258 0 0 5.37258 12 32 12 32Z\"\n+                d=\"M16 42C16 42 32 26.6884 32 16C32 7.16344 24.8366 0 16 0C7.16344 0 0 7.16344 0 16C0 26.6884 16 42 16 42Z\"\n                 fill={isSelected ? '#3B82F6' : dayColor.pin}\n                 stroke=\"#FFFFFF\"\n                 strokeWidth=\"2\"\n               />\n               <text\n-                x=\"12\"\n-                y={destination.orderIndex.toString().length > 1 ? \"19\" : \"18\"}\n+                x=\"16\"\n+                y={destination.orderIndex.toString().length > 1 ? \"24\" : \"22\"}\n                 textAnchor=\"middle\"\n                 fill=\"white\"\n                 fontWeight=\"bold\"\n-                fontSize={destination.orderIndex.toString().length > 1 ? \"8px\" : \"12px\"}\n+                fontSize={destination.orderIndex.toString().length > 1 ? \"13px\" : \"18px\"}\n+                alignmentBaseline=\"middle\"\n               >\n                 {destination.orderIndex}\n               </text>\n             </svg>\n"
                },
                {
                    "date": 1752582325831,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -144,13 +144,13 @@\n                 strokeWidth=\"2\"\n               />\n               <text\n                 x=\"16\"\n-                y={destination.orderIndex.toString().length > 1 ? \"24\" : \"22\"}\n+                y={destination.orderIndex.toString().length > 1 ? \"23\" : \"22\"}\n                 textAnchor=\"middle\"\n                 fill=\"white\"\n                 fontWeight=\"bold\"\n-                fontSize={destination.orderIndex.toString().length > 1 ? \"13px\" : \"18px\"}\n+                fontSize={destination.orderIndex.toString().length > 1 ? \"15px\" : \"18px\"}\n                 alignmentBaseline=\"middle\"\n               >\n                 {destination.orderIndex}\n               </text>\n"
                },
                {
                    "date": 1752582381648,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -131,26 +131,26 @@\n \n           {/* Pin Number - Teardrop shape matching map */}\n           <div className=\"flex-shrink-0 mt-0.5\">\n             <svg \n-              width=\"32\" \n-              height=\"42\" \n-              viewBox=\"0 0 32 42\" \n+              width=\"35\" \n+              height=\"46\" \n+              viewBox=\"0 0 35 46\" \n               className=\"w-6 h-6\"\n             >\n               <path \n-                d=\"M16 42C16 42 32 26.6884 32 16C32 7.16344 24.8366 0 16 0C7.16344 0 0 7.16344 0 16C0 26.6884 16 42 16 42Z\"\n+                d=\"M17.5 46C17.5 46 35 29.254 35 17.5C35 7.83502 27.1649 0 17.5 0C7.83502 0 0 7.83502 0 17.5C0 29.254 17.5 46 17.5 46Z\"\n                 fill={isSelected ? '#3B82F6' : dayColor.pin}\n                 stroke=\"#FFFFFF\"\n                 strokeWidth=\"2\"\n               />\n               <text\n-                x=\"16\"\n-                y={destination.orderIndex.toString().length > 1 ? \"23\" : \"22\"}\n+                x=\"17.5\"\n+                y={destination.orderIndex.toString().length > 1 ? \"25\" : \"23\"}\n                 textAnchor=\"middle\"\n                 fill=\"white\"\n                 fontWeight=\"bold\"\n-                fontSize={destination.orderIndex.toString().length > 1 ? \"15px\" : \"18px\"}\n+                fontSize={destination.orderIndex.toString().length > 1 ? \"17px\" : \"20px\"}\n                 alignmentBaseline=\"middle\"\n               >\n                 {destination.orderIndex}\n               </text>\n"
                },
                {
                    "date": 1752582473993,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -144,9 +144,9 @@\n                 strokeWidth=\"2\"\n               />\n               <text\n                 x=\"17.5\"\n-                y={destination.orderIndex.toString().length > 1 ? \"25\" : \"23\"}\n+                y={destination.orderIndex.toString().length > 1 ? \"21\" : \"19\"}\n                 textAnchor=\"middle\"\n                 fill=\"white\"\n                 fontWeight=\"bold\"\n                 fontSize={destination.orderIndex.toString().length > 1 ? \"17px\" : \"20px\"}\n"
                },
                {
                    "date": 1752582519515,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -131,22 +131,22 @@\n \n           {/* Pin Number - Teardrop shape matching map */}\n           <div className=\"flex-shrink-0 mt-0.5\">\n             <svg \n-              width=\"35\" \n-              height=\"46\" \n-              viewBox=\"0 0 35 46\" \n+              width=\"39\" \n+              height=\"51\" \n+              viewBox=\"0 0 39 51\" \n               className=\"w-6 h-6\"\n             >\n               <path \n-                d=\"M17.5 46C17.5 46 35 29.254 35 17.5C35 7.83502 27.1649 0 17.5 0C7.83502 0 0 7.83502 0 17.5C0 29.254 17.5 46 17.5 46Z\"\n+                d=\"M19.5 51C19.5 51 39 32.179 39 19.5C39 8.618 30.382 0 19.5 0C8.618 0 0 8.618 0 19.5C0 32.179 19.5 51 19.5 51Z\"\n                 fill={isSelected ? '#3B82F6' : dayColor.pin}\n                 stroke=\"#FFFFFF\"\n                 strokeWidth=\"2\"\n               />\n               <text\n-                x=\"17.5\"\n-                y={destination.orderIndex.toString().length > 1 ? \"21\" : \"19\"}\n+                x=\"19.5\"\n+                y={destination.orderIndex.toString().length > 1 ? \"23\" : \"21\"}\n                 textAnchor=\"middle\"\n                 fill=\"white\"\n                 fontWeight=\"bold\"\n                 fontSize={destination.orderIndex.toString().length > 1 ? \"17px\" : \"20px\"}\n"
                },
                {
                    "date": 1752583160002,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -263,8 +263,9 @@\n   const [expandedDays, setExpandedDays] = useState<Set<number>>(new Set([1]));\n   const [isReordering, setIsReordering] = useState(false);\n   const [activeId, setActiveId] = useState<string | null>(null);\n   const [overId, setOverId] = useState<UniqueIdentifier | null>(null);\n+  const [viewMode, setViewMode] = useState<'picture' | 'compact'>('compact');\n \n   const sensors = useSensors(\n     useSensor(PointerSensor, {\n       activationConstraint: {\n@@ -463,10 +464,32 @@\n   };\n \n   const scrollRef = useRef<HTMLDivElement>(null);\n   useImperativeHandle(ref, () => scrollRef.current as HTMLDivElement);\n+  // View toggle buttons\n+  const renderViewToggle = () => (\n+    <div className=\"flex gap-2 items-center absolute right-4 top-4 z-10\">\n+      <button\n+        className={`p-2 rounded-full hover:bg-gray-100 transition ${viewMode === 'picture' ? 'bg-primary-100 text-primary-600' : 'text-gray-400'}`}\n+        onClick={() => setViewMode('picture')}\n+        title=\"Picture View\"\n+        aria-label=\"Picture View\"\n+      >\n+        <span role=\"img\" aria-label=\"Picture View\">🖼️</span>\n+      </button>\n+      <button\n+        className={`p-2 rounded-full hover:bg-gray-100 transition ${viewMode === 'compact' ? 'bg-primary-100 text-primary-600' : 'text-gray-400'}`}\n+        onClick={() => setViewMode('compact')}\n+        title=\"Compact View\"\n+        aria-label=\"Compact View\"\n+      >\n+        <span role=\"img\" aria-label=\"Compact View\">☰</span>\n+      </button>\n+    </div>\n+  );\n   return (\n-    <div className=\"h-full flex flex-col min-h-0 bg-white\">\n+    <div className=\"h-full flex flex-col min-h-0 bg-white relative\">\n+      {renderViewToggle()}\n       {/* Header */}\n       <div className=\"p-4 border-b border-gray-200\">\n         <div className=\"flex items-center justify-between\">\n           <div>\n"
                },
                {
                    "date": 1752583258462,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -28,8 +28,9 @@\n import {\n   CSS,\n } from '@dnd-kit/utilities';\n import { reorderDestinations, moveDestinationToDay } from '@/lib/destination-service';\n+import { PhotographIcon, ViewListIcon } from '@heroicons/react/outline';\n \n interface ItineraryPanelProps {\n   trip: Trip;\n   tripDays: TripDay[];\n@@ -466,49 +467,35 @@\n   const scrollRef = useRef<HTMLDivElement>(null);\n   useImperativeHandle(ref, () => scrollRef.current as HTMLDivElement);\n   // View toggle buttons\n   const renderViewToggle = () => (\n-    <div className=\"flex gap-2 items-center absolute right-4 top-4 z-10\">\n+    <div className=\"flex gap-2 items-center ml-auto\">\n       <button\n         className={`p-2 rounded-full hover:bg-gray-100 transition ${viewMode === 'picture' ? 'bg-primary-100 text-primary-600' : 'text-gray-400'}`}\n         onClick={() => setViewMode('picture')}\n         title=\"Picture View\"\n         aria-label=\"Picture View\"\n+        type=\"button\"\n       >\n-        <span role=\"img\" aria-label=\"Picture View\">🖼️</span>\n+        <PhotographIcon className=\"w-5 h-5\" />\n       </button>\n       <button\n         className={`p-2 rounded-full hover:bg-gray-100 transition ${viewMode === 'compact' ? 'bg-primary-100 text-primary-600' : 'text-gray-400'}`}\n         onClick={() => setViewMode('compact')}\n         title=\"Compact View\"\n         aria-label=\"Compact View\"\n+        type=\"button\"\n       >\n-        <span role=\"img\" aria-label=\"Compact View\">☰</span>\n+        <ViewListIcon className=\"w-5 h-5\" />\n       </button>\n     </div>\n   );\n   return (\n-    <div className=\"h-full flex flex-col min-h-0 bg-white relative\">\n-      {renderViewToggle()}\n+    <div className=\"h-full flex flex-col min-h-0 bg-white\">\n       {/* Header */}\n-      <div className=\"p-4 border-b border-gray-200\">\n-        <div className=\"flex items-center justify-between\">\n-          <div>\n-            <h2 className=\"text-lg font-semibold text-gray-900\">Itinerary</h2>\n-            <p className=\"text-sm text-gray-600\">\n-              {tripDays.length} days • {tripDays.reduce((acc, day) => acc + day.destinations.length, 0)} destinations\n-            </p>\n-          </div>\n-          {isReordering && (\n-            <div className=\"flex items-center text-sm text-gray-500\">\n-              <svg className=\"animate-spin -ml-1 mr-2 h-4 w-4\" fill=\"none\" viewBox=\"0 0 24 24\">\n-                <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle>\n-                <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\n-              </svg>\n-              Updating...\n-            </div>\n-          )}\n-        </div>\n+      <div className=\"p-4 border-b border-gray-200 flex items-center\">\n+        <h2 className=\"text-lg font-semibold text-gray-900\">Itinerary</h2>\n+        {renderViewToggle()}\n       </div>\n \n       {/* Days List with Cross-Day Dragging */}\n       <div ref={scrollRef} className=\"flex-1 overflow-y-auto hide-native-scrollbar\">\n"
                },
                {
                    "date": 1752583265666,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -28,9 +28,9 @@\n import {\n   CSS,\n } from '@dnd-kit/utilities';\n import { reorderDestinations, moveDestinationToDay } from '@/lib/destination-service';\n-import { PhotographIcon, ViewListIcon } from '@heroicons/react/outline';\n+import { PhotoIcon, Bars3Icon } from '@heroicons/react/24/outline';\n \n interface ItineraryPanelProps {\n   trip: Trip;\n   tripDays: TripDay[];\n@@ -475,18 +475,18 @@\n         title=\"Picture View\"\n         aria-label=\"Picture View\"\n         type=\"button\"\n       >\n-        <PhotographIcon className=\"w-5 h-5\" />\n+        <PhotoIcon className=\"w-5 h-5\" />\n       </button>\n       <button\n         className={`p-2 rounded-full hover:bg-gray-100 transition ${viewMode === 'compact' ? 'bg-primary-100 text-primary-600' : 'text-gray-400'}`}\n         onClick={() => setViewMode('compact')}\n         title=\"Compact View\"\n         aria-label=\"Compact View\"\n         type=\"button\"\n       >\n-        <ViewListIcon className=\"w-5 h-5\" />\n+        <Bars3Icon className=\"w-5 h-5\" />\n       </button>\n     </div>\n   );\n   return (\n"
                },
                {
                    "date": 1752583441871,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -495,136 +495,116 @@\n       <div className=\"p-4 border-b border-gray-200 flex items-center\">\n         <h2 className=\"text-lg font-semibold text-gray-900\">Itinerary</h2>\n         {renderViewToggle()}\n       </div>\n-\n-      {/* Days List with Cross-Day Dragging */}\n+      {/* Days and Destinations */}\n       <div ref={scrollRef} className=\"flex-1 overflow-y-auto hide-native-scrollbar\">\n-        <DndContext\n-          sensors={sensors}\n-          collisionDetection={closestCenter}\n-          onDragStart={handleDragStart}\n-          onDragOver={handleDragOver}\n-          onDragEnd={handleDragEnd}\n-        >\n-          <SortableContext \n-            items={allDestinations.map(dest => dest.id)}\n-            strategy={verticalListSortingStrategy}\n-          >\n-            {tripDays.map((day) => (\n-              <DroppableDay\n-                key={day.day}\n-                day={day}\n-                isOver={overId === `day-${day.day}`}\n-              >\n-                <div className=\"border-b border-gray-100 last:border-b-0\">\n-                  {/* Day Header */}\n-                  <button\n-                    onClick={() => toggleDay(day.day)}\n-                    className={`w-full p-4 text-left hover:bg-gray-50 transition-colors ${\n-                      selectedDay === day.day ? 'bg-blue-50' : ''\n+        {tripDays.map((day) => (\n+          <div key={day.day} className=\"border-b border-gray-100\">\n+            {/* Day Header */}\n+            <button\n+              onClick={() => toggleDay(day.day)}\n+              className={`w-full p-4 text-left hover:bg-gray-50 transition-colors ${\n+                selectedDay === day.day ? 'bg-blue-50' : ''\n+              }`}\n+            >\n+              <div className=\"flex items-center justify-between\">\n+                <div className=\"flex items-center space-x-3\">\n+                  <div \n+                    className={`w-6 h-6 rounded-full flex items-center justify-center text-white text-sm font-medium`}\n+                    style={{ backgroundColor: day.color.pin }}\n+                  >\n+                    {day.day}\n+                  </div>\n+                  <div>\n+                    <h3 className=\"font-medium text-gray-900\">\n+                      Day {day.day}\n+                    </h3>\n+                    <p className=\"text-sm text-gray-600\">\n+                      {format(parseISO(day.date), 'MMM d, yyyy')}\n+                    </p>\n+                  </div>\n+                </div>\n+                <div className=\"flex items-center space-x-2\">\n+                  <span className=\"text-sm text-gray-500\">\n+                    {day.destinations.length} stops\n+                  </span>\n+                  <svg \n+                    className={`w-4 h-4 text-gray-400 transition-transform ${\n+                      expandedDays.has(day.day) ? 'rotate-180' : ''\n                     }`}\n+                    fill=\"none\" \n+                    stroke=\"currentColor\" \n+                    viewBox=\"0 0 24 24\"\n                   >\n-                    <div className=\"flex items-center justify-between\">\n-                      <div className=\"flex items-center space-x-3\">\n-                        <div \n-                          className={`w-6 h-6 rounded-full flex items-center justify-center text-white text-sm font-medium`}\n-                          style={{ backgroundColor: day.color.pin }}\n-                        >\n-                          {day.day}\n-                        </div>\n-                        <div>\n-                          <h3 className=\"font-medium text-gray-900\">\n-                            Day {day.day}\n-                          </h3>\n-                          <p className=\"text-sm text-gray-600\">\n-                            {format(parseISO(day.date), 'MMM d, yyyy')}\n-                          </p>\n-                        </div>\n-                      </div>\n-                      <div className=\"flex items-center space-x-2\">\n-                        <span className=\"text-sm text-gray-500\">\n-                          {day.destinations.length} stops\n-                        </span>\n-                        <svg \n-                          className={`w-4 h-4 text-gray-400 transition-transform ${\n-                            expandedDays.has(day.day) ? 'rotate-180' : ''\n-                          }`}\n-                          fill=\"none\" \n-                          stroke=\"currentColor\" \n-                          viewBox=\"0 0 24 24\"\n-                        >\n-                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\n-                        </svg>\n-                      </div>\n-                    </div>\n-                  </button>\n+                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\n+                  </svg>\n+                </div>\n+              </div>\n+            </button>\n \n-                  {/* Destinations List */}\n-                  {expandedDays.has(day.day) && (\n-                    <div className=\"bg-gray-50\">\n-                      {day.destinations.length === 0 ? (\n-                        <div className=\"p-4 text-center text-gray-500\">\n-                          <svg className=\"w-12 h-12 mx-auto mb-2 text-gray-300\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n-                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z\" />\n-                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 11a3 3 0 11-6 0 3 3 0 016 0z\" />\n-                          </svg>\n-                          <p className=\"text-sm\">No destinations added yet</p>\n-                          <p className=\"text-xs text-gray-400 mt-1\">Click on the map to add destinations</p>\n-                        </div>\n-                      ) : (\n-                        <div className=\"space-y-0\">\n-                          {day.destinations.map((destination, index) => (\n-                            <SortableDestination\n-                              key={destination.id}\n-                              destination={destination}\n-                              dayColor={day.color}\n-                              selectedDestination={selectedDestination}\n-                              onDestinationSelect={onDestinationSelect}\n-                              onDestinationDelete={onDestinationDelete}\n-                              isLastItem={index === day.destinations.length - 1}\n-                            />\n-                          ))}\n-                        </div>\n-                      )}\n-                      \n-                      {/* Add Destination - Location Search */}\n-                      <div className=\"p-4 border-t border-gray-200\">\n-                        <LocationSearch\n-                          onLocationSelect={(destination) => {\n-                            // Set the destination's day and order index\n-                            const updatedDestination = {\n-                              ...destination,\n-                              day: day.day,\n-                              orderIndex: day.destinations.length + 1,\n-                            };\n-                            onLocationSelect(updatedDestination);\n-                            onDaySelect(day.day);\n-                          }}\n-                          selectedDay={day.day}\n-                          tripId={trip.id}\n-                          placeholder={`Search places for Day ${day.day}...`}\n-                          className=\"w-full\"\n-                        />\n-                        \n+            {/* Destinations List */}\n+            {expandedDays.has(day.day) && (\n+              <div className=\"bg-gray-50\">\n+                {day.destinations.length === 0 ? (\n+                  <div className=\"p-4 text-center text-gray-500\">\n+                    <svg className=\"w-12 h-12 mx-auto mb-2 text-gray-300\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n+                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z\" />\n+                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 11a3 3 0 11-6 0 3 3 0 016 0z\" />\n+                    </svg>\n+                    <p className=\"text-sm\">No destinations added yet</p>\n+                    <p className=\"text-xs text-gray-400 mt-1\">Click on the map to add destinations</p>\n+                  </div>\n+                ) : (\n+                  <div className=\"space-y-0\">\n+                    {day.destinations.map((destination, index) => (\n+                      <SortableDestination\n+                        key={destination.id}\n+                        destination={destination}\n+                        dayColor={day.color}\n+                        selectedDestination={selectedDestination}\n+                        onDestinationSelect={onDestinationSelect}\n+                        onDestinationDelete={onDestinationDelete}\n+                        isLastItem={index === day.destinations.length - 1}\n+                      />\n+                    ))}\n+                  </div>\n+                )}\n+                \n+                {/* Add Destination - Location Search */}\n+                <div className=\"p-4 border-t border-gray-200\">\n+                  <LocationSearch\n+                    onLocationSelect={(destination) => {\n+                      // Set the destination's day and order index\n+                      const updatedDestination = {\n+                        ...destination,\n+                        day: day.day,\n+                        orderIndex: day.destinations.length + 1,\n+                      };\n+                      onLocationSelect(updatedDestination);\n+                      onDaySelect(day.day);\n+                    }}\n+                    selectedDay={day.day}\n+                    tripId={trip.id}\n+                    placeholder={`Search places for Day ${day.day}...`}\n+                    className=\"w-full\"\n+                  />\n+                  \n \n-                      </div>\n-                      \n-                      {/* Smart Recommendations for this day */}\n-                      <SmartRecommendations\n-                        trip={trip}\n-                        tripDays={tripDays}\n-                        selectedDay={day.day}\n-                        onDestinationAdd={onLocationSelect}\n-                        existingDestinations={tripDays.flatMap(d => d.destinations)}\n-                      />\n-                    </div>\n-                  )}\n                 </div>\n-              </DroppableDay>\n-            ))}\n-          </SortableContext>\n-        </DndContext>\n+                \n+                {/* Smart Recommendations for this day */}\n+                <SmartRecommendations\n+                  trip={trip}\n+                  tripDays={tripDays}\n+                  selectedDay={day.day}\n+                  onDestinationAdd={onLocationSelect}\n+                  existingDestinations={tripDays.flatMap(d => d.destinations)}\n+                />\n+              </div>\n+            )}\n+          </div>\n+        ))}\n       </div>\n     </div>\n   );\n });\n"
                },
                {
                    "date": 1752583568290,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -555,19 +555,65 @@\n                     <p className=\"text-xs text-gray-400 mt-1\">Click on the map to add destinations</p>\n                   </div>\n                 ) : (\n                   <div className=\"space-y-0\">\n-                    {day.destinations.map((destination, index) => (\n-                      <SortableDestination\n-                        key={destination.id}\n-                        destination={destination}\n-                        dayColor={day.color}\n-                        selectedDestination={selectedDestination}\n-                        onDestinationSelect={onDestinationSelect}\n-                        onDestinationDelete={onDestinationDelete}\n-                        isLastItem={index === day.destinations.length - 1}\n-                      />\n-                    ))}\n+                    <SortableContext\n+                      items={day.destinations.map((d) => d.id)}\n+                      strategy={verticalListSortingStrategy}\n+                    >\n+                      {day.destinations.map((destination, idx) => {\n+                        if (viewMode === 'compact') {\n+                          return (\n+                            <SortableDestination\n+                              key={destination.id}\n+                              destination={destination}\n+                              dayColor={day.color}\n+                              selectedDestination={selectedDestination}\n+                              onDestinationSelect={onDestinationSelect}\n+                              onDestinationDelete={onDestinationDelete}\n+                              isLastItem={idx === day.destinations.length - 1}\n+                            />\n+                          );\n+                        } else {\n+                          // Picture View logic\n+                          let imageUrl = '';\n+                          if (destination.photos && destination.photos.length > 0) {\n+                            imageUrl = destination.photos[0];\n+                          } else if (destination.cityImage) {\n+                            imageUrl = destination.cityImage;\n+                          } else if (destination.countryImage) {\n+                            imageUrl = destination.countryImage;\n+                          } else {\n+                            imageUrl = '/default-location.jpg';\n+                          }\n+                          // Use a div with drag-and-drop listeners/attributes\n+                          const { attributes, listeners } = {} as any; // fallback if not using sortable\n+                          return (\n+                            <div\n+                              key={destination.id}\n+                              className=\"flex items-center px-4 py-4 hover:bg-gray-50 cursor-pointer border-b last:border-b-0\"\n+                              onClick={() => onDestinationSelect(destination)}\n+                              {...attributes}\n+                              {...listeners}\n+                            >\n+                              <div className=\"flex-1 min-w-0 pr-4\">\n+                                <div className=\"font-medium text-gray-900 truncate text-base\">{destination.locationName}</div>\n+                                <div className=\"text-xs text-gray-500 mb-1\">{destination.startTime ? `${destination.startTime}` : ''}</div>\n+                                {destination.notes && (\n+                                  <div className=\"text-xs text-gray-600 mt-1 line-clamp-2\">{destination.notes}</div>\n+                                )}\n+                              </div>\n+                              <img\n+                                src={imageUrl}\n+                                alt={destination.locationName}\n+                                className=\"w-28 h-20 object-cover rounded-lg flex-shrink-0 border border-gray-200\"\n+                                onError={e => (e.currentTarget.src = '/default-location.jpg')}\n+                              />\n+                            </div>\n+                          );\n+                        }\n+                      })}\n+                    </SortableContext>\n                   </div>\n                 )}\n                 \n                 {/* Add Destination - Location Search */}\n"
                },
                {
                    "date": 1752583578037,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -577,12 +577,8 @@\n                           // Picture View logic\n                           let imageUrl = '';\n                           if (destination.photos && destination.photos.length > 0) {\n                             imageUrl = destination.photos[0];\n-                          } else if (destination.cityImage) {\n-                            imageUrl = destination.cityImage;\n-                          } else if (destination.countryImage) {\n-                            imageUrl = destination.countryImage;\n                           } else {\n                             imageUrl = '/default-location.jpg';\n                           }\n                           // Use a div with drag-and-drop listeners/attributes\n"
                },
                {
                    "date": 1752583843979,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -574,14 +574,12 @@\n                             />\n                           );\n                         } else {\n                           // Picture View logic\n-                          let imageUrl = '';\n-                          if (destination.photos && destination.photos.length > 0) {\n-                            imageUrl = destination.photos[0];\n-                          } else {\n-                            imageUrl = '/default-location.jpg';\n-                          }\n+                          const imageUrl =\n+                            destination.photos && destination.photos[0]\n+                              ? destination.photos[0]\n+                              : '/default-location.jpg';\n                           // Use a div with drag-and-drop listeners/attributes\n                           const { attributes, listeners } = {} as any; // fallback if not using sortable\n                           return (\n                             <div\n@@ -601,9 +599,13 @@\n                               <img\n                                 src={imageUrl}\n                                 alt={destination.locationName}\n                                 className=\"w-28 h-20 object-cover rounded-lg flex-shrink-0 border border-gray-200\"\n-                                onError={e => (e.currentTarget.src = '/default-location.jpg')}\n+                                onError={e => {\n+                                  if (e.currentTarget.src !== window.location.origin + '/default-location.jpg') {\n+                                    e.currentTarget.src = '/default-location.jpg';\n+                                  }\n+                                }}\n                               />\n                             </div>\n                           );\n                         }\n"
                },
                {
                    "date": 1752584018255,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -249,8 +249,126 @@\n     </div>\n   );\n }\n \n+// Sortable destination item for Picture View\n+function SortableDestinationPicture({\n+  destination,\n+  dayColor,\n+  selectedDestination,\n+  onDestinationSelect,\n+  onDestinationDelete,\n+  isLastItem\n+}: {\n+  destination: Destination;\n+  dayColor: any;\n+  selectedDestination: Destination | null;\n+  onDestinationSelect: (destination: Destination) => void;\n+  onDestinationDelete: (destinationId: string) => void;\n+  isLastItem: boolean;\n+}) {\n+  const {\n+    attributes,\n+    listeners,\n+    setNodeRef,\n+    transform,\n+    transition,\n+    isDragging,\n+  } = useSortable({ id: destination.id });\n+\n+  const style = {\n+    transform: CSS.Transform.toString(transform),\n+    transition,\n+  };\n+\n+  const isSelected = selectedDestination?.id === destination.id;\n+  const imageUrl =\n+    destination.photos && destination.photos[0]\n+      ? destination.photos[0]\n+      : '/default-location.jpg';\n+  const [imgError, setImgError] = useState(false);\n+\n+  return (\n+    <div ref={setNodeRef} style={style} className={isDragging ? 'opacity-50' : ''}>\n+      <button\n+        onClick={() => onDestinationSelect(destination)}\n+        className={`w-full p-4 text-left hover:bg-gray-100 transition-colors group relative flex items-center border-b last:border-b-0 ${\n+          isSelected ? 'bg-blue-50 border-l-4 border-blue-500' : ''\n+        }`}\n+        {...attributes}\n+        {...listeners}\n+      >\n+        {/* Pin Number - Teardrop shape matching map */}\n+        <div className=\"flex-shrink-0 mr-4\">\n+          <svg \n+            width=\"39\" \n+            height=\"51\" \n+            viewBox=\"0 0 39 51\" \n+            className=\"w-6 h-6\"\n+          >\n+            <path \n+              d=\"M19.5 51C19.5 51 39 32.179 39 19.5C39 8.618 30.382 0 19.5 0C8.618 0 0 8.618 0 19.5C0 32.179 19.5 51 19.5 51Z\"\n+              fill={isSelected ? '#3B82F6' : dayColor.pin}\n+              stroke=\"#FFFFFF\"\n+              strokeWidth=\"2\"\n+            />\n+            <text\n+              x=\"19.5\"\n+              y={destination.orderIndex.toString().length > 1 ? \"21\" : \"19\"}\n+              textAnchor=\"middle\"\n+              fill=\"white\"\n+              fontWeight=\"bold\"\n+              fontSize={destination.orderIndex.toString().length > 1 ? \"17px\" : \"20px\"}\n+              alignmentBaseline=\"middle\"\n+            >\n+              {destination.orderIndex}\n+            </text>\n+          </svg>\n+        </div>\n+        <div className=\"flex-1 min-w-0 pr-4\">\n+          <div className=\"font-medium text-gray-900 truncate text-base\">{destination.locationName}</div>\n+          <div className=\"text-xs text-gray-500 mb-1\">{destination.startTime ? `${destination.startTime}` : ''}</div>\n+          {destination.notes && (\n+            <div className=\"text-xs text-gray-600 mt-1 line-clamp-2\">{destination.notes}</div>\n+          )}\n+        </div>\n+        <div className=\"flex-shrink-0 ml-4\">\n+          {imgError ? (\n+            <div className=\"w-28 h-20 flex items-center justify-center bg-gray-100 border border-gray-200 rounded-lg text-gray-400 text-xs\">\n+              No Image\n+            </div>\n+          ) : (\n+            <img\n+              src={imageUrl}\n+              alt={destination.locationName}\n+              className=\"w-28 h-20 object-cover rounded-lg flex-shrink-0 border border-gray-200\"\n+              onError={() => setImgError(true)}\n+            />\n+          )}\n+        </div>\n+        <button\n+          onClick={e => {\n+            e.stopPropagation();\n+            onDestinationDelete(destination.id);\n+          }}\n+          className=\"text-red-500 hover:text-red-700 hover:bg-red-50 rounded-lg p-1 transition-colors opacity-0 group-hover:opacity-100 flex-shrink-0 ml-2\"\n+          title=\"Delete destination\"\n+        >\n+          <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n+            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\n+          </svg>\n+        </button>\n+      </button>\n+      {/* Connector line */}\n+      {!isLastItem && (\n+        <div className=\"flex justify-start ml-11\">\n+          <div className=\"w-0.5 h-4 bg-gray-300\"></div>\n+        </div>\n+      )}\n+    </div>\n+  );\n+}\n+\n const ItineraryPanel = forwardRef(function ItineraryPanel({\n   trip,\n   tripDays,\n   selectedDay,\n@@ -573,41 +691,18 @@\n                               isLastItem={idx === day.destinations.length - 1}\n                             />\n                           );\n                         } else {\n-                          // Picture View logic\n-                          const imageUrl =\n-                            destination.photos && destination.photos[0]\n-                              ? destination.photos[0]\n-                              : '/default-location.jpg';\n-                          // Use a div with drag-and-drop listeners/attributes\n-                          const { attributes, listeners } = {} as any; // fallback if not using sortable\n                           return (\n-                            <div\n+                            <SortableDestinationPicture\n                               key={destination.id}\n-                              className=\"flex items-center px-4 py-4 hover:bg-gray-50 cursor-pointer border-b last:border-b-0\"\n-                              onClick={() => onDestinationSelect(destination)}\n-                              {...attributes}\n-                              {...listeners}\n-                            >\n-                              <div className=\"flex-1 min-w-0 pr-4\">\n-                                <div className=\"font-medium text-gray-900 truncate text-base\">{destination.locationName}</div>\n-                                <div className=\"text-xs text-gray-500 mb-1\">{destination.startTime ? `${destination.startTime}` : ''}</div>\n-                                {destination.notes && (\n-                                  <div className=\"text-xs text-gray-600 mt-1 line-clamp-2\">{destination.notes}</div>\n-                                )}\n-                              </div>\n-                              <img\n-                                src={imageUrl}\n-                                alt={destination.locationName}\n-                                className=\"w-28 h-20 object-cover rounded-lg flex-shrink-0 border border-gray-200\"\n-                                onError={e => {\n-                                  if (e.currentTarget.src !== window.location.origin + '/default-location.jpg') {\n-                                    e.currentTarget.src = '/default-location.jpg';\n-                                  }\n-                                }}\n-                              />\n-                            </div>\n+                              destination={destination}\n+                              dayColor={day.color}\n+                              selectedDestination={selectedDestination}\n+                              onDestinationSelect={onDestinationSelect}\n+                              onDestinationDelete={onDestinationDelete}\n+                              isLastItem={idx === day.destinations.length - 1}\n+                            />\n                           );\n                         }\n                       })}\n                     </SortableContext>\n"
                },
                {
                    "date": 1752584125883,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -287,16 +287,14 @@\n       : '/default-location.jpg';\n   const [imgError, setImgError] = useState(false);\n \n   return (\n-    <div ref={setNodeRef} style={style} className={isDragging ? 'opacity-50' : ''}>\n+    <div ref={setNodeRef} style={style} className={isDragging ? 'opacity-50' : ''} {...attributes} {...listeners}>\n       <button\n         onClick={() => onDestinationSelect(destination)}\n         className={`w-full p-4 text-left hover:bg-gray-100 transition-colors group relative flex items-center border-b last:border-b-0 ${\n           isSelected ? 'bg-blue-50 border-l-4 border-blue-500' : ''\n         }`}\n-        {...attributes}\n-        {...listeners}\n       >\n         {/* Pin Number - Teardrop shape matching map */}\n         <div className=\"flex-shrink-0 mr-4\">\n           <svg \n@@ -332,16 +330,16 @@\n           )}\n         </div>\n         <div className=\"flex-shrink-0 ml-4\">\n           {imgError ? (\n-            <div className=\"w-28 h-20 flex items-center justify-center bg-gray-100 border border-gray-200 rounded-lg text-gray-400 text-xs\">\n+            <div className=\"w-34 h-24 flex items-center justify-center bg-gray-100 border border-gray-200 rounded-lg text-gray-400 text-xs\">\n               No Image\n             </div>\n           ) : (\n             <img\n               src={imageUrl}\n               alt={destination.locationName}\n-              className=\"w-28 h-20 object-cover rounded-lg flex-shrink-0 border border-gray-200\"\n+              className=\"w-34 h-24 object-cover rounded-lg flex-shrink-0 border border-gray-200\"\n               onError={() => setImgError(true)}\n             />\n           )}\n         </div>\n"
                },
                {
                    "date": 1752584365236,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -287,15 +287,28 @@\n       : '/default-location.jpg';\n   const [imgError, setImgError] = useState(false);\n \n   return (\n-    <div ref={setNodeRef} style={style} className={isDragging ? 'opacity-50' : ''} {...attributes} {...listeners}>\n+    <div ref={setNodeRef} style={style} className={isDragging ? 'opacity-50' : ''}>\n       <button\n         onClick={() => onDestinationSelect(destination)}\n         className={`w-full p-4 text-left hover:bg-gray-100 transition-colors group relative flex items-center border-b last:border-b-0 ${\n           isSelected ? 'bg-blue-50 border-l-4 border-blue-500' : ''\n         }`}\n+        type=\"button\"\n       >\n+        {/* Drag Handle Icon */}\n+        <button\n+          className=\"flex-shrink-0 mr-2 cursor-grab active:cursor-grabbing p-1 rounded hover:bg-gray-200\"\n+          aria-label=\"Drag to reorder\"\n+          tabIndex={0}\n+          {...attributes}\n+          {...listeners}\n+          type=\"button\"\n+          onClick={e => e.stopPropagation()}\n+        >\n+          <Bars3Icon className=\"w-4 h-4 text-gray-400\" />\n+        </button>\n         {/* Pin Number - Teardrop shape matching map */}\n         <div className=\"flex-shrink-0 mr-4\">\n           <svg \n             width=\"39\" \n"
                },
                {
                    "date": 1752584380316,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -299,9 +299,8 @@\n         {/* Drag Handle Icon */}\n         <button\n           className=\"flex-shrink-0 mr-2 cursor-grab active:cursor-grabbing p-1 rounded hover:bg-gray-200\"\n           aria-label=\"Drag to reorder\"\n-          tabIndex={0}\n           {...attributes}\n           {...listeners}\n           type=\"button\"\n           onClick={e => e.stopPropagation()}\n"
                },
                {
                    "date": 1752584481209,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -111,14 +111,15 @@\n \n   const isSelected = selectedDestination?.id === destination.id;\n \n   return (\n-    <div ref={setNodeRef} style={style} className={isDragging ? 'opacity-50' : ''}>\n+    <div ref={setNodeRef} style={style} className={`w-full ${isDragging ? 'opacity-50' : ''}`} {...attributes} {...listeners}>\n       <button\n         onClick={() => onDestinationSelect(destination)}\n         className={`w-full p-4 text-left hover:bg-gray-100 transition-colors group relative ${\n           isSelected ? 'bg-blue-50 border-l-4 border-blue-500' : ''\n         }`}\n+        type=\"button\"\n       >\n         <div className=\"flex items-start space-x-3\"\n           {...attributes}\n           {...listeners}\n@@ -287,9 +288,9 @@\n       : '/default-location.jpg';\n   const [imgError, setImgError] = useState(false);\n \n   return (\n-    <div ref={setNodeRef} style={style} className={isDragging ? 'opacity-50' : ''}>\n+    <div ref={setNodeRef} style={style} className={`w-full ${isDragging ? 'opacity-50' : ''}`} {...attributes} {...listeners}>\n       <button\n         onClick={() => onDestinationSelect(destination)}\n         className={`w-full p-4 text-left hover:bg-gray-100 transition-colors group relative flex items-center border-b last:border-b-0 ${\n           isSelected ? 'bg-blue-50 border-l-4 border-blue-500' : ''\n"
                },
                {
                    "date": 1752584638176,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -111,17 +111,19 @@\n \n   const isSelected = selectedDestination?.id === destination.id;\n \n   return (\n-    <div ref={setNodeRef} style={style} className={`w-full ${isDragging ? 'opacity-50' : ''}`} {...attributes} {...listeners}>\n+    <div style={style} className={`w-full ${isDragging ? 'opacity-50' : ''}`}>\n       <button\n         onClick={() => onDestinationSelect(destination)}\n         className={`w-full p-4 text-left hover:bg-gray-100 transition-colors group relative ${\n           isSelected ? 'bg-blue-50 border-l-4 border-blue-500' : ''\n         }`}\n         type=\"button\"\n       >\n-        <div className=\"flex items-start space-x-3\"\n+        <div\n+          ref={setNodeRef}\n+          className=\"flex items-start space-x-3\"\n           {...attributes}\n           {...listeners}\n         >\n           {/* Drag Handle Icon (optional, now just visual) */}\n@@ -288,87 +290,94 @@\n       : '/default-location.jpg';\n   const [imgError, setImgError] = useState(false);\n \n   return (\n-    <div ref={setNodeRef} style={style} className={`w-full ${isDragging ? 'opacity-50' : ''}`} {...attributes} {...listeners}>\n+    <div style={style} className={`w-full ${isDragging ? 'opacity-50' : ''}`}>\n       <button\n         onClick={() => onDestinationSelect(destination)}\n         className={`w-full p-4 text-left hover:bg-gray-100 transition-colors group relative flex items-center border-b last:border-b-0 ${\n           isSelected ? 'bg-blue-50 border-l-4 border-blue-500' : ''\n         }`}\n         type=\"button\"\n       >\n-        {/* Drag Handle Icon */}\n-        <button\n-          className=\"flex-shrink-0 mr-2 cursor-grab active:cursor-grabbing p-1 rounded hover:bg-gray-200\"\n-          aria-label=\"Drag to reorder\"\n+        <div\n+          ref={setNodeRef}\n+          className=\"flex items-start space-x-3 w-full\"\n           {...attributes}\n           {...listeners}\n-          type=\"button\"\n-          onClick={e => e.stopPropagation()}\n         >\n-          <Bars3Icon className=\"w-4 h-4 text-gray-400\" />\n-        </button>\n-        {/* Pin Number - Teardrop shape matching map */}\n-        <div className=\"flex-shrink-0 mr-4\">\n-          <svg \n-            width=\"39\" \n-            height=\"51\" \n-            viewBox=\"0 0 39 51\" \n-            className=\"w-6 h-6\"\n+          {/* Drag Handle Icon */}\n+          <button\n+            className=\"flex-shrink-0 mr-2 cursor-grab active:cursor-grabbing p-1 rounded hover:bg-gray-200\"\n+            aria-label=\"Drag to reorder\"\n+            {...attributes}\n+            {...listeners}\n+            type=\"button\"\n+            onClick={e => e.stopPropagation()}\n           >\n-            <path \n-              d=\"M19.5 51C19.5 51 39 32.179 39 19.5C39 8.618 30.382 0 19.5 0C8.618 0 0 8.618 0 19.5C0 32.179 19.5 51 19.5 51Z\"\n-              fill={isSelected ? '#3B82F6' : dayColor.pin}\n-              stroke=\"#FFFFFF\"\n-              strokeWidth=\"2\"\n-            />\n-            <text\n-              x=\"19.5\"\n-              y={destination.orderIndex.toString().length > 1 ? \"21\" : \"19\"}\n-              textAnchor=\"middle\"\n-              fill=\"white\"\n-              fontWeight=\"bold\"\n-              fontSize={destination.orderIndex.toString().length > 1 ? \"17px\" : \"20px\"}\n-              alignmentBaseline=\"middle\"\n+            <Bars3Icon className=\"w-4 h-4 text-gray-400\" />\n+          </button>\n+          {/* Pin Number - Teardrop shape matching map */}\n+          <div className=\"flex-shrink-0 mr-4\">\n+            <svg \n+              width=\"39\" \n+              height=\"51\" \n+              viewBox=\"0 0 39 51\" \n+              className=\"w-6 h-6\"\n             >\n-              {destination.orderIndex}\n-            </text>\n-          </svg>\n+              <path \n+                d=\"M19.5 51C19.5 51 39 32.179 39 19.5C39 8.618 30.382 0 19.5 0C8.618 0 0 8.618 0 19.5C0 32.179 19.5 51 19.5 51Z\"\n+                fill={isSelected ? '#3B82F6' : dayColor.pin}\n+                stroke=\"#FFFFFF\"\n+                strokeWidth=\"2\"\n+              />\n+              <text\n+                x=\"19.5\"\n+                y={destination.orderIndex.toString().length > 1 ? \"21\" : \"19\"}\n+                textAnchor=\"middle\"\n+                fill=\"white\"\n+                fontWeight=\"bold\"\n+                fontSize={destination.orderIndex.toString().length > 1 ? \"17px\" : \"20px\"}\n+                alignmentBaseline=\"middle\"\n+              >\n+                {destination.orderIndex}\n+              </text>\n+            </svg>\n+          </div>\n+          <div className=\"flex-1 min-w-0 pr-4\">\n+            <div className=\"font-medium text-gray-900 truncate text-base\">{destination.locationName}</div>\n+            <div className=\"text-xs text-gray-500 mb-1\">{destination.startTime ? `${destination.startTime}` : ''}</div>\n+            {destination.notes && (\n+              <div className=\"text-xs text-gray-600 mt-1 line-clamp-2\">{destination.notes}</div>\n+            )}\n+          </div>\n+          <div className=\"flex-shrink-0 ml-4\">\n+            {imgError ? (\n+              <div className=\"w-34 h-24 flex items-center justify-center bg-gray-100 border border-gray-200 rounded-lg text-gray-400 text-xs\">\n+                No Image\n+              </div>\n+            ) : (\n+              <img\n+                src={imageUrl}\n+                alt={destination.locationName}\n+                className=\"w-34 h-24 object-cover rounded-lg flex-shrink-0 border border-gray-200\"\n+                onError={() => setImgError(true)}\n+              />\n+            )}\n+          </div>\n+          <button\n+            onClick={e => {\n+              e.stopPropagation();\n+              onDestinationDelete(destination.id);\n+            }}\n+            className=\"text-red-500 hover:text-red-700 hover:bg-red-50 rounded-lg p-1 transition-colors opacity-0 group-hover:opacity-100 flex-shrink-0 ml-2\"\n+            title=\"Delete destination\"\n+          >\n+            <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n+              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\n+            </svg>\n+          </button>\n         </div>\n-        <div className=\"flex-1 min-w-0 pr-4\">\n-          <div className=\"font-medium text-gray-900 truncate text-base\">{destination.locationName}</div>\n-          <div className=\"text-xs text-gray-500 mb-1\">{destination.startTime ? `${destination.startTime}` : ''}</div>\n-          {destination.notes && (\n-            <div className=\"text-xs text-gray-600 mt-1 line-clamp-2\">{destination.notes}</div>\n-          )}\n-        </div>\n-        <div className=\"flex-shrink-0 ml-4\">\n-          {imgError ? (\n-            <div className=\"w-34 h-24 flex items-center justify-center bg-gray-100 border border-gray-200 rounded-lg text-gray-400 text-xs\">\n-              No Image\n-            </div>\n-          ) : (\n-            <img\n-              src={imageUrl}\n-              alt={destination.locationName}\n-              className=\"w-34 h-24 object-cover rounded-lg flex-shrink-0 border border-gray-200\"\n-              onError={() => setImgError(true)}\n-            />\n-          )}\n-        </div>\n-        <button\n-          onClick={e => {\n-            e.stopPropagation();\n-            onDestinationDelete(destination.id);\n-          }}\n-          className=\"text-red-500 hover:text-red-700 hover:bg-red-50 rounded-lg p-1 transition-colors opacity-0 group-hover:opacity-100 flex-shrink-0 ml-2\"\n-          title=\"Delete destination\"\n-        >\n-          <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n-            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\n-          </svg>\n-        </button>\n       </button>\n       {/* Connector line */}\n       {!isLastItem && (\n         <div className=\"flex justify-start ml-11\">\n"
                },
                {
                    "date": 1752584759733,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -692,9 +692,13 @@\n                     <p className=\"text-sm\">No destinations added yet</p>\n                     <p className=\"text-xs text-gray-400 mt-1\">Click on the map to add destinations</p>\n                   </div>\n                 ) : (\n-                  <div className=\"space-y-0\">\n+                  <DndContext\n+                    sensors={sensors}\n+                    collisionDetection={closestCenter}\n+                    onDragEnd={handleDragEnd}\n+                  >\n                     <SortableContext\n                       items={day.destinations.map((d) => d.id)}\n                       strategy={verticalListSortingStrategy}\n                     >\n@@ -725,9 +729,9 @@\n                           );\n                         }\n                       })}\n                     </SortableContext>\n-                  </div>\n+                  </DndContext>\n                 )}\n                 \n                 {/* Add Destination - Location Search */}\n                 <div className=\"p-4 border-t border-gray-200\">\n"
                },
                {
                    "date": 1752584825619,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -191,8 +191,9 @@\n                     onDestinationDelete(destination.id);\n                   }}\n                   className=\"text-red-500 hover:text-red-700 hover:bg-red-50 rounded-lg p-1 transition-colors opacity-0 group-hover:opacity-100 flex-shrink-0\"\n                   title=\"Delete destination\"\n+                  type=\"button\"\n                 >\n                   <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                     <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\n                   </svg>\n"
                },
                {
                    "date": 1752585069703,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -301,60 +301,75 @@\n         type=\"button\"\n       >\n         <div\n           ref={setNodeRef}\n-          className=\"flex items-start space-x-3 w-full\"\n+          className=\"flex items-center w-full\"\n           {...attributes}\n           {...listeners}\n         >\n-          {/* Drag Handle Icon */}\n-          <button\n-            className=\"flex-shrink-0 mr-2 cursor-grab active:cursor-grabbing p-1 rounded hover:bg-gray-200\"\n-            aria-label=\"Drag to reorder\"\n-            {...attributes}\n-            {...listeners}\n-            type=\"button\"\n-            onClick={e => e.stopPropagation()}\n-          >\n-            <Bars3Icon className=\"w-4 h-4 text-gray-400\" />\n-          </button>\n-          {/* Pin Number - Teardrop shape matching map */}\n-          <div className=\"flex-shrink-0 mr-4\">\n-            <svg \n-              width=\"39\" \n-              height=\"51\" \n-              viewBox=\"0 0 39 51\" \n-              className=\"w-6 h-6\"\n+          {/* Text and Pin in a gray rounded square */}\n+          <div className=\"flex-1 flex items-center bg-gray-100 rounded-xl p-4 mr-4 min-h-[112px]\">\n+            {/* Drag Handle Icon */}\n+            <button\n+              className=\"flex-shrink-0 mr-2 cursor-grab active:cursor-grabbing p-1 rounded hover:bg-gray-200\"\n+              aria-label=\"Drag to reorder\"\n+              type=\"button\"\n+              onClick={e => e.stopPropagation()}\n             >\n-              <path \n-                d=\"M19.5 51C19.5 51 39 32.179 39 19.5C39 8.618 30.382 0 19.5 0C8.618 0 0 8.618 0 19.5C0 32.179 19.5 51 19.5 51Z\"\n-                fill={isSelected ? '#3B82F6' : dayColor.pin}\n-                stroke=\"#FFFFFF\"\n-                strokeWidth=\"2\"\n-              />\n-              <text\n-                x=\"19.5\"\n-                y={destination.orderIndex.toString().length > 1 ? \"21\" : \"19\"}\n-                textAnchor=\"middle\"\n-                fill=\"white\"\n-                fontWeight=\"bold\"\n-                fontSize={destination.orderIndex.toString().length > 1 ? \"17px\" : \"20px\"}\n-                alignmentBaseline=\"middle\"\n+              <Bars3Icon className=\"w-4 h-4 text-gray-400\" />\n+            </button>\n+            {/* Pin Number - Teardrop shape matching map */}\n+            <div className=\"flex-shrink-0 mr-4\">\n+              <svg \n+                width=\"39\" \n+                height=\"51\" \n+                viewBox=\"0 0 39 51\" \n+                className=\"w-6 h-6\"\n               >\n-                {destination.orderIndex}\n-              </text>\n-            </svg>\n+                <path \n+                  d=\"M19.5 51C19.5 51 39 32.179 39 19.5C39 8.618 30.382 0 19.5 0C8.618 0 0 8.618 0 19.5C0 32.179 19.5 51 19.5 51Z\"\n+                  fill={isSelected ? '#3B82F6' : dayColor.pin}\n+                  stroke=\"#FFFFFF\"\n+                  strokeWidth=\"2\"\n+                />\n+                <text\n+                  x=\"19.5\"\n+                  y={destination.orderIndex.toString().length > 1 ? \"21\" : \"19\"}\n+                  textAnchor=\"middle\"\n+                  fill=\"white\"\n+                  fontWeight=\"bold\"\n+                  fontSize={destination.orderIndex.toString().length > 1 ? \"17px\" : \"20px\"}\n+                  alignmentBaseline=\"middle\"\n+                >\n+                  {destination.orderIndex}\n+                </text>\n+              </svg>\n+            </div>\n+            <div className=\"flex-1 min-w-0\">\n+              <div className=\"font-medium text-gray-900 truncate text-base\">{destination.locationName}</div>\n+              <div className=\"text-xs text-gray-500 mb-1\">{destination.startTime ? `${destination.startTime}` : ''}</div>\n+              {destination.notes && (\n+                <div className=\"text-xs text-gray-600 mt-1 line-clamp-2\">{destination.notes}</div>\n+              )}\n+            </div>\n+            <button\n+              onClick={e => {\n+                e.stopPropagation();\n+                onDestinationDelete(destination.id);\n+              }}\n+              className=\"text-red-500 hover:text-red-700 hover:bg-red-50 rounded-lg p-1 transition-colors opacity-0 group-hover:opacity-100 flex-shrink-0 ml-2\"\n+              title=\"Delete destination\"\n+              type=\"button\"\n+            >\n+              <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n+                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\n+              </svg>\n+            </button>\n           </div>\n-          <div className=\"flex-1 min-w-0 pr-4\">\n-            <div className=\"font-medium text-gray-900 truncate text-base\">{destination.locationName}</div>\n-            <div className=\"text-xs text-gray-500 mb-1\">{destination.startTime ? `${destination.startTime}` : ''}</div>\n-            {destination.notes && (\n-              <div className=\"text-xs text-gray-600 mt-1 line-clamp-2\">{destination.notes}</div>\n-            )}\n-          </div>\n-          <div className=\"flex-shrink-0 ml-4\">\n+          {/* Image always the same size, right side */}\n+          <div className=\"flex-shrink-0\">\n             {imgError ? (\n-              <div className=\"w-34 h-24 flex items-center justify-center bg-gray-100 border border-gray-200 rounded-lg text-gray-400 text-xs\">\n+              <div className=\"w-34 h-24 flex items-center justify-center bg-gray-200 border border-gray-200 rounded-lg text-gray-400 text-xs\">\n                 No Image\n               </div>\n             ) : (\n               <img\n@@ -364,20 +379,8 @@\n                 onError={() => setImgError(true)}\n               />\n             )}\n           </div>\n-          <button\n-            onClick={e => {\n-              e.stopPropagation();\n-              onDestinationDelete(destination.id);\n-            }}\n-            className=\"text-red-500 hover:text-red-700 hover:bg-red-50 rounded-lg p-1 transition-colors opacity-0 group-hover:opacity-100 flex-shrink-0 ml-2\"\n-            title=\"Delete destination\"\n-          >\n-            <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n-              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\n-            </svg>\n-          </button>\n         </div>\n       </button>\n       {/* Connector line */}\n       {!isLastItem && (\n"
                },
                {
                    "date": 1752585121571,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -364,10 +364,10 @@\n                 <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\n               </svg>\n             </button>\n           </div>\n-          {/* Image always the same size, right side */}\n-          <div className=\"flex-shrink-0\">\n+          {/* Image always the same size, right side, with trash button to the right */}\n+          <div className=\"flex-shrink-0 flex items-center\">\n             {imgError ? (\n               <div className=\"w-34 h-24 flex items-center justify-center bg-gray-200 border border-gray-200 rounded-lg text-gray-400 text-xs\">\n                 No Image\n               </div>\n@@ -378,8 +378,22 @@\n                 className=\"w-34 h-24 object-cover rounded-lg flex-shrink-0 border border-gray-200\"\n                 onError={() => setImgError(true)}\n               />\n             )}\n+            <button\n+              onClick={e => {\n+                e.stopPropagation();\n+                onDestinationDelete(destination.id);\n+              }}\n+              className=\"ml-2 text-red-500 hover:text-red-700 hover:bg-red-50 rounded-lg p-1 transition-colors flex-shrink-0\"\n+              title=\"Delete destination\"\n+              type=\"button\"\n+              style={{ height: '2.5rem', display: 'flex', alignItems: 'center' }}\n+            >\n+              <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n+                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\n+              </svg>\n+            </button>\n           </div>\n         </div>\n       </button>\n       {/* Connector line */}\n"
                },
                {
                    "date": 1752585225381,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -350,24 +350,11 @@\n               {destination.notes && (\n                 <div className=\"text-xs text-gray-600 mt-1 line-clamp-2\">{destination.notes}</div>\n               )}\n             </div>\n-            <button\n-              onClick={e => {\n-                e.stopPropagation();\n-                onDestinationDelete(destination.id);\n-              }}\n-              className=\"text-red-500 hover:text-red-700 hover:bg-red-50 rounded-lg p-1 transition-colors opacity-0 group-hover:opacity-100 flex-shrink-0 ml-2\"\n-              title=\"Delete destination\"\n-              type=\"button\"\n-            >\n-              <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n-                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\n-              </svg>\n-            </button>\n           </div>\n           {/* Image always the same size, right side, with trash button to the right */}\n-          <div className=\"flex-shrink-0 flex items-center\">\n+          <div className=\"flex-shrink-0 flex items-center group\">\n             {imgError ? (\n               <div className=\"w-34 h-24 flex items-center justify-center bg-gray-200 border border-gray-200 rounded-lg text-gray-400 text-xs\">\n                 No Image\n               </div>\n@@ -383,9 +370,9 @@\n               onClick={e => {\n                 e.stopPropagation();\n                 onDestinationDelete(destination.id);\n               }}\n-              className=\"ml-2 text-red-500 hover:text-red-700 hover:bg-red-50 rounded-lg p-1 transition-colors flex-shrink-0\"\n+              className=\"ml-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg p-1 transition-colors flex-shrink-0 opacity-0 group-hover:opacity-100\"\n               title=\"Delete destination\"\n               type=\"button\"\n               style={{ height: '2.5rem', display: 'flex', alignItems: 'center' }}\n             >\n"
                },
                {
                    "date": 1752585847096,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -96,44 +96,20 @@\n     transform: CSS.Transform.toString(transform),\n     transition,\n   };\n \n-  const formatTime = (time: string) => {\n-    if (!time) return '';\n-    try {\n-      const [hours, minutes] = time.split(':');\n-      const date = new Date();\n-      date.setHours(parseInt(hours), parseInt(minutes));\n-      return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });\n-    } catch {\n-      return time;\n-    }\n-  };\n-\n   const isSelected = selectedDestination?.id === destination.id;\n \n   return (\n-    <div style={style} className={`w-full ${isDragging ? 'opacity-50' : ''}`}>\n+    <div ref={setNodeRef} style={style} className={`w-full ${isDragging ? 'opacity-50' : ''}`}>\n       <button\n         onClick={() => onDestinationSelect(destination)}\n-        className={`w-full p-4 text-left hover:bg-gray-100 transition-colors group relative ${\n-          isSelected ? 'bg-blue-50 border-l-4 border-blue-500' : ''\n-        }`}\n+        className=\"w-full text-left group relative\"\n         type=\"button\"\n+        {...attributes}\n+        {...listeners}\n       >\n-        <div\n-          ref={setNodeRef}\n-          className=\"flex items-start space-x-3\"\n-          {...attributes}\n-          {...listeners}\n-        >\n-          {/* Drag Handle Icon (optional, now just visual) */}\n-          <div className=\"flex-shrink-0 mt-1 cursor-grab active:cursor-grabbing\">\n-            <svg className=\"w-4 h-4 text-gray-400 hover:text-gray-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n-              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 8h16M4 16h16\" />\n-            </svg>\n-          </div>\n-\n+        <div className=\"flex items-center space-x-3 bg-gray-100 rounded-xl px-4 py-3\">\n           {/* Pin Number - Teardrop shape matching map */}\n           <div className=\"flex-shrink-0 mt-0.5\">\n             <svg \n               width=\"39\" \n@@ -159,92 +135,15 @@\n                 {destination.orderIndex}\n               </text>\n             </svg>\n           </div>\n-          \n           <div className=\"flex-1 min-w-0\">\n-            <div className=\"flex items-center justify-between\">\n-              <div className=\"flex items-center space-x-2 min-w-0\">\n-                <h4 className=\"font-medium text-gray-900 truncate\">\n-                  {destination.locationName}\n-                </h4>\n-                {/* Compact photo for selected destinations */}\n-                {isSelected && destination.photos && destination.photos.length > 0 && (\n-                  <img \n-                    src={destination.photos[0]} \n-                    alt={destination.locationName}\n-                    className=\"w-8 h-8 object-cover rounded-lg flex-shrink-0\"\n-                    onError={(e) => {\n-                      (e.target as HTMLImageElement).style.display = 'none';\n-                    }}\n-                  />\n-                )}\n-              </div>\n-              <div className=\"flex items-center space-x-2\">\n-                {destination.startTime && (\n-                  <span className=\"text-sm text-gray-500 flex-shrink-0\">\n-                    {formatTime(destination.startTime)}\n-                  </span>\n-                )}\n-                <button\n-                  onClick={(e) => {\n-                    e.stopPropagation();\n-                    onDestinationDelete(destination.id);\n-                  }}\n-                  className=\"text-red-500 hover:text-red-700 hover:bg-red-50 rounded-lg p-1 transition-colors opacity-0 group-hover:opacity-100 flex-shrink-0\"\n-                  title=\"Delete destination\"\n-                  type=\"button\"\n-                >\n-                  <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n-                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\n-                  </svg>\n-                </button>\n-              </div>\n-            </div>\n-            <p className=\"text-sm text-gray-600 truncate\">\n-              {destination.address}\n-            </p>\n-            {destination.notes && (\n-              <p className=\"text-sm text-gray-500 mt-1 line-clamp-2\">\n-                {destination.notes}\n-              </p>\n-            )}\n-            \n-            {/* Compact details for selected destinations */}\n-            {isSelected && (\n-              <div className=\"flex items-center space-x-4 mt-2 text-xs\">\n-                {destination.category && (\n-                  <span className=\"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800\">\n-                    {destination.category}\n-                  </span>\n-                )}\n-                {destination.rating && (\n-                  <div className=\"flex items-center space-x-1\">\n-                    <svg className=\"w-3 h-3 text-yellow-400\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n-                      <path d=\"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z\" />\n-                    </svg>\n-                    <span className=\"text-gray-600\">{destination.rating}</span>\n-                  </div>\n-                )}\n-                {/* Close button for selected destinations */}\n-                <button\n-                  onClick={(e) => {\n-                    e.stopPropagation();\n-                    onDestinationSelect(null as any);\n-                  }}\n-                  className=\"text-gray-400 hover:text-gray-600 transition-colors\"\n-                  title=\"Clear selection\"\n-                >\n-                  <svg className=\"w-3 h-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n-                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n-                  </svg>\n-                </button>\n-              </div>\n-            )}\n+            <h4 className=\"font-medium text-gray-900 truncate\">\n+              {destination.locationName}\n+            </h4>\n           </div>\n         </div>\n       </button>\n-      \n       {/* Connector line */}\n       {!isLastItem && (\n         <div className=\"flex justify-start ml-11\">\n           <div className=\"w-0.5 h-4 bg-gray-300\"></div>\n"
                },
                {
                    "date": 1752585985550,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -107,9 +107,9 @@\n         type=\"button\"\n         {...attributes}\n         {...listeners}\n       >\n-        <div className=\"flex items-center space-x-3 bg-gray-100 rounded-xl px-4 py-3\">\n+        <div className=\"flex items-center space-x-3 bg-gray-50 rounded-lg px-3 py-2\">\n           {/* Pin Number - Teardrop shape matching map */}\n           <div className=\"flex-shrink-0 mt-0.5\">\n             <svg \n               width=\"39\" \n@@ -140,8 +140,22 @@\n             <h4 className=\"font-medium text-gray-900 truncate\">\n               {destination.locationName}\n             </h4>\n           </div>\n+          {/* Trash can (delete button) */}\n+          <button\n+            onClick={e => {\n+              e.stopPropagation();\n+              onDestinationDelete(destination.id);\n+            }}\n+            className=\"text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-lg p-1 transition-colors opacity-0 group-hover:opacity-100 flex-shrink-0\"\n+            title=\"Delete destination\"\n+            type=\"button\"\n+          >\n+            <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n+              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\n+            </svg>\n+          </button>\n         </div>\n       </button>\n       {/* Connector line */}\n       {!isLastItem && (\n"
                },
                {
                    "date": 1752586100920,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -159,9 +159,9 @@\n       </button>\n       {/* Connector line */}\n       {!isLastItem && (\n         <div className=\"flex justify-start ml-11\">\n-          <div className=\"w-0.5 h-4 bg-gray-300\"></div>\n+          <div className=\"w-0.5 h-4 border-l-2 border-dotted border-gray-300\"></div>\n         </div>\n       )}\n     </div>\n   );\n@@ -298,9 +298,9 @@\n       </button>\n       {/* Connector line */}\n       {!isLastItem && (\n         <div className=\"flex justify-start ml-11\">\n-          <div className=\"w-0.5 h-4 bg-gray-300\"></div>\n+          <div className=\"w-0.5 h-4 border-l-2 border-dotted border-gray-300\"></div>\n         </div>\n       )}\n     </div>\n   );\n"
                },
                {
                    "date": 1752586235990,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -99,64 +99,85 @@\n \n   const isSelected = selectedDestination?.id === destination.id;\n \n   return (\n-    <div ref={setNodeRef} style={style} className={`w-full ${isDragging ? 'opacity-50' : ''}`}>\n+    <div ref={setNodeRef} style={style} className={`w-full ${isDragging ? 'opacity-50' : ''} flex items-center`}>\n+      {/* Drag handle on the far left (outside gray box) */}\n       <button\n-        onClick={() => onDestinationSelect(destination)}\n-        className=\"w-full text-left group relative\"\n+        className=\"flex-shrink-0 mr-2 cursor-grab active:cursor-grabbing p-1 rounded hover:bg-gray-200\"\n+        aria-label=\"Drag to reorder\"\n         type=\"button\"\n+        tabIndex={-1}\n         {...attributes}\n         {...listeners}\n+        onClick={e => e.stopPropagation()}\n       >\n-        <div className=\"flex items-center space-x-3 bg-gray-50 rounded-lg px-3 py-2\">\n-          {/* Pin Number - Teardrop shape matching map */}\n-          <div className=\"flex-shrink-0 mt-0.5\">\n-            <svg \n-              width=\"39\" \n-              height=\"51\" \n-              viewBox=\"0 0 39 51\" \n-              className=\"w-6 h-6\"\n+        <svg className=\"w-4 h-4 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n+          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 8h16M4 16h16\" />\n+        </svg>\n+      </button>\n+      {/* Gray box with pin, name, and right drag handle */}\n+      <div className=\"flex items-center space-x-3 bg-gray-50 rounded-lg px-3 py-2 flex-1 min-w-0\">\n+        {/* Pin Number - Teardrop shape matching map */}\n+        <div className=\"flex-shrink-0 mt-0.5\">\n+          <svg \n+            width=\"39\" \n+            height=\"51\" \n+            viewBox=\"0 0 39 51\" \n+            className=\"w-6 h-6\"\n+          >\n+            <path \n+              d=\"M19.5 51C19.5 51 39 32.179 39 19.5C39 8.618 30.382 0 19.5 0C8.618 0 0 8.618 0 19.5C0 32.179 19.5 51 19.5 51Z\"\n+              fill={isSelected ? '#3B82F6' : dayColor.pin}\n+              stroke=\"#FFFFFF\"\n+              strokeWidth=\"2\"\n+            />\n+            <text\n+              x=\"19.5\"\n+              y={destination.orderIndex.toString().length > 1 ? \"23\" : \"21\"}\n+              textAnchor=\"middle\"\n+              fill=\"white\"\n+              fontWeight=\"bold\"\n+              fontSize={destination.orderIndex.toString().length > 1 ? \"17px\" : \"20px\"}\n+              alignmentBaseline=\"middle\"\n             >\n-              <path \n-                d=\"M19.5 51C19.5 51 39 32.179 39 19.5C39 8.618 30.382 0 19.5 0C8.618 0 0 8.618 0 19.5C0 32.179 19.5 51 19.5 51Z\"\n-                fill={isSelected ? '#3B82F6' : dayColor.pin}\n-                stroke=\"#FFFFFF\"\n-                strokeWidth=\"2\"\n-              />\n-              <text\n-                x=\"19.5\"\n-                y={destination.orderIndex.toString().length > 1 ? \"23\" : \"21\"}\n-                textAnchor=\"middle\"\n-                fill=\"white\"\n-                fontWeight=\"bold\"\n-                fontSize={destination.orderIndex.toString().length > 1 ? \"17px\" : \"20px\"}\n-                alignmentBaseline=\"middle\"\n-              >\n-                {destination.orderIndex}\n-              </text>\n-            </svg>\n-          </div>\n-          <div className=\"flex-1 min-w-0\">\n-            <h4 className=\"font-medium text-gray-900 truncate\">\n-              {destination.locationName}\n-            </h4>\n-          </div>\n-          {/* Trash can (delete button) */}\n-          <button\n-            onClick={e => {\n-              e.stopPropagation();\n-              onDestinationDelete(destination.id);\n-            }}\n-            className=\"text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-lg p-1 transition-colors opacity-0 group-hover:opacity-100 flex-shrink-0\"\n-            title=\"Delete destination\"\n-            type=\"button\"\n-          >\n-            <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n-              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\n-            </svg>\n-          </button>\n+              {destination.orderIndex}\n+            </text>\n+          </svg>\n         </div>\n+        <div className=\"flex-1 min-w-0\">\n+          <h4 className=\"font-medium text-gray-900 truncate\">\n+            {destination.locationName}\n+          </h4>\n+        </div>\n+        {/* Drag handle on the right inside the gray box */}\n+        <button\n+          className=\"flex-shrink-0 ml-2 cursor-grab active:cursor-grabbing p-1 rounded hover:bg-gray-200\"\n+          aria-label=\"Drag to reorder\"\n+          type=\"button\"\n+          tabIndex={-1}\n+          {...attributes}\n+          {...listeners}\n+          onClick={e => e.stopPropagation()}\n+        >\n+          <svg className=\"w-4 h-4 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n+            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 8h16M4 16h16\" />\n+          </svg>\n+        </button>\n+      </div>\n+      {/* Trash can (delete button) outside the gray box, right-aligned */}\n+      <button\n+        onClick={e => {\n+          e.stopPropagation();\n+          onDestinationDelete(destination.id);\n+        }}\n+        className=\"ml-2 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-lg p-1 transition-colors opacity-0 group-hover:opacity-100 flex-shrink-0\"\n+        title=\"Delete destination\"\n+        type=\"button\"\n+      >\n+        <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n+          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\n+        </svg>\n       </button>\n       {/* Connector line */}\n       {!isLastItem && (\n         <div className=\"flex justify-start ml-11\">\n"
                },
                {
                    "date": 1752586257542,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -105,9 +105,8 @@\n       <button\n         className=\"flex-shrink-0 mr-2 cursor-grab active:cursor-grabbing p-1 rounded hover:bg-gray-200\"\n         aria-label=\"Drag to reorder\"\n         type=\"button\"\n-        tabIndex={-1}\n         {...attributes}\n         {...listeners}\n         onClick={e => e.stopPropagation()}\n       >\n@@ -153,9 +152,8 @@\n         <button\n           className=\"flex-shrink-0 ml-2 cursor-grab active:cursor-grabbing p-1 rounded hover:bg-gray-200\"\n           aria-label=\"Drag to reorder\"\n           type=\"button\"\n-          tabIndex={-1}\n           {...attributes}\n           {...listeners}\n           onClick={e => e.stopPropagation()}\n         >\n"
                },
                {
                    "date": 1752586337546,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -99,59 +99,13 @@\n \n   const isSelected = selectedDestination?.id === destination.id;\n \n   return (\n-    <div ref={setNodeRef} style={style} className={`w-full ${isDragging ? 'opacity-50' : ''} flex items-center`}>\n-      {/* Drag handle on the far left (outside gray box) */}\n-      <button\n-        className=\"flex-shrink-0 mr-2 cursor-grab active:cursor-grabbing p-1 rounded hover:bg-gray-200\"\n-        aria-label=\"Drag to reorder\"\n-        type=\"button\"\n-        {...attributes}\n-        {...listeners}\n-        onClick={e => e.stopPropagation()}\n-      >\n-        <svg className=\"w-4 h-4 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n-          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 8h16M4 16h16\" />\n-        </svg>\n-      </button>\n-      {/* Gray box with pin, name, and right drag handle */}\n-      <div className=\"flex items-center space-x-3 bg-gray-50 rounded-lg px-3 py-2 flex-1 min-w-0\">\n-        {/* Pin Number - Teardrop shape matching map */}\n-        <div className=\"flex-shrink-0 mt-0.5\">\n-          <svg \n-            width=\"39\" \n-            height=\"51\" \n-            viewBox=\"0 0 39 51\" \n-            className=\"w-6 h-6\"\n-          >\n-            <path \n-              d=\"M19.5 51C19.5 51 39 32.179 39 19.5C39 8.618 30.382 0 19.5 0C8.618 0 0 8.618 0 19.5C0 32.179 19.5 51 19.5 51Z\"\n-              fill={isSelected ? '#3B82F6' : dayColor.pin}\n-              stroke=\"#FFFFFF\"\n-              strokeWidth=\"2\"\n-            />\n-            <text\n-              x=\"19.5\"\n-              y={destination.orderIndex.toString().length > 1 ? \"23\" : \"21\"}\n-              textAnchor=\"middle\"\n-              fill=\"white\"\n-              fontWeight=\"bold\"\n-              fontSize={destination.orderIndex.toString().length > 1 ? \"17px\" : \"20px\"}\n-              alignmentBaseline=\"middle\"\n-            >\n-              {destination.orderIndex}\n-            </text>\n-          </svg>\n-        </div>\n-        <div className=\"flex-1 min-w-0\">\n-          <h4 className=\"font-medium text-gray-900 truncate\">\n-            {destination.locationName}\n-          </h4>\n-        </div>\n-        {/* Drag handle on the right inside the gray box */}\n+    <div ref={setNodeRef} style={style} className={`w-full ${isDragging ? 'opacity-50' : ''}`}> \n+      <div className=\"flex items-center group\">\n+        {/* Drag handle on the far left (outside gray box) */}\n         <button\n-          className=\"flex-shrink-0 ml-2 cursor-grab active:cursor-grabbing p-1 rounded hover:bg-gray-200\"\n+          className=\"flex-shrink-0 mr-2 cursor-grab active:cursor-grabbing p-1 rounded hover:bg-gray-200\"\n           aria-label=\"Drag to reorder\"\n           type=\"button\"\n           {...attributes}\n           {...listeners}\n@@ -160,29 +114,77 @@\n           <svg className=\"w-4 h-4 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n             <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 8h16M4 16h16\" />\n           </svg>\n         </button>\n+        {/* Gray box with pin, name, and right drag handle */}\n+        <div className=\"flex items-center space-x-3 bg-gray-50 rounded-lg px-3 py-2 flex-1 min-w-0\">\n+          {/* Pin Number - Teardrop shape matching map */}\n+          <div className=\"flex-shrink-0 mt-0.5 relative\">\n+            <svg \n+              width=\"39\" \n+              height=\"51\" \n+              viewBox=\"0 0 39 51\" \n+              className=\"w-6 h-6\"\n+            >\n+              <path \n+                d=\"M19.5 51C19.5 51 39 32.179 39 19.5C39 8.618 30.382 0 19.5 0C8.618 0 0 8.618 0 19.5C0 32.179 19.5 51 19.5 51Z\"\n+                fill={isSelected ? '#3B82F6' : dayColor.pin}\n+                stroke=\"#FFFFFF\"\n+                strokeWidth=\"2\"\n+              />\n+              <text\n+                x=\"19.5\"\n+                y={destination.orderIndex.toString().length > 1 ? \"23\" : \"21\"}\n+                textAnchor=\"middle\"\n+                fill=\"white\"\n+                fontWeight=\"bold\"\n+                fontSize={destination.orderIndex.toString().length > 1 ? \"17px\" : \"20px\"}\n+                alignmentBaseline=\"middle\"\n+              >\n+                {destination.orderIndex}\n+              </text>\n+            </svg>\n+            {/* Dotted connector line below pin */}\n+            {!isLastItem && (\n+              <div className=\"absolute left-1/2 -bottom-4 transform -translate-x-1/2\">\n+                <div className=\"w-0.5 h-4 border-l-2 border-dotted border-gray-300\"></div>\n+              </div>\n+            )}\n+          </div>\n+          <div className=\"flex-1 min-w-0\">\n+            <h4 className=\"font-medium text-gray-900 truncate\">\n+              {destination.locationName}\n+            </h4>\n+          </div>\n+          {/* Drag handle on the right inside the gray box */}\n+          <button\n+            className=\"flex-shrink-0 ml-2 cursor-grab active:cursor-grabbing p-1 rounded hover:bg-gray-200\"\n+            aria-label=\"Drag to reorder\"\n+            type=\"button\"\n+            {...attributes}\n+            {...listeners}\n+            onClick={e => e.stopPropagation()}\n+          >\n+            <svg className=\"w-4 h-4 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n+              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 8h16M4 16h16\" />\n+            </svg>\n+          </button>\n+        </div>\n+        {/* Trash can (delete button) outside the gray box, right-aligned, visible on group hover */}\n+        <button\n+          onClick={e => {\n+            e.stopPropagation();\n+            onDestinationDelete(destination.id);\n+          }}\n+          className=\"ml-2 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-lg p-1 transition-colors opacity-0 group-hover:opacity-100 flex-shrink-0\"\n+          title=\"Delete destination\"\n+          type=\"button\"\n+        >\n+          <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n+            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\n+          </svg>\n+        </button>\n       </div>\n-      {/* Trash can (delete button) outside the gray box, right-aligned */}\n-      <button\n-        onClick={e => {\n-          e.stopPropagation();\n-          onDestinationDelete(destination.id);\n-        }}\n-        className=\"ml-2 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-lg p-1 transition-colors opacity-0 group-hover:opacity-100 flex-shrink-0\"\n-        title=\"Delete destination\"\n-        type=\"button\"\n-      >\n-        <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n-          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\n-        </svg>\n-      </button>\n-      {/* Connector line */}\n-      {!isLastItem && (\n-        <div className=\"flex justify-start ml-11\">\n-          <div className=\"w-0.5 h-4 border-l-2 border-dotted border-gray-300\"></div>\n-        </div>\n-      )}\n     </div>\n   );\n }\n \n"
                },
                {
                    "date": 1752586468899,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -100,9 +100,9 @@\n   const isSelected = selectedDestination?.id === destination.id;\n \n   return (\n     <div ref={setNodeRef} style={style} className={`w-full ${isDragging ? 'opacity-50' : ''}`}> \n-      <div className=\"flex items-center group\">\n+      <div className=\"flex items-center group mb-2\">\n         {/* Drag handle on the far left (outside gray box) */}\n         <button\n           className=\"flex-shrink-0 mr-2 cursor-grab active:cursor-grabbing p-1 rounded hover:bg-gray-200\"\n           aria-label=\"Drag to reorder\"\n@@ -168,15 +168,17 @@\n               <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 8h16M4 16h16\" />\n             </svg>\n           </button>\n         </div>\n+        {/* Vertical divider between right drag handle and trash can */}\n+        <div className=\"h-6 w-px bg-gray-200 mx-2\" />\n         {/* Trash can (delete button) outside the gray box, right-aligned, visible on group hover */}\n         <button\n           onClick={e => {\n             e.stopPropagation();\n             onDestinationDelete(destination.id);\n           }}\n-          className=\"ml-2 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-lg p-1 transition-colors opacity-0 group-hover:opacity-100 flex-shrink-0\"\n+          className=\"text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-lg p-1 transition-colors opacity-0 group-hover:opacity-100 flex-shrink-0\"\n           title=\"Delete destination\"\n           type=\"button\"\n         >\n           <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n"
                },
                {
                    "date": 1752586498475,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -115,9 +115,9 @@\n             <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 8h16M4 16h16\" />\n           </svg>\n         </button>\n         {/* Gray box with pin, name, and right drag handle */}\n-        <div className=\"flex items-center space-x-3 bg-gray-50 rounded-lg px-3 py-2 flex-1 min-w-0\">\n+        <div className=\"flex items-center space-x-3 bg-gray-200 rounded-lg px-3 py-2 flex-1 min-w-0\">\n           {/* Pin Number - Teardrop shape matching map */}\n           <div className=\"flex-shrink-0 mt-0.5 relative\">\n             <svg \n               width=\"39\" \n"
                },
                {
                    "date": 1752586593098,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -115,9 +115,9 @@\n             <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 8h16M4 16h16\" />\n           </svg>\n         </button>\n         {/* Gray box with pin, name, and right drag handle */}\n-        <div className=\"flex items-center space-x-3 bg-gray-200 rounded-lg px-3 py-2 flex-1 min-w-0\">\n+        <div className=\"flex items-center space-x-3 bg-gray-100 rounded-lg px-3 py-2 flex-1 min-w-0\">\n           {/* Pin Number - Teardrop shape matching map */}\n           <div className=\"flex-shrink-0 mt-0.5 relative\">\n             <svg \n               width=\"39\" \n"
                },
                {
                    "date": 1752586658863,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -168,10 +168,8 @@\n               <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 8h16M4 16h16\" />\n             </svg>\n           </button>\n         </div>\n-        {/* Vertical divider between right drag handle and trash can */}\n-        <div className=\"h-6 w-px bg-gray-200 mx-2\" />\n         {/* Trash can (delete button) outside the gray box, right-aligned, visible on group hover */}\n         <button\n           onClick={e => {\n             e.stopPropagation();\n"
                },
                {
                    "date": 1752586701609,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -174,9 +174,9 @@\n           onClick={e => {\n             e.stopPropagation();\n             onDestinationDelete(destination.id);\n           }}\n-          className=\"text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-lg p-1 transition-colors opacity-0 group-hover:opacity-100 flex-shrink-0\"\n+          className=\"mx-2 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-lg p-1 transition-colors opacity-0 group-hover:opacity-100 flex-shrink-0\"\n           title=\"Delete destination\"\n           type=\"button\"\n         >\n           <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n"
                },
                {
                    "date": 1752586828749,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -100,16 +100,20 @@\n   const isSelected = selectedDestination?.id === destination.id;\n \n   return (\n     <div ref={setNodeRef} style={style} className={`w-full ${isDragging ? 'opacity-50' : ''}`}> \n-      <div className=\"flex items-center group mb-2\">\n+      <div\n+        className=\"flex items-center group mb-2\"\n+        ref={setNodeRef}\n+        style={style}\n+        {...attributes}\n+        {...listeners}\n+      >\n         {/* Drag handle on the far left (outside gray box) */}\n         <button\n           className=\"flex-shrink-0 mr-2 cursor-grab active:cursor-grabbing p-1 rounded hover:bg-gray-200\"\n           aria-label=\"Drag to reorder\"\n           type=\"button\"\n-          {...attributes}\n-          {...listeners}\n           onClick={e => e.stopPropagation()}\n         >\n           <svg className=\"w-4 h-4 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n             <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 8h16M4 16h16\" />\n@@ -159,10 +163,8 @@\n           <button\n             className=\"flex-shrink-0 ml-2 cursor-grab active:cursor-grabbing p-1 rounded hover:bg-gray-200\"\n             aria-label=\"Drag to reorder\"\n             type=\"button\"\n-            {...attributes}\n-            {...listeners}\n             onClick={e => e.stopPropagation()}\n           >\n             <svg className=\"w-4 h-4 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n               <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 8h16M4 16h16\" />\n"
                },
                {
                    "date": 1752586864055,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -101,9 +101,9 @@\n \n   return (\n     <div ref={setNodeRef} style={style} className={`w-full ${isDragging ? 'opacity-50' : ''}`}> \n       <div\n-        className=\"flex items-center group mb-2\"\n+        className=\"flex items-center group mb-2 cursor-grab\"\n         ref={setNodeRef}\n         style={style}\n         {...attributes}\n         {...listeners}\n"
                },
                {
                    "date": 1752586938271,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -109,9 +109,9 @@\n         {...listeners}\n       >\n         {/* Drag handle on the far left (outside gray box) */}\n         <button\n-          className=\"flex-shrink-0 mr-2 cursor-grab active:cursor-grabbing p-1 rounded hover:bg-gray-200\"\n+          className=\"flex-shrink-0 mr-2 cursor-grab active:cursor-grabbing p-1 rounded hover:bg-gray-200 opacity-0 group-hover:opacity-100 transition-opacity\"\n           aria-label=\"Drag to reorder\"\n           type=\"button\"\n           onClick={e => e.stopPropagation()}\n         >\n@@ -160,9 +160,9 @@\n             </h4>\n           </div>\n           {/* Drag handle on the right inside the gray box */}\n           <button\n-            className=\"flex-shrink-0 ml-2 cursor-grab active:cursor-grabbing p-1 rounded hover:bg-gray-200\"\n+            className=\"flex-shrink-0 ml-2 cursor-grab active:cursor-grabbing p-1 rounded hover:bg-gray-200 opacity-0 group-hover:opacity-100 transition-opacity\"\n             aria-label=\"Drag to reorder\"\n             type=\"button\"\n             onClick={e => e.stopPropagation()}\n           >\n@@ -245,9 +245,9 @@\n           {/* Text and Pin in a gray rounded square */}\n           <div className=\"flex-1 flex items-center bg-gray-100 rounded-xl p-4 mr-4 min-h-[112px]\">\n             {/* Drag Handle Icon */}\n             <button\n-              className=\"flex-shrink-0 mr-2 cursor-grab active:cursor-grabbing p-1 rounded hover:bg-gray-200\"\n+              className=\"flex-shrink-0 mr-2 cursor-grab active:cursor-grabbing p-1 rounded hover:bg-gray-200 opacity-0 group-hover:opacity-100 transition-opacity\"\n               aria-label=\"Drag to reorder\"\n               type=\"button\"\n               onClick={e => e.stopPropagation()}\n             >\n"
                },
                {
                    "date": 1752586994470,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -227,9 +227,9 @@\n       : '/default-location.jpg';\n   const [imgError, setImgError] = useState(false);\n \n   return (\n-    <div style={style} className={`w-full ${isDragging ? 'opacity-50' : ''}`}>\n+    <div style={style} className={`w-full ${isDragging ? 'opacity-50' : ''} cursor-grab`}>\n       <button\n         onClick={() => onDestinationSelect(destination)}\n         className={`w-full p-4 text-left hover:bg-gray-100 transition-colors group relative flex items-center border-b last:border-b-0 ${\n           isSelected ? 'bg-blue-50 border-l-4 border-blue-500' : ''\n"
                },
                {
                    "date": 1752587047955,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -232,9 +232,9 @@\n       <button\n         onClick={() => onDestinationSelect(destination)}\n         className={`w-full p-4 text-left hover:bg-gray-100 transition-colors group relative flex items-center border-b last:border-b-0 ${\n           isSelected ? 'bg-blue-50 border-l-4 border-blue-500' : ''\n-        }`}\n+        } cursor-grab`}\n         type=\"button\"\n       >\n         <div\n           ref={setNodeRef}\n"
                },
                {
                    "date": 1752587104836,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -121,9 +121,9 @@\n         </button>\n         {/* Gray box with pin, name, and right drag handle */}\n         <div className=\"flex items-center space-x-3 bg-gray-100 rounded-lg px-3 py-2 flex-1 min-w-0\">\n           {/* Pin Number - Teardrop shape matching map */}\n-          <div className=\"flex-shrink-0 mt-0.5 relative\">\n+          <div className=\"flex-shrink-0 mt-0.5 relative cursor-grab\">\n             <svg \n               width=\"39\" \n               height=\"51\" \n               viewBox=\"0 0 39 51\" \n@@ -253,9 +253,9 @@\n             >\n               <Bars3Icon className=\"w-4 h-4 text-gray-400\" />\n             </button>\n             {/* Pin Number - Teardrop shape matching map */}\n-            <div className=\"flex-shrink-0 mr-4\">\n+            <div className=\"flex-shrink-0 mr-4 cursor-grab\">\n               <svg \n                 width=\"39\" \n                 height=\"51\" \n                 viewBox=\"0 0 39 51\" \n"
                },
                {
                    "date": 1752587284761,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -118,9 +118,9 @@\n           <svg className=\"w-4 h-4 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n             <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 8h16M4 16h16\" />\n           </svg>\n         </button>\n-        {/* Gray box with pin, name, and right drag handle */}\n+        {/* Gray box with pin, name, right drag handle */}\n         <div className=\"flex items-center space-x-3 bg-gray-100 rounded-lg px-3 py-2 flex-1 min-w-0\">\n           {/* Pin Number - Teardrop shape matching map */}\n           <div className=\"flex-shrink-0 mt-0.5 relative cursor-grab\">\n             <svg \n@@ -189,9 +189,9 @@\n     </div>\n   );\n }\n \n-// Sortable destination item for Picture View\n+// Refactor SortableDestinationPicture to match Compact View structure, only adding extra info\n function SortableDestinationPicture({\n   destination,\n   dayColor,\n   selectedDestination,\n@@ -206,126 +206,150 @@\n   onDestinationDelete: (destinationId: string) => void;\n   isLastItem: boolean;\n }) {\n   const {\n-    attributes,\n-    listeners,\n     setNodeRef,\n     transform,\n     transition,\n     isDragging,\n+    attributes,\n+    listeners,\n   } = useSortable({ id: destination.id });\n \n   const style = {\n     transform: CSS.Transform.toString(transform),\n     transition,\n   };\n \n   const isSelected = selectedDestination?.id === destination.id;\n-  const imageUrl =\n-    destination.photos && destination.photos[0]\n-      ? destination.photos[0]\n-      : '/default-location.jpg';\n+  const imageUrl = destination.photos && destination.photos[0] ? destination.photos[0] : '/default-location.jpg';\n   const [imgError, setImgError] = useState(false);\n \n   return (\n-    <div style={style} className={`w-full ${isDragging ? 'opacity-50' : ''} cursor-grab`}>\n-      <button\n-        onClick={() => onDestinationSelect(destination)}\n-        className={`w-full p-4 text-left hover:bg-gray-100 transition-colors group relative flex items-center border-b last:border-b-0 ${\n-          isSelected ? 'bg-blue-50 border-l-4 border-blue-500' : ''\n-        } cursor-grab`}\n-        type=\"button\"\n+    <div\n+      ref={setNodeRef}\n+      style={style}\n+      className={`w-full ${isDragging ? 'opacity-50' : ''}`}\n+    >\n+      <div\n+        className=\"flex items-center group mb-2 cursor-grab\"\n+        {...attributes}\n+        {...listeners}\n       >\n-        <div\n-          ref={setNodeRef}\n-          className=\"flex items-center w-full\"\n-          {...attributes}\n-          {...listeners}\n+        {/* Drag handle on the far left (outside gray box) */}\n+        <button\n+          className=\"flex-shrink-0 mr-2 cursor-grab active:cursor-grabbing p-1 rounded hover:bg-gray-200 opacity-0 group-hover:opacity-100 transition-opacity\"\n+          aria-label=\"Drag to reorder\"\n+          type=\"button\"\n+          onClick={e => e.stopPropagation()}\n         >\n-          {/* Text and Pin in a gray rounded square */}\n-          <div className=\"flex-1 flex items-center bg-gray-100 rounded-xl p-4 mr-4 min-h-[112px]\">\n-            {/* Drag Handle Icon */}\n-            <button\n-              className=\"flex-shrink-0 mr-2 cursor-grab active:cursor-grabbing p-1 rounded hover:bg-gray-200 opacity-0 group-hover:opacity-100 transition-opacity\"\n-              aria-label=\"Drag to reorder\"\n-              type=\"button\"\n-              onClick={e => e.stopPropagation()}\n+          <svg className=\"w-4 h-4 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n+            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 8h16M4 16h16\" />\n+          </svg>\n+        </button>\n+        {/* Gray box with pin, name, right drag handle, and extra info */}\n+        <div className=\"flex items-center space-x-3 bg-gray-100 rounded-lg px-3 py-2 flex-1 min-w-0\">\n+          {/* Pin Number - Teardrop shape matching map */}\n+          <div className=\"flex-shrink-0 mr-4 relative cursor-grab\">\n+            <svg \n+              width=\"39\" \n+              height=\"51\" \n+              viewBox=\"0 0 39 51\" \n+              className=\"w-6 h-6\"\n             >\n-              <Bars3Icon className=\"w-4 h-4 text-gray-400\" />\n-            </button>\n-            {/* Pin Number - Teardrop shape matching map */}\n-            <div className=\"flex-shrink-0 mr-4 cursor-grab\">\n-              <svg \n-                width=\"39\" \n-                height=\"51\" \n-                viewBox=\"0 0 39 51\" \n-                className=\"w-6 h-6\"\n+              <path \n+                d=\"M19.5 51C19.5 51 39 32.179 39 19.5C39 8.618 30.382 0 19.5 0C8.618 0 0 8.618 0 19.5C0 32.179 19.5 51 19.5 51Z\"\n+                fill={isSelected ? '#3B82F6' : dayColor.pin}\n+                stroke=\"#FFFFFF\"\n+                strokeWidth=\"2\"\n+              />\n+              <text\n+                x=\"19.5\"\n+                y={destination.orderIndex.toString().length > 1 ? \"21\" : \"19\"}\n+                textAnchor=\"middle\"\n+                fill=\"white\"\n+                fontWeight=\"bold\"\n+                fontSize={destination.orderIndex.toString().length > 1 ? \"17px\" : \"20px\"}\n+                alignmentBaseline=\"middle\"\n               >\n-                <path \n-                  d=\"M19.5 51C19.5 51 39 32.179 39 19.5C39 8.618 30.382 0 19.5 0C8.618 0 0 8.618 0 19.5C0 32.179 19.5 51 19.5 51Z\"\n-                  fill={isSelected ? '#3B82F6' : dayColor.pin}\n-                  stroke=\"#FFFFFF\"\n-                  strokeWidth=\"2\"\n-                />\n-                <text\n-                  x=\"19.5\"\n-                  y={destination.orderIndex.toString().length > 1 ? \"21\" : \"19\"}\n-                  textAnchor=\"middle\"\n-                  fill=\"white\"\n-                  fontWeight=\"bold\"\n-                  fontSize={destination.orderIndex.toString().length > 1 ? \"17px\" : \"20px\"}\n-                  alignmentBaseline=\"middle\"\n-                >\n-                  {destination.orderIndex}\n-                </text>\n-              </svg>\n-            </div>\n-            <div className=\"flex-1 min-w-0\">\n-              <div className=\"font-medium text-gray-900 truncate text-base\">{destination.locationName}</div>\n-              <div className=\"text-xs text-gray-500 mb-1\">{destination.startTime ? `${destination.startTime}` : ''}</div>\n-              {destination.notes && (\n-                <div className=\"text-xs text-gray-600 mt-1 line-clamp-2\">{destination.notes}</div>\n+                {destination.orderIndex}\n+              </text>\n+            </svg>\n+            {/* Dotted connector line below pin */}\n+            {!isLastItem && (\n+              <div className=\"absolute left-1/2 -bottom-4 transform -translate-x-1/2\">\n+                <div className=\"w-0.5 h-4 border-l-2 border-dotted border-gray-300\"></div>\n+              </div>\n+            )}\n+          </div>\n+          <div className=\"flex-1 min-w-0\">\n+            <div className=\"flex items-center\">\n+              <h4 className=\"font-medium text-gray-900 truncate\">\n+                {destination.locationName}\n+              </h4>\n+              {/* Time (if present) */}\n+              {destination.startTime && (\n+                <span className=\"ml-2 text-sm text-gray-500 flex-shrink-0\">\n+                  {destination.startTime}\n+                </span>\n               )}\n             </div>\n+            {/* Address, description, tags, etc. only in Picture View */}\n+            {destination.address && (\n+              <div className=\"text-xs text-gray-500 truncate mt-1\">{destination.address}</div>\n+            )}\n+            {destination.notes && (\n+              <div className=\"text-xs text-gray-600 mt-1 line-clamp-2\">{destination.notes}</div>\n+            )}\n+            {/* Category/Tag */}\n+            {destination.category && (\n+              <span className=\"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 mt-1\">\n+                {destination.category}\n+              </span>\n+            )}\n           </div>\n-          {/* Image always the same size, right side, with trash button to the right */}\n+          {/* Image (right side, only in Picture View) */}\n           <div className=\"flex-shrink-0 flex items-center group\">\n-            {imgError ? (\n-              <div className=\"w-34 h-24 flex items-center justify-center bg-gray-200 border border-gray-200 rounded-lg text-gray-400 text-xs\">\n-                No Image\n-              </div>\n-            ) : (\n+            {!imgError ? (\n               <img\n                 src={imageUrl}\n                 alt={destination.locationName}\n-                className=\"w-34 h-24 object-cover rounded-lg flex-shrink-0 border border-gray-200\"\n+                className=\"w-28 h-20 object-cover rounded-lg flex-shrink-0 border border-gray-200\"\n                 onError={() => setImgError(true)}\n               />\n+            ) : (\n+              <div className=\"w-28 h-20 flex items-center justify-center bg-gray-200 border border-gray-200 rounded-lg text-gray-400 text-xs\">\n+                No Image\n+              </div>\n             )}\n-            <button\n-              onClick={e => {\n-                e.stopPropagation();\n-                onDestinationDelete(destination.id);\n-              }}\n-              className=\"ml-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg p-1 transition-colors flex-shrink-0 opacity-0 group-hover:opacity-100\"\n-              title=\"Delete destination\"\n-              type=\"button\"\n-              style={{ height: '2.5rem', display: 'flex', alignItems: 'center' }}\n-            >\n-              <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n-                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\n-              </svg>\n-            </button>\n           </div>\n+          {/* Drag handle on the right inside the gray box */}\n+          <button\n+            className=\"flex-shrink-0 ml-2 cursor-grab active:cursor-grabbing p-1 rounded hover:bg-gray-200 opacity-0 group-hover:opacity-100 transition-opacity\"\n+            aria-label=\"Drag to reorder\"\n+            type=\"button\"\n+            onClick={e => e.stopPropagation()}\n+          >\n+            <svg className=\"w-4 h-4 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n+              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 8h16M4 16h16\" />\n+            </svg>\n+          </button>\n         </div>\n-      </button>\n-      {/* Connector line */}\n-      {!isLastItem && (\n-        <div className=\"flex justify-start ml-11\">\n-          <div className=\"w-0.5 h-4 border-l-2 border-dotted border-gray-300\"></div>\n-        </div>\n-      )}\n+        {/* Trash can (delete button) outside the gray box, right-aligned, visible on group hover */}\n+        <button\n+          onClick={e => {\n+            e.stopPropagation();\n+            onDestinationDelete(destination.id);\n+          }}\n+          className=\"mx-2 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-lg p-1 transition-colors opacity-0 group-hover:opacity-100 flex-shrink-0\"\n+          title=\"Delete destination\"\n+          type=\"button\"\n+        >\n+          <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n+            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\n+          </svg>\n+        </button>\n+      </div>\n     </div>\n   );\n }\n \n"
                },
                {
                    "date": 1752587592156,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -352,8 +352,43 @@\n     </div>\n   );\n }\n \n+// Helper: PlusButtonWithMenu\n+function PlusButtonWithMenu({ onAddPlace, onAddNote }: { onAddPlace: () => void; onAddNote: () => void }) {\n+  const [open, setOpen] = useState(false);\n+  return (\n+    <div className=\"relative flex flex-col items-center z-10\">\n+      <button\n+        className=\"bg-primary-500 text-white rounded-full w-8 h-8 flex items-center justify-center shadow hover:bg-primary-600 focus:outline-none focus:ring-2 focus:ring-primary-400\"\n+        onClick={() => setOpen((v) => !v)}\n+        aria-label=\"Add\"\n+        type=\"button\"\n+      >\n+        <span className=\"text-xl leading-none\">+</span>\n+      </button>\n+      {open && (\n+        <div className=\"absolute top-10 left-1/2 -translate-x-1/2 bg-white border border-gray-200 rounded-lg shadow-lg py-2 px-3 flex flex-col space-y-1 min-w-[120px]\">\n+          <button\n+            className=\"text-sm text-gray-700 hover:bg-gray-100 rounded px-2 py-1 text-left\"\n+            onClick={() => { setOpen(false); onAddPlace(); }}\n+            type=\"button\"\n+          >\n+            Add a Place\n+          </button>\n+          <button\n+            className=\"text-sm text-gray-700 hover:bg-gray-100 rounded px-2 py-1 text-left\"\n+            onClick={() => { setOpen(false); onAddNote(); }}\n+            type=\"button\"\n+          >\n+            Add a Note\n+          </button>\n+        </div>\n+      )}\n+    </div>\n+  );\n+}\n+\n const ItineraryPanel = forwardRef(function ItineraryPanel({\n   trip,\n   tripDays,\n   selectedDay,\n"
                },
                {
                    "date": 1752587788886,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -701,35 +701,43 @@\n                     <SortableContext\n                       items={day.destinations.map((d) => d.id)}\n                       strategy={verticalListSortingStrategy}\n                     >\n-                      {day.destinations.map((destination, idx) => {\n-                        if (viewMode === 'compact') {\n-                          return (\n+                      {day.destinations.map((destination, idx) => (\n+                        <div key={destination.id}>\n+                          {viewMode === 'compact' ? (\n                             <SortableDestination\n-                              key={destination.id}\n                               destination={destination}\n                               dayColor={day.color}\n                               selectedDestination={selectedDestination}\n                               onDestinationSelect={onDestinationSelect}\n                               onDestinationDelete={onDestinationDelete}\n                               isLastItem={idx === day.destinations.length - 1}\n                             />\n-                          );\n-                        } else {\n-                          return (\n+                          ) : (\n                             <SortableDestinationPicture\n-                              key={destination.id}\n                               destination={destination}\n                               dayColor={day.color}\n                               selectedDestination={selectedDestination}\n                               onDestinationSelect={onDestinationSelect}\n                               onDestinationDelete={onDestinationDelete}\n                               isLastItem={idx === day.destinations.length - 1}\n                             />\n-                          );\n-                        }\n-                      })}\n+                          )}\n+                          {/* Insert + button after each pin except the last */}\n+                          {idx < day.destinations.length - 1 && (\n+                            <div className=\"flex justify-start ml-11 relative z-10\" style={{ marginTop: '-18px', marginBottom: '6px' }}>\n+                              <PlusButtonWithMenu onAddPlace={() => {}} onAddNote={() => {}} />\n+                            </div>\n+                          )}\n+                        </div>\n+                      ))}\n+                      {/* After the last pin, if there are any destinations */}\n+                      {day.destinations.length > 0 && (\n+                        <div className=\"flex justify-start ml-11 relative z-10\" style={{ marginTop: '-18px', marginBottom: '6px' }}>\n+                          <PlusButtonWithMenu onAddPlace={() => {}} onAddNote={() => {}} />\n+                        </div>\n+                      )}\n                     </SortableContext>\n                   </DndContext>\n                 )}\n                 \n"
                },
                {
                    "date": 1752587955619,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -356,19 +356,29 @@\n // Helper: PlusButtonWithMenu\n function PlusButtonWithMenu({ onAddPlace, onAddNote }: { onAddPlace: () => void; onAddNote: () => void }) {\n   const [open, setOpen] = useState(false);\n   return (\n-    <div className=\"relative flex flex-col items-center z-10\">\n+    <div className=\"relative flex flex-col items-center z-10 group h-20 justify-center\">\n+      {/* Dots above + */}\n+      <div className=\"flex flex-col items-center flex-1\">\n+        <div className=\"h-3 w-0.5 border-l-2 border-dotted border-gray-300\" />\n+      </div>\n+      {/* + button, invisible by default, appears on hover */}\n       <button\n-        className=\"bg-primary-500 text-white rounded-full w-8 h-8 flex items-center justify-center shadow hover:bg-primary-600 focus:outline-none focus:ring-2 focus:ring-primary-400\"\n+        className=\"bg-primary-500 text-white rounded-full w-6 h-6 flex items-center justify-center shadow hover:bg-primary-600 focus:outline-none focus:ring-2 focus:ring-primary-400 opacity-0 group-hover:opacity-100 transition-opacity duration-200\"\n         onClick={() => setOpen((v) => !v)}\n         aria-label=\"Add\"\n         type=\"button\"\n+        style={{ zIndex: 2 }}\n       >\n-        <span className=\"text-xl leading-none\">+</span>\n+        <span className=\"text-lg leading-none\">+</span>\n       </button>\n+      {/* Dots below + */}\n+      <div className=\"flex flex-col items-center flex-1\">\n+        <div className=\"h-3 w-0.5 border-l-2 border-dotted border-gray-300\" />\n+      </div>\n       {open && (\n-        <div className=\"absolute top-10 left-1/2 -translate-x-1/2 bg-white border border-gray-200 rounded-lg shadow-lg py-2 px-3 flex flex-col space-y-1 min-w-[120px]\">\n+        <div className=\"absolute top-8 left-1/2 -translate-x-1/2 bg-white border border-gray-200 rounded-lg shadow-lg py-2 px-3 flex flex-col space-y-1 min-w-[120px] z-20\">\n           <button\n             className=\"text-sm text-gray-700 hover:bg-gray-100 rounded px-2 py-1 text-left\"\n             onClick={() => { setOpen(false); onAddPlace(); }}\n             type=\"button\"\n"
                },
                {
                    "date": 1752588097953,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -356,27 +356,26 @@\n // Helper: PlusButtonWithMenu\n function PlusButtonWithMenu({ onAddPlace, onAddNote }: { onAddPlace: () => void; onAddNote: () => void }) {\n   const [open, setOpen] = useState(false);\n   return (\n-    <div className=\"relative flex flex-col items-center z-10 group h-20 justify-center\">\n-      {/* Dots above + */}\n-      <div className=\"flex flex-col items-center flex-1\">\n-        <div className=\"h-3 w-0.5 border-l-2 border-dotted border-gray-300\" />\n+    <div className=\"relative flex flex-col items-center z-10 h-20 justify-center\">\n+      {/* Full vertical dotted line */}\n+      <div className=\"absolute left-1/2 top-0 -translate-x-1/2 h-full flex flex-col items-center pointer-events-none\" style={{ width: '1px' }}>\n+        <div className=\"h-full w-0.5 border-l-2 border-dotted border-gray-300\" />\n       </div>\n-      {/* + button, invisible by default, appears on hover */}\n-      <button\n-        className=\"bg-primary-500 text-white rounded-full w-6 h-6 flex items-center justify-center shadow hover:bg-primary-600 focus:outline-none focus:ring-2 focus:ring-primary-400 opacity-0 group-hover:opacity-100 transition-opacity duration-200\"\n-        onClick={() => setOpen((v) => !v)}\n-        aria-label=\"Add\"\n-        type=\"button\"\n-        style={{ zIndex: 2 }}\n-      >\n-        <span className=\"text-lg leading-none\">+</span>\n-      </button>\n-      {/* Dots below + */}\n-      <div className=\"flex flex-col items-center flex-1\">\n-        <div className=\"h-3 w-0.5 border-l-2 border-dotted border-gray-300\" />\n+      {/* Hoverable circle area */}\n+      <div className=\"relative z-10 flex items-center justify-center h-20\" style={{ minHeight: '48px' }}>\n+        <button\n+          className=\"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-8 h-8 rounded-full flex items-center justify-center transition bg-gray-100 opacity-0 hover:opacity-100 focus:opacity-100 group\"\n+          style={{ boxShadow: '0 0 0 0 transparent' }}\n+          onClick={() => setOpen((v) => !v)}\n+          aria-label=\"Add\"\n+          type=\"button\"\n+        >\n+          <span className=\"text-lg text-gray-500\">+</span>\n+        </button>\n       </div>\n+      {/* Popover menu */}\n       {open && (\n         <div className=\"absolute top-8 left-1/2 -translate-x-1/2 bg-white border border-gray-200 rounded-lg shadow-lg py-2 px-3 flex flex-col space-y-1 min-w-[120px] z-20\">\n           <button\n             className=\"text-sm text-gray-700 hover:bg-gray-100 rounded px-2 py-1 text-left\"\n"
                },
                {
                    "date": 1752588183189,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -731,9 +731,9 @@\n                               onDestinationDelete={onDestinationDelete}\n                               isLastItem={idx === day.destinations.length - 1}\n                             />\n                           )}\n-                          {/* Insert + button after each pin except the last */}\n+                          {/* Insert + button and vertical dots only between pins, not after the last pin */}\n                           {idx < day.destinations.length - 1 && (\n                             <div className=\"flex justify-start ml-11 relative z-10\" style={{ marginTop: '-18px', marginBottom: '6px' }}>\n                               <PlusButtonWithMenu onAddPlace={() => {}} onAddNote={() => {}} />\n                             </div>\n"
                },
                {
                    "date": 1752588289424,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -356,15 +356,13 @@\n // Helper: PlusButtonWithMenu\n function PlusButtonWithMenu({ onAddPlace, onAddNote }: { onAddPlace: () => void; onAddNote: () => void }) {\n   const [open, setOpen] = useState(false);\n   return (\n-    <div className=\"relative flex flex-col items-center z-10 h-20 justify-center\">\n-      {/* Full vertical dotted line */}\n-      <div className=\"absolute left-1/2 top-0 -translate-x-1/2 h-full flex flex-col items-center pointer-events-none\" style={{ width: '1px' }}>\n-        <div className=\"h-full w-0.5 border-l-2 border-dotted border-gray-300\" />\n-      </div>\n+    <div className=\"relative flex flex-col items-center z-10 h-10 justify-center\">\n+      {/* Single dot above + */}\n+      <div className=\"w-1 h-1 rounded-full bg-gray-300 mb-1\" />\n       {/* Hoverable circle area */}\n-      <div className=\"relative z-10 flex items-center justify-center h-20\" style={{ minHeight: '48px' }}>\n+      <div className=\"relative z-10 flex items-center justify-center h-8\">\n         <button\n           className=\"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-8 h-8 rounded-full flex items-center justify-center transition bg-gray-100 opacity-0 hover:opacity-100 focus:opacity-100 group\"\n           style={{ boxShadow: '0 0 0 0 transparent' }}\n           onClick={() => setOpen((v) => !v)}\n@@ -373,8 +371,10 @@\n         >\n           <span className=\"text-lg text-gray-500\">+</span>\n         </button>\n       </div>\n+      {/* Single dot below + */}\n+      <div className=\"w-1 h-1 rounded-full bg-gray-300 mt-1\" />\n       {/* Popover menu */}\n       {open && (\n         <div className=\"absolute top-8 left-1/2 -translate-x-1/2 bg-white border border-gray-200 rounded-lg shadow-lg py-2 px-3 flex flex-col space-y-1 min-w-[120px] z-20\">\n           <button\n"
                },
                {
                    "date": 1752588380517,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -356,25 +356,21 @@\n // Helper: PlusButtonWithMenu\n function PlusButtonWithMenu({ onAddPlace, onAddNote }: { onAddPlace: () => void; onAddNote: () => void }) {\n   const [open, setOpen] = useState(false);\n   return (\n-    <div className=\"relative flex flex-col items-center z-10 h-10 justify-center\">\n-      {/* Single dot above + */}\n-      <div className=\"w-1 h-1 rounded-full bg-gray-300 mb-1\" />\n-      {/* Hoverable circle area */}\n-      <div className=\"relative z-10 flex items-center justify-center h-8\">\n-        <button\n-          className=\"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-8 h-8 rounded-full flex items-center justify-center transition bg-gray-100 opacity-0 hover:opacity-100 focus:opacity-100 group\"\n-          style={{ boxShadow: '0 0 0 0 transparent' }}\n-          onClick={() => setOpen((v) => !v)}\n-          aria-label=\"Add\"\n-          type=\"button\"\n-        >\n-          <span className=\"text-lg text-gray-500\">+</span>\n-        </button>\n-      </div>\n-      {/* Single dot below + */}\n-      <div className=\"w-1 h-1 rounded-full bg-gray-300 mt-1\" />\n+    <div className=\"relative flex flex-col items-center z-10 h-10 justify-center w-8\">\n+      {/* Continuous vertical dotted line */}\n+      <div className=\"absolute left-1/2 top-0 -translate-x-1/2 h-full w-0.5 border-l-2 border-dotted border-gray-300 pointer-events-none\" />\n+      {/* + button overlays the line, invisible by default, appears on hover */}\n+      <button\n+        className=\"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-8 h-8 rounded-full flex items-center justify-center transition bg-gray-100 opacity-0 hover:opacity-100 focus:opacity-100 group\"\n+        style={{ boxShadow: '0 0 0 0 transparent', zIndex: 2 }}\n+        onClick={() => setOpen((v) => !v)}\n+        aria-label=\"Add\"\n+        type=\"button\"\n+      >\n+        <span className=\"text-lg text-gray-500\">+</span>\n+      </button>\n       {/* Popover menu */}\n       {open && (\n         <div className=\"absolute top-8 left-1/2 -translate-x-1/2 bg-white border border-gray-200 rounded-lg shadow-lg py-2 px-3 flex flex-col space-y-1 min-w-[120px] z-20\">\n           <button\n"
                },
                {
                    "date": 1752588653933,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -146,14 +146,8 @@\n               >\n                 {destination.orderIndex}\n               </text>\n             </svg>\n-            {/* Dotted connector line below pin */}\n-            {!isLastItem && (\n-              <div className=\"absolute left-1/2 -bottom-4 transform -translate-x-1/2\">\n-                <div className=\"w-0.5 h-4 border-l-2 border-dotted border-gray-300\"></div>\n-              </div>\n-            )}\n           </div>\n           <div className=\"flex-1 min-w-0\">\n             <h4 className=\"font-medium text-gray-900 truncate\">\n               {destination.locationName}\n@@ -273,14 +267,8 @@\n               >\n                 {destination.orderIndex}\n               </text>\n             </svg>\n-            {/* Dotted connector line below pin */}\n-            {!isLastItem && (\n-              <div className=\"absolute left-1/2 -bottom-4 transform -translate-x-1/2\">\n-                <div className=\"w-0.5 h-4 border-l-2 border-dotted border-gray-300\"></div>\n-              </div>\n-            )}\n           </div>\n           <div className=\"flex-1 min-w-0\">\n             <div className=\"flex items-center\">\n               <h4 className=\"font-medium text-gray-900 truncate\">\n"
                },
                {
                    "date": 1752588810167,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -119,11 +119,11 @@\n             <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 8h16M4 16h16\" />\n           </svg>\n         </button>\n         {/* Gray box with pin, name, right drag handle */}\n-        <div className=\"flex items-center space-x-3 bg-gray-100 rounded-lg px-3 py-2 flex-1 min-w-0\">\n+        <div className=\"relative flex items-center space-x-3 bg-gray-100 rounded-lg px-3 py-2 flex-1 min-w-0\">\n           {/* Pin Number - Teardrop shape matching map */}\n-          <div className=\"flex-shrink-0 mt-0.5 relative cursor-grab\">\n+          <div className=\"absolute left-0 top-1/2 -translate-y-1/2 -translate-x-1/2 z-10\">\n             <svg \n               width=\"39\" \n               height=\"51\" \n               viewBox=\"0 0 39 51\" \n@@ -147,9 +147,9 @@\n                 {destination.orderIndex}\n               </text>\n             </svg>\n           </div>\n-          <div className=\"flex-1 min-w-0\">\n+          <div className=\"flex-1 min-w-0 ml-6\">\n             <h4 className=\"font-medium text-gray-900 truncate\">\n               {destination.locationName}\n             </h4>\n           </div>\n@@ -240,11 +240,11 @@\n             <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 8h16M4 16h16\" />\n           </svg>\n         </button>\n         {/* Gray box with pin, name, right drag handle, and extra info */}\n-        <div className=\"flex items-center space-x-3 bg-gray-100 rounded-lg px-3 py-2 flex-1 min-w-0\">\n+        <div className=\"relative flex items-center space-x-3 bg-gray-100 rounded-lg px-3 py-2 flex-1 min-w-0\">\n           {/* Pin Number - Teardrop shape matching map */}\n-          <div className=\"flex-shrink-0 mr-4 relative cursor-grab\">\n+          <div className=\"absolute left-0 top-1/2 -translate-y-1/2 -translate-x-1/2 z-10\">\n             <svg \n               width=\"39\" \n               height=\"51\" \n               viewBox=\"0 0 39 51\" \n@@ -268,9 +268,9 @@\n                 {destination.orderIndex}\n               </text>\n             </svg>\n           </div>\n-          <div className=\"flex-1 min-w-0\">\n+          <div className=\"flex-1 min-w-0 ml-6\">\n             <div className=\"flex items-center\">\n               <h4 className=\"font-medium text-gray-900 truncate\">\n                 {destination.locationName}\n               </h4>\n"
                },
                {
                    "date": 1752588935214,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -344,9 +344,9 @@\n // Helper: PlusButtonWithMenu\n function PlusButtonWithMenu({ onAddPlace, onAddNote }: { onAddPlace: () => void; onAddNote: () => void }) {\n   const [open, setOpen] = useState(false);\n   return (\n-    <div className=\"relative flex flex-col items-center z-10 h-10 justify-center w-8\">\n+    <div className=\"relative flex flex-col items-center z-10 h-12 justify-center w-8\">\n       {/* Continuous vertical dotted line */}\n       <div className=\"absolute left-1/2 top-0 -translate-x-1/2 h-full w-0.5 border-l-2 border-dotted border-gray-300 pointer-events-none\" />\n       {/* + button overlays the line, invisible by default, appears on hover */}\n       <button\n@@ -715,11 +715,11 @@\n                               onDestinationDelete={onDestinationDelete}\n                               isLastItem={idx === day.destinations.length - 1}\n                             />\n                           )}\n-                          {/* Insert + button and vertical dots only between pins, not after the last pin */}\n+                          {/* Only render between-pins area between two gray containers, not after the last pin */}\n                           {idx < day.destinations.length - 1 && (\n-                            <div className=\"flex justify-start ml-11 relative z-10\" style={{ marginTop: '-18px', marginBottom: '6px' }}>\n+                            <div className=\"flex justify-start ml-11 relative z-10\" style={{ height: '48px', alignItems: 'center' }}>\n                               <PlusButtonWithMenu onAddPlace={() => {}} onAddNote={() => {}} />\n                             </div>\n                           )}\n                         </div>\n"
                },
                {
                    "date": 1752589013768,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -715,11 +715,11 @@\n                               onDestinationDelete={onDestinationDelete}\n                               isLastItem={idx === day.destinations.length - 1}\n                             />\n                           )}\n-                          {/* Only render between-pins area between two gray containers, not after the last pin */}\n+                          {/* Only render between-pins area between two gray containers, not after the last pin, and align with pin center */}\n                           {idx < day.destinations.length - 1 && (\n-                            <div className=\"flex justify-start ml-11 relative z-10\" style={{ height: '48px', alignItems: 'center' }}>\n+                            <div className=\"flex justify-start relative z-10\" style={{ height: '48px', alignItems: 'center', marginLeft: '19.5px' }}>\n                               <PlusButtonWithMenu onAddPlace={() => {}} onAddNote={() => {}} />\n                             </div>\n                           )}\n                         </div>\n"
                },
                {
                    "date": 1752589136940,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -717,9 +717,9 @@\n                             />\n                           )}\n                           {/* Only render between-pins area between two gray containers, not after the last pin, and align with pin center */}\n                           {idx < day.destinations.length - 1 && (\n-                            <div className=\"flex justify-start relative z-10\" style={{ height: '48px', alignItems: 'center', marginLeft: '19.5px' }}>\n+                            <div className=\"flex justify-start relative z-10 -mt-2 -mb-2\" style={{ height: '44px', alignItems: 'center', marginLeft: '19.5px' }}>\n                               <PlusButtonWithMenu onAddPlace={() => {}} onAddNote={() => {}} />\n                             </div>\n                           )}\n                         </div>\n"
                },
                {
                    "date": 1752589154654,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -717,9 +717,9 @@\n                             />\n                           )}\n                           {/* Only render between-pins area between two gray containers, not after the last pin, and align with pin center */}\n                           {idx < day.destinations.length - 1 && (\n-                            <div className=\"flex justify-start relative z-10 -mt-2 -mb-2\" style={{ height: '44px', alignItems: 'center', marginLeft: '19.5px' }}>\n+                            <div className=\"flex justify-start relative z-10\" style={{ height: '48px', alignItems: 'center', marginLeft: '19.5px' }}>\n                               <PlusButtonWithMenu onAddPlace={() => {}} onAddNote={() => {}} />\n                             </div>\n                           )}\n                         </div>\n"
                },
                {
                    "date": 1752591900307,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -717,10 +717,15 @@\n                             />\n                           )}\n                           {/* Only render between-pins area between two gray containers, not after the last pin, and align with pin center */}\n                           {idx < day.destinations.length - 1 && (\n-                            <div className=\"flex justify-start relative z-10\" style={{ height: '48px', alignItems: 'center', marginLeft: '19.5px' }}>\n-                              <PlusButtonWithMenu onAddPlace={() => {}} onAddNote={() => {}} />\n+                            <div className=\"w-10 relative flex flex-col items-center\">\n+                              <div className=\"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-10\">\n+                                <PlusButtonWithMenu onAddPlace={() => {}} onAddNote={() => {}} />\n+                              </div>\n+                              <div className=\"absolute top-full left-1/2 -translate-x-1/2 z-0 w-0.5 h-12 flex flex-col items-center\">\n+                                <PlusButtonWithMenu onAddPlace={() => {}} onAddNote={() => {}} />\n+                              </div>\n                             </div>\n                           )}\n                         </div>\n                       ))}\n"
                },
                {
                    "date": 1752592010279,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -715,17 +715,12 @@\n                               onDestinationDelete={onDestinationDelete}\n                               isLastItem={idx === day.destinations.length - 1}\n                             />\n                           )}\n-                          {/* Only render between-pins area between two gray containers, not after the last pin, and align with pin center */}\n+                          {/* Only render between-pins area between two gray containers, not after the last pin, and align with text/content start */}\n                           {idx < day.destinations.length - 1 && (\n-                            <div className=\"w-10 relative flex flex-col items-center\">\n-                              <div className=\"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-10\">\n-                                <PlusButtonWithMenu onAddPlace={() => {}} onAddNote={() => {}} />\n-                              </div>\n-                              <div className=\"absolute top-full left-1/2 -translate-x-1/2 z-0 w-0.5 h-12 flex flex-col items-center\">\n-                                <PlusButtonWithMenu onAddPlace={() => {}} onAddNote={() => {}} />\n-                              </div>\n+                            <div className=\"flex justify-start ml-6 relative z-10 -mt-2 -mb-2\" style={{ height: '44px', alignItems: 'center' }}>\n+                              <PlusButtonWithMenu onAddPlace={() => {}} onAddNote={() => {}} />\n                             </div>\n                           )}\n                         </div>\n                       ))}\n"
                },
                {
                    "date": 1752592122233,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -715,22 +715,16 @@\n                               onDestinationDelete={onDestinationDelete}\n                               isLastItem={idx === day.destinations.length - 1}\n                             />\n                           )}\n-                          {/* Only render between-pins area between two gray containers, not after the last pin, and align with text/content start */}\n+                          {/* Only render between-pins area between two gray containers, not after the last pin */}\n                           {idx < day.destinations.length - 1 && (\n                             <div className=\"flex justify-start ml-6 relative z-10 -mt-2 -mb-2\" style={{ height: '44px', alignItems: 'center' }}>\n                               <PlusButtonWithMenu onAddPlace={() => {}} onAddNote={() => {}} />\n                             </div>\n                           )}\n                         </div>\n                       ))}\n-                      {/* After the last pin, if there are any destinations */}\n-                      {day.destinations.length > 0 && (\n-                        <div className=\"flex justify-start ml-11 relative z-10\" style={{ marginTop: '-18px', marginBottom: '6px' }}>\n-                          <PlusButtonWithMenu onAddPlace={() => {}} onAddNote={() => {}} />\n-                        </div>\n-                      )}\n                     </SortableContext>\n                   </DndContext>\n                 )}\n                 \n"
                },
                {
                    "date": 1752592253001,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -344,24 +344,26 @@\n // Helper: PlusButtonWithMenu\n function PlusButtonWithMenu({ onAddPlace, onAddNote }: { onAddPlace: () => void; onAddNote: () => void }) {\n   const [open, setOpen] = useState(false);\n   return (\n-    <div className=\"relative flex flex-col items-center z-10 h-12 justify-center w-8\">\n-      {/* Continuous vertical dotted line */}\n-      <div className=\"absolute left-1/2 top-0 -translate-x-1/2 h-full w-0.5 border-l-2 border-dotted border-gray-300 pointer-events-none\" />\n-      {/* + button overlays the line, invisible by default, appears on hover */}\n+    <div className=\"flex flex-col items-center justify-center h-16 relative z-10\">\n+      {/* Dotted line above + */}\n+      <div className=\"w-0.5 flex-1 border-l-2 border-dotted border-gray-300\" style={{ minHeight: '12px' }} />\n+      {/* + button, centered */}\n       <button\n-        className=\"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-8 h-8 rounded-full flex items-center justify-center transition bg-gray-100 opacity-0 hover:opacity-100 focus:opacity-100 group\"\n-        style={{ boxShadow: '0 0 0 0 transparent', zIndex: 2 }}\n+        className=\"w-8 h-8 rounded-full flex items-center justify-center transition bg-gray-100 opacity-0 hover:opacity-100 focus:opacity-100 group z-10\"\n+        style={{ boxShadow: '0 0 0 0 transparent' }}\n         onClick={() => setOpen((v) => !v)}\n         aria-label=\"Add\"\n         type=\"button\"\n       >\n         <span className=\"text-lg text-gray-500\">+</span>\n       </button>\n+      {/* Dotted line below + */}\n+      <div className=\"w-0.5 flex-1 border-l-2 border-dotted border-gray-300\" style={{ minHeight: '12px' }} />\n       {/* Popover menu */}\n       {open && (\n-        <div className=\"absolute top-8 left-1/2 -translate-x-1/2 bg-white border border-gray-200 rounded-lg shadow-lg py-2 px-3 flex flex-col space-y-1 min-w-[120px] z-20\">\n+        <div className=\"absolute top-10 left-1/2 -translate-x-1/2 bg-white border border-gray-200 rounded-lg shadow-lg py-2 px-3 flex flex-col space-y-1 min-w-[120px] z-20\">\n           <button\n             className=\"text-sm text-gray-700 hover:bg-gray-100 rounded px-2 py-1 text-left\"\n             onClick={() => { setOpen(false); onAddPlace(); }}\n             type=\"button\"\n"
                },
                {
                    "date": 1752592268330,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -344,26 +344,24 @@\n // Helper: PlusButtonWithMenu\n function PlusButtonWithMenu({ onAddPlace, onAddNote }: { onAddPlace: () => void; onAddNote: () => void }) {\n   const [open, setOpen] = useState(false);\n   return (\n-    <div className=\"flex flex-col items-center justify-center h-16 relative z-10\">\n-      {/* Dotted line above + */}\n-      <div className=\"w-0.5 flex-1 border-l-2 border-dotted border-gray-300\" style={{ minHeight: '12px' }} />\n-      {/* + button, centered */}\n+    <div className=\"relative flex flex-col items-center z-10 h-12 justify-center w-8\">\n+      {/* Continuous vertical dotted line */}\n+      <div className=\"absolute left-1/2 top-0 -translate-x-1/2 h-full w-0.5 border-l-2 border-dotted border-gray-300 pointer-events-none\" />\n+      {/* + button overlays the line, invisible by default, appears on hover */}\n       <button\n-        className=\"w-8 h-8 rounded-full flex items-center justify-center transition bg-gray-100 opacity-0 hover:opacity-100 focus:opacity-100 group z-10\"\n-        style={{ boxShadow: '0 0 0 0 transparent' }}\n+        className=\"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-8 h-8 rounded-full flex items-center justify-center transition bg-gray-100 opacity-0 hover:opacity-100 focus:opacity-100 group\"\n+        style={{ boxShadow: '0 0 0 0 transparent', zIndex: 2 }}\n         onClick={() => setOpen((v) => !v)}\n         aria-label=\"Add\"\n         type=\"button\"\n       >\n         <span className=\"text-lg text-gray-500\">+</span>\n       </button>\n-      {/* Dotted line below + */}\n-      <div className=\"w-0.5 flex-1 border-l-2 border-dotted border-gray-300\" style={{ minHeight: '12px' }} />\n       {/* Popover menu */}\n       {open && (\n-        <div className=\"absolute top-10 left-1/2 -translate-x-1/2 bg-white border border-gray-200 rounded-lg shadow-lg py-2 px-3 flex flex-col space-y-1 min-w-[120px] z-20\">\n+        <div className=\"absolute top-8 left-1/2 -translate-x-1/2 bg-white border border-gray-200 rounded-lg shadow-lg py-2 px-3 flex flex-col space-y-1 min-w-[120px] z-20\">\n           <button\n             className=\"text-sm text-gray-700 hover:bg-gray-100 rounded px-2 py-1 text-left\"\n             onClick={() => { setOpen(false); onAddPlace(); }}\n             type=\"button\"\n"
                },
                {
                    "date": 1752592353823,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -344,9 +344,9 @@\n // Helper: PlusButtonWithMenu\n function PlusButtonWithMenu({ onAddPlace, onAddNote }: { onAddPlace: () => void; onAddNote: () => void }) {\n   const [open, setOpen] = useState(false);\n   return (\n-    <div className=\"relative flex flex-col items-center z-10 h-12 justify-center w-8\">\n+    <div className=\"relative flex flex-col items-center justify-center z-10 h-full w-8\">\n       {/* Continuous vertical dotted line */}\n       <div className=\"absolute left-1/2 top-0 -translate-x-1/2 h-full w-0.5 border-l-2 border-dotted border-gray-300 pointer-events-none\" />\n       {/* + button overlays the line, invisible by default, appears on hover */}\n       <button\n@@ -717,9 +717,9 @@\n                             />\n                           )}\n                           {/* Only render between-pins area between two gray containers, not after the last pin */}\n                           {idx < day.destinations.length - 1 && (\n-                            <div className=\"flex justify-start ml-6 relative z-10 -mt-2 -mb-2\" style={{ height: '44px', alignItems: 'center' }}>\n+                            <div className=\"flex flex-col items-center justify-center ml-6 relative z-10\" style={{ height: '44px' }}>\n                               <PlusButtonWithMenu onAddPlace={() => {}} onAddNote={() => {}} />\n                             </div>\n                           )}\n                         </div>\n"
                },
                {
                    "date": 1752592387333,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -344,9 +344,9 @@\n // Helper: PlusButtonWithMenu\n function PlusButtonWithMenu({ onAddPlace, onAddNote }: { onAddPlace: () => void; onAddNote: () => void }) {\n   const [open, setOpen] = useState(false);\n   return (\n-    <div className=\"relative flex flex-col items-center justify-center z-10 h-full w-8\">\n+    <div className=\"relative flex flex-col items-center z-10 h-12 justify-center w-8\">\n       {/* Continuous vertical dotted line */}\n       <div className=\"absolute left-1/2 top-0 -translate-x-1/2 h-full w-0.5 border-l-2 border-dotted border-gray-300 pointer-events-none\" />\n       {/* + button overlays the line, invisible by default, appears on hover */}\n       <button\n@@ -717,9 +717,9 @@\n                             />\n                           )}\n                           {/* Only render between-pins area between two gray containers, not after the last pin */}\n                           {idx < day.destinations.length - 1 && (\n-                            <div className=\"flex flex-col items-center justify-center ml-6 relative z-10\" style={{ height: '44px' }}>\n+                            <div className=\"flex justify-start ml-6 relative z-10 -mt-2 -mb-2\" style={{ height: '44px', alignItems: 'center' }}>\n                               <PlusButtonWithMenu onAddPlace={() => {}} onAddNote={() => {}} />\n                             </div>\n                           )}\n                         </div>\n"
                },
                {
                    "date": 1752592564900,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -344,9 +344,9 @@\n // Helper: PlusButtonWithMenu\n function PlusButtonWithMenu({ onAddPlace, onAddNote }: { onAddPlace: () => void; onAddNote: () => void }) {\n   const [open, setOpen] = useState(false);\n   return (\n-    <div className=\"relative flex flex-col items-center z-10 h-12 justify-center w-8\">\n+    <div className=\"relative flex flex-col items-center justify-center z-10 h-full w-8 overflow-visible\">\n       {/* Continuous vertical dotted line */}\n       <div className=\"absolute left-1/2 top-0 -translate-x-1/2 h-full w-0.5 border-l-2 border-dotted border-gray-300 pointer-events-none\" />\n       {/* + button overlays the line, invisible by default, appears on hover */}\n       <button\n@@ -717,9 +717,9 @@\n                             />\n                           )}\n                           {/* Only render between-pins area between two gray containers, not after the last pin */}\n                           {idx < day.destinations.length - 1 && (\n-                            <div className=\"flex justify-start ml-6 relative z-10 -mt-2 -mb-2\" style={{ height: '44px', alignItems: 'center' }}>\n+                            <div className=\"flex flex-col items-center justify-center ml-6 relative z-10 h-10\" style={{ alignItems: 'center' }}>\n                               <PlusButtonWithMenu onAddPlace={() => {}} onAddNote={() => {}} />\n                             </div>\n                           )}\n                         </div>\n"
                },
                {
                    "date": 1752592629830,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -357,8 +357,10 @@\n         type=\"button\"\n       >\n         <span className=\"text-lg text-gray-500\">+</span>\n       </button>\n+      {/* 2px invisible space at the bottom */}\n+      <div className=\"w-full h-0.5 invisible\" />\n       {/* Popover menu */}\n       {open && (\n         <div className=\"absolute top-8 left-1/2 -translate-x-1/2 bg-white border border-gray-200 rounded-lg shadow-lg py-2 px-3 flex flex-col space-y-1 min-w-[120px] z-20\">\n           <button\n"
                },
                {
                    "date": 1752592674801,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -357,10 +357,10 @@\n         type=\"button\"\n       >\n         <span className=\"text-lg text-gray-500\">+</span>\n       </button>\n-      {/* 2px invisible space at the bottom */}\n-      <div className=\"w-full h-0.5 invisible\" />\n+      {/* 5-6px invisible space at the bottom */}\n+      <div className=\"w-full h-1.5 invisible\" />\n       {/* Popover menu */}\n       {open && (\n         <div className=\"absolute top-8 left-1/2 -translate-x-1/2 bg-white border border-gray-200 rounded-lg shadow-lg py-2 px-3 flex flex-col space-y-1 min-w-[120px] z-20\">\n           <button\n"
                },
                {
                    "date": 1752592696259,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -357,10 +357,10 @@\n         type=\"button\"\n       >\n         <span className=\"text-lg text-gray-500\">+</span>\n       </button>\n-      {/* 5-6px invisible space at the bottom */}\n-      <div className=\"w-full h-1.5 invisible\" />\n+      {/* 50px invisible space at the bottom */}\n+      <div className=\"w-full h-[50px] invisible\" />\n       {/* Popover menu */}\n       {open && (\n         <div className=\"absolute top-8 left-1/2 -translate-x-1/2 bg-white border border-gray-200 rounded-lg shadow-lg py-2 px-3 flex flex-col space-y-1 min-w-[120px] z-20\">\n           <button\n"
                },
                {
                    "date": 1752592753163,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -345,10 +345,10 @@\n function PlusButtonWithMenu({ onAddPlace, onAddNote }: { onAddPlace: () => void; onAddNote: () => void }) {\n   const [open, setOpen] = useState(false);\n   return (\n     <div className=\"relative flex flex-col items-center justify-center z-10 h-full w-8 overflow-visible\">\n-      {/* Continuous vertical dotted line */}\n-      <div className=\"absolute left-1/2 top-0 -translate-x-1/2 h-full w-0.5 border-l-2 border-dotted border-gray-300 pointer-events-none\" />\n+      {/* Continuous vertical dotted line with extra margin at the bottom */}\n+      <div className=\"absolute left-1/2 top-0 -translate-x-1/2 h-full w-0.5 border-l-2 border-dotted border-gray-300 pointer-events-none mb-[50px]\" />\n       {/* + button overlays the line, invisible by default, appears on hover */}\n       <button\n         className=\"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-8 h-8 rounded-full flex items-center justify-center transition bg-gray-100 opacity-0 hover:opacity-100 focus:opacity-100 group\"\n         style={{ boxShadow: '0 0 0 0 transparent', zIndex: 2 }}\n@@ -357,10 +357,8 @@\n         type=\"button\"\n       >\n         <span className=\"text-lg text-gray-500\">+</span>\n       </button>\n-      {/* 50px invisible space at the bottom */}\n-      <div className=\"w-full h-[50px] invisible\" />\n       {/* Popover menu */}\n       {open && (\n         <div className=\"absolute top-8 left-1/2 -translate-x-1/2 bg-white border border-gray-200 rounded-lg shadow-lg py-2 px-3 flex flex-col space-y-1 min-w-[120px] z-20\">\n           <button\n"
                },
                {
                    "date": 1752592787807,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -345,10 +345,12 @@\n function PlusButtonWithMenu({ onAddPlace, onAddNote }: { onAddPlace: () => void; onAddNote: () => void }) {\n   const [open, setOpen] = useState(false);\n   return (\n     <div className=\"relative flex flex-col items-center justify-center z-10 h-full w-8 overflow-visible\">\n-      {/* Continuous vertical dotted line with extra margin at the bottom */}\n-      <div className=\"absolute left-1/2 top-0 -translate-x-1/2 h-full w-0.5 border-l-2 border-dotted border-gray-300 pointer-events-none mb-[50px]\" />\n+      {/* Continuous vertical dotted line */}\n+      <div className=\"absolute left-1/2 top-0 -translate-x-1/2 h-full w-0.5 border-l-2 border-dotted border-gray-300 pointer-events-none\" />\n+      {/* 50px invisible space at the bottom */}\n+      <div className=\"w-full h-[50px] invisible\" />\n       {/* + button overlays the line, invisible by default, appears on hover */}\n       <button\n         className=\"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-8 h-8 rounded-full flex items-center justify-center transition bg-gray-100 opacity-0 hover:opacity-100 focus:opacity-100 group\"\n         style={{ boxShadow: '0 0 0 0 transparent', zIndex: 2 }}\n"
                },
                {
                    "date": 1752593014424,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -347,8 +347,10 @@\n   return (\n     <div className=\"relative flex flex-col items-center justify-center z-10 h-full w-8 overflow-visible\">\n       {/* Continuous vertical dotted line */}\n       <div className=\"absolute left-1/2 top-0 -translate-x-1/2 h-full w-0.5 border-l-2 border-dotted border-gray-300 pointer-events-none\" />\n+      {/* White overlay to hide the last dot but keep the space */}\n+      <div className=\"absolute left-0 bottom-0 w-full h-2 bg-white z-20\" />\n       {/* 50px invisible space at the bottom */}\n       <div className=\"w-full h-[50px] invisible\" />\n       {/* + button overlays the line, invisible by default, appears on hover */}\n       <button\n"
                },
                {
                    "date": 1752593064700,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -348,9 +348,9 @@\n     <div className=\"relative flex flex-col items-center justify-center z-10 h-full w-8 overflow-visible\">\n       {/* Continuous vertical dotted line */}\n       <div className=\"absolute left-1/2 top-0 -translate-x-1/2 h-full w-0.5 border-l-2 border-dotted border-gray-300 pointer-events-none\" />\n       {/* White overlay to hide the last dot but keep the space */}\n-      <div className=\"absolute left-0 bottom-0 w-full h-2 bg-white z-20\" />\n+      {/* Remove the white overlay div at the bottom of the vertical dotted line */}\n       {/* 50px invisible space at the bottom */}\n       <div className=\"w-full h-[50px] invisible\" />\n       {/* + button overlays the line, invisible by default, appears on hover */}\n       <button\n"
                },
                {
                    "date": 1752593466938,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -73,16 +73,20 @@\n   dayColor, \n   selectedDestination,\n   onDestinationSelect,\n   onDestinationDelete,\n-  isLastItem \n+  isLastItem, \n+  selectedPinIds,\n+  handleCheckboxChange\n }: {\n   destination: Destination;\n   dayColor: any;\n   selectedDestination: Destination | null;\n   onDestinationSelect: (destination: Destination) => void;\n   onDestinationDelete: (destinationId: string) => void;\n   isLastItem: boolean;\n+  selectedPinIds: string[];\n+  handleCheckboxChange: (id: string, checked: boolean) => void;\n }) {\n   const {\n     attributes,\n     listeners,\n@@ -178,8 +182,15 @@\n           <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n             <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\n           </svg>\n         </button>\n+        {/* Checkbox */}\n+        <input\n+          type=\"checkbox\"\n+          className=\"mr-2\"\n+          checked={selectedPinIds.includes(destination.id)}\n+          onChange={e => handleCheckboxChange(destination.id, e.target.checked)}\n+        />\n       </div>\n     </div>\n   );\n }\n@@ -190,16 +201,20 @@\n   dayColor,\n   selectedDestination,\n   onDestinationSelect,\n   onDestinationDelete,\n-  isLastItem\n+  isLastItem,\n+  selectedPinIds,\n+  handleCheckboxChange\n }: {\n   destination: Destination;\n   dayColor: any;\n   selectedDestination: Destination | null;\n   onDestinationSelect: (destination: Destination) => void;\n   onDestinationDelete: (destinationId: string) => void;\n   isLastItem: boolean;\n+  selectedPinIds: string[];\n+  handleCheckboxChange: (id: string, checked: boolean) => void;\n }) {\n   const {\n     setNodeRef,\n     transform,\n@@ -335,8 +350,15 @@\n           <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n             <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\n           </svg>\n         </button>\n+        {/* Checkbox */}\n+        <input\n+          type=\"checkbox\"\n+          className=\"mr-2\"\n+          checked={selectedPinIds.includes(destination.id)}\n+          onChange={e => handleCheckboxChange(destination.id, e.target.checked)}\n+        />\n       </div>\n     </div>\n   );\n }\n@@ -400,8 +422,10 @@\n   const [isReordering, setIsReordering] = useState(false);\n   const [activeId, setActiveId] = useState<string | null>(null);\n   const [overId, setOverId] = useState<UniqueIdentifier | null>(null);\n   const [viewMode, setViewMode] = useState<'picture' | 'compact'>('compact');\n+  // 1. Add state to track selected pins\n+  const [selectedPinIds, setSelectedPinIds] = useState<string[]>([]);\n \n   const sensors = useSensors(\n     useSensor(PointerSensor, {\n       activationConstraint: {\n@@ -423,8 +447,17 @@\n     setExpandedDays(newExpanded);\n     onDaySelect(day);\n   };\n \n+  // 2. Add a checkbox to the left of each pin in both SortableDestination and SortableDestinationPicture\n+  // 3. Checkbox is checked if the pin's id is in selectedPinIds\n+  // 4. On change, add/remove the pin's id from selectedPinIds\n+  const handleCheckboxChange = (id: string, checked: boolean) => {\n+    setSelectedPinIds((prev) =>\n+      checked ? [...prev, id] : prev.filter((pid) => pid !== id)\n+    );\n+  };\n+\n   // Get all destinations for sortable context\n   const allDestinations = tripDays.flatMap(day => day.destinations);\n \n   const handleDragStart = (event: any) => {\n@@ -708,8 +741,10 @@\n                               selectedDestination={selectedDestination}\n                               onDestinationSelect={onDestinationSelect}\n                               onDestinationDelete={onDestinationDelete}\n                               isLastItem={idx === day.destinations.length - 1}\n+                              selectedPinIds={selectedPinIds}\n+                              handleCheckboxChange={handleCheckboxChange}\n                             />\n                           ) : (\n                             <SortableDestinationPicture\n                               destination={destination}\n@@ -717,8 +752,10 @@\n                               selectedDestination={selectedDestination}\n                               onDestinationSelect={onDestinationSelect}\n                               onDestinationDelete={onDestinationDelete}\n                               isLastItem={idx === day.destinations.length - 1}\n+                              selectedPinIds={selectedPinIds}\n+                              handleCheckboxChange={handleCheckboxChange}\n                             />\n                           )}\n                           {/* Only render between-pins area between two gray containers, not after the last pin */}\n                           {idx < day.destinations.length - 1 && (\n"
                },
                {
                    "date": 1752593610325,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -111,8 +111,15 @@\n         style={style}\n         {...attributes}\n         {...listeners}\n       >\n+        {/* Checkbox */}\n+        <input\n+          type=\"checkbox\"\n+          className=\"mr-2\"\n+          checked={selectedPinIds.includes(destination.id)}\n+          onChange={e => handleCheckboxChange(destination.id, e.target.checked)}\n+        />\n         {/* Drag handle on the far left (outside gray box) */}\n         <button\n           className=\"flex-shrink-0 mr-2 cursor-grab active:cursor-grabbing p-1 rounded hover:bg-gray-200 opacity-0 group-hover:opacity-100 transition-opacity\"\n           aria-label=\"Drag to reorder\"\n@@ -182,15 +189,8 @@\n           <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n             <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\n           </svg>\n         </button>\n-        {/* Checkbox */}\n-        <input\n-          type=\"checkbox\"\n-          className=\"mr-2\"\n-          checked={selectedPinIds.includes(destination.id)}\n-          onChange={e => handleCheckboxChange(destination.id, e.target.checked)}\n-        />\n       </div>\n     </div>\n   );\n }\n@@ -243,8 +243,15 @@\n         className=\"flex items-center group mb-2 cursor-grab\"\n         {...attributes}\n         {...listeners}\n       >\n+        {/* Checkbox */}\n+        <input\n+          type=\"checkbox\"\n+          className=\"mr-2\"\n+          checked={selectedPinIds.includes(destination.id)}\n+          onChange={e => handleCheckboxChange(destination.id, e.target.checked)}\n+        />\n         {/* Drag handle on the far left (outside gray box) */}\n         <button\n           className=\"flex-shrink-0 mr-2 cursor-grab active:cursor-grabbing p-1 rounded hover:bg-gray-200 opacity-0 group-hover:opacity-100 transition-opacity\"\n           aria-label=\"Drag to reorder\"\n@@ -350,15 +357,8 @@\n           <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n             <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\n           </svg>\n         </button>\n-        {/* Checkbox */}\n-        <input\n-          type=\"checkbox\"\n-          className=\"mr-2\"\n-          checked={selectedPinIds.includes(destination.id)}\n-          onChange={e => handleCheckboxChange(destination.id, e.target.checked)}\n-        />\n       </div>\n     </div>\n   );\n }\n"
                },
                {
                    "date": 1752593655115,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -114,9 +114,9 @@\n       >\n         {/* Checkbox */}\n         <input\n           type=\"checkbox\"\n-          className=\"mr-2\"\n+          className=\"mr-2 ml-4\"\n           checked={selectedPinIds.includes(destination.id)}\n           onChange={e => handleCheckboxChange(destination.id, e.target.checked)}\n         />\n         {/* Drag handle on the far left (outside gray box) */}\n@@ -246,9 +246,9 @@\n       >\n         {/* Checkbox */}\n         <input\n           type=\"checkbox\"\n-          className=\"mr-2\"\n+          className=\"mr-2 ml-4\"\n           checked={selectedPinIds.includes(destination.id)}\n           onChange={e => handleCheckboxChange(destination.id, e.target.checked)}\n         />\n         {/* Drag handle on the far left (outside gray box) */}\n"
                },
                {
                    "date": 1752593698115,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -663,8 +663,22 @@\n       <div className=\"p-4 border-b border-gray-200 flex items-center\">\n         <h2 className=\"text-lg font-semibold text-gray-900\">Itinerary</h2>\n         {renderViewToggle()}\n       </div>\n+      {/* In ItineraryPanel, render a gray overlay above the title if selectedPinIds.length > 0 */}\n+      {/* Place this just before the header/title */}\n+      {selectedPinIds.length > 0 && (\n+        <div className=\"absolute left-0 top-0 w-full flex flex-col items-center z-30\">\n+          <div className=\"w-full bg-gray-200 border-b border-gray-300 py-3 px-4 flex items-center justify-between shadow-md\">\n+            <div className=\"flex items-center gap-2\">\n+              <button className=\"bg-white text-gray-700 rounded px-3 py-1 text-sm font-medium shadow hover:bg-gray-100\">Copy to</button>\n+              <button className=\"bg-white text-gray-700 rounded px-3 py-1 text-sm font-medium shadow hover:bg-gray-100\">Move to</button>\n+              <button className=\"bg-red-500 text-white rounded px-3 py-1 text-sm font-medium shadow hover:bg-red-600\">Delete</button>\n+            </div>\n+            <button className=\"text-gray-500 hover:text-gray-700 text-xl font-bold px-2\" onClick={() => setSelectedPinIds([])} title=\"Clear selection\">×</button>\n+          </div>\n+        </div>\n+      )}\n       {/* Days and Destinations */}\n       <div ref={scrollRef} className=\"flex-1 overflow-y-auto hide-native-scrollbar\">\n         {tripDays.map((day) => (\n           <div key={day.day} className=\"border-b border-gray-100\">\n"
                },
                {
                    "date": 1752593791805,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -667,15 +667,15 @@\n       {/* In ItineraryPanel, render a gray overlay above the title if selectedPinIds.length > 0 */}\n       {/* Place this just before the header/title */}\n       {selectedPinIds.length > 0 && (\n         <div className=\"absolute left-0 top-0 w-full flex flex-col items-center z-30\">\n-          <div className=\"w-full bg-gray-200 border-b border-gray-300 py-3 px-4 flex items-center justify-between shadow-md\">\n-            <div className=\"flex items-center gap-2\">\n-              <button className=\"bg-white text-gray-700 rounded px-3 py-1 text-sm font-medium shadow hover:bg-gray-100\">Copy to</button>\n-              <button className=\"bg-white text-gray-700 rounded px-3 py-1 text-sm font-medium shadow hover:bg-gray-100\">Move to</button>\n-              <button className=\"bg-red-500 text-white rounded px-3 py-1 text-sm font-medium shadow hover:bg-red-600\">Delete</button>\n+          <div className=\"mx-auto mt-0 bg-gray-200/80 border-b border-gray-300 py-3 px-4 flex items-center justify-between shadow-md rounded-b-xl\" style={{ maxWidth: '700px', width: '100%' }}>\n+            <div className=\"flex items-center gap-4\">\n+              <button className=\"text-gray-700 text-base font-medium hover:underline hover:text-primary-600 transition\">Copy to</button>\n+              <button className=\"text-gray-700 text-base font-medium hover:underline hover:text-primary-600 transition\">Move to</button>\n+              <button className=\"text-red-500 text-base font-medium hover:underline hover:text-red-700 transition\">Delete</button>\n             </div>\n-            <button className=\"text-gray-500 hover:text-gray-700 text-xl font-bold px-2\" onClick={() => setSelectedPinIds([])} title=\"Clear selection\">×</button>\n+            <button className=\"text-gray-400 hover:text-gray-700 text-2xl font-bold px-2\" onClick={() => setSelectedPinIds([])} title=\"Clear selection\">×</button>\n           </div>\n         </div>\n       )}\n       {/* Days and Destinations */}\n"
                },
                {
                    "date": 1752593897938,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -667,9 +667,9 @@\n       {/* In ItineraryPanel, render a gray overlay above the title if selectedPinIds.length > 0 */}\n       {/* Place this just before the header/title */}\n       {selectedPinIds.length > 0 && (\n         <div className=\"absolute left-0 top-0 w-full flex flex-col items-center z-30\">\n-          <div className=\"mx-auto mt-0 bg-gray-200/80 border-b border-gray-300 py-3 px-4 flex items-center justify-between shadow-md rounded-b-xl\" style={{ maxWidth: '700px', width: '100%' }}>\n+          <div className=\"ml-6 mt-0 bg-gray-200/80 border-b border-gray-300 py-3 px-4 flex items-center justify-between shadow-md rounded-b-xl\" style={{ maxWidth: '700px', width: '100%' }}>\n             <div className=\"flex items-center gap-4\">\n               <button className=\"text-gray-700 text-base font-medium hover:underline hover:text-primary-600 transition\">Copy to</button>\n               <button className=\"text-gray-700 text-base font-medium hover:underline hover:text-primary-600 transition\">Move to</button>\n               <button className=\"text-red-500 text-base font-medium hover:underline hover:text-red-700 transition\">Delete</button>\n"
                },
                {
                    "date": 1752593985435,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -424,8 +424,10 @@\n   const [overId, setOverId] = useState<UniqueIdentifier | null>(null);\n   const [viewMode, setViewMode] = useState<'picture' | 'compact'>('compact');\n   // 1. Add state to track selected pins\n   const [selectedPinIds, setSelectedPinIds] = useState<string[]>([]);\n+  // In ItineraryPanel, add state for which dropdown is open\n+  const [bulkDropdown, setBulkDropdown] = useState<'copy' | 'move' | null>(null);\n \n   const sensors = useSensors(\n     useSensor(PointerSensor, {\n       activationConstraint: {\n"
                },
                {
                    "date": 1752594065628,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -458,8 +458,45 @@\n       checked ? [...prev, id] : prev.filter((pid) => pid !== id)\n     );\n   };\n \n+  // Add logic for Copy to, Move to, and Delete actions\n+  const handleBulkCopyTo = (dayNum: number) => {\n+    // Copy selected destinations to the chosen day\n+    const toCopy = allDestinations.filter(dest => selectedPinIds.includes(dest.id));\n+    const maxOrder = Math.max(0, ...tripDays.find(d => d.day === dayNum)?.destinations.map(d => d.orderIndex) || []);\n+    const copied = toCopy.map((dest, i) => ({\n+      ...dest,\n+      id: `${dest.id}-copy-${Date.now()}-${i}`,\n+      day: dayNum,\n+      orderIndex: maxOrder + i + 1\n+    }));\n+    onDestinationsChange([...allDestinations, ...copied]);\n+    setSelectedPinIds([]);\n+    setBulkDropdown(null);\n+  };\n+  const handleBulkMoveTo = (dayNum: number) => {\n+    // Move selected destinations to the chosen day\n+    const toMove = allDestinations.filter(dest => selectedPinIds.includes(dest.id));\n+    const notMoved = allDestinations.filter(dest => !selectedPinIds.includes(dest.id));\n+    const maxOrder = Math.max(0, ...tripDays.find(d => d.day === dayNum)?.destinations.map(d => d.orderIndex) || []);\n+    const moved = toMove.map((dest, i) => ({\n+      ...dest,\n+      day: dayNum,\n+      orderIndex: maxOrder + i + 1\n+    }));\n+    onDestinationsChange([...notMoved, ...moved]);\n+    setSelectedPinIds([]);\n+    setBulkDropdown(null);\n+  };\n+  const handleBulkDelete = () => {\n+    // Delete selected destinations\n+    const remaining = allDestinations.filter(dest => !selectedPinIds.includes(dest.id));\n+    onDestinationsChange(remaining);\n+    setSelectedPinIds([]);\n+    setBulkDropdown(null);\n+  };\n+\n   // Get all destinations for sortable context\n   const allDestinations = tripDays.flatMap(day => day.destinations);\n \n   const handleDragStart = (event: any) => {\n@@ -670,12 +707,34 @@\n       {/* Place this just before the header/title */}\n       {selectedPinIds.length > 0 && (\n         <div className=\"absolute left-0 top-0 w-full flex flex-col items-center z-30\">\n           <div className=\"ml-6 mt-0 bg-gray-200/80 border-b border-gray-300 py-3 px-4 flex items-center justify-between shadow-md rounded-b-xl\" style={{ maxWidth: '700px', width: '100%' }}>\n-            <div className=\"flex items-center gap-4\">\n-              <button className=\"text-gray-700 text-base font-medium hover:underline hover:text-primary-600 transition\">Copy to</button>\n-              <button className=\"text-gray-700 text-base font-medium hover:underline hover:text-primary-600 transition\">Move to</button>\n-              <button className=\"text-red-500 text-base font-medium hover:underline hover:text-red-700 transition\">Delete</button>\n+            <div className=\"flex items-center gap-4 relative\">\n+              <div className=\"relative\">\n+                <button className=\"text-gray-700 text-base font-medium hover:underline hover:text-primary-600 transition\" onClick={() => setBulkDropdown(bulkDropdown === 'copy' ? null : 'copy')}>Copy to</button>\n+                {bulkDropdown === 'copy' && (\n+                  <div className=\"absolute left-0 mt-2 bg-white border border-gray-300 rounded shadow z-40 min-w-[120px]\">\n+                    {tripDays.map(day => (\n+                      <button key={day.day} className=\"block w-full text-left px-4 py-2 text-gray-700 hover:bg-gray-100\" onClick={() => handleBulkCopyTo(day.day)}>\n+                        Day {day.day}\n+                      </button>\n+                    ))}\n+                  </div>\n+                )}\n+              </div>\n+              <div className=\"relative\">\n+                <button className=\"text-gray-700 text-base font-medium hover:underline hover:text-primary-600 transition\" onClick={() => setBulkDropdown(bulkDropdown === 'move' ? null : 'move')}>Move to</button>\n+                {bulkDropdown === 'move' && (\n+                  <div className=\"absolute left-0 mt-2 bg-white border border-gray-300 rounded shadow z-40 min-w-[120px]\">\n+                    {tripDays.map(day => (\n+                      <button key={day.day} className=\"block w-full text-left px-4 py-2 text-gray-700 hover:bg-gray-100\" onClick={() => handleBulkMoveTo(day.day)}>\n+                        Day {day.day}\n+                      </button>\n+                    ))}\n+                  </div>\n+                )}\n+              </div>\n+              <button className=\"text-red-500 text-base font-medium hover:underline hover:text-red-700 transition\" onClick={handleBulkDelete}>Delete</button>\n             </div>\n             <button className=\"text-gray-400 hover:text-gray-700 text-2xl font-bold px-2\" onClick={() => setSelectedPinIds([])} title=\"Clear selection\">×</button>\n           </div>\n         </div>\n"
                },
                {
                    "date": 1752594197033,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -28,9 +28,9 @@\n import {\n   CSS,\n } from '@dnd-kit/utilities';\n import { reorderDestinations, moveDestinationToDay } from '@/lib/destination-service';\n-import { PhotoIcon, Bars3Icon } from '@heroicons/react/24/outline';\n+import { PhotoIcon, Bars3Icon, ArrowUturnLeftIcon, ArrowUturnRightIcon } from '@heroicons/react/24/outline';\n \n interface ItineraryPanelProps {\n   trip: Trip;\n   tripDays: TripDay[];\n@@ -426,9 +426,41 @@\n   // 1. Add state to track selected pins\n   const [selectedPinIds, setSelectedPinIds] = useState<string[]>([]);\n   // In ItineraryPanel, add state for which dropdown is open\n   const [bulkDropdown, setBulkDropdown] = useState<'copy' | 'move' | null>(null);\n+  // Undo/Redo stacks\n+  const [undoStack, setUndoStack] = useState<Destination[][]>([]);\n+  const [redoStack, setRedoStack] = useState<Destination[][]>([]);\n \n+  // Helper to push current state to undo stack\n+  const pushToUndo = (current: Destination[]) => {\n+    setUndoStack((prev) => [...prev, current.map(d => ({ ...d }))]);\n+    setRedoStack([]); // Clear redo on new action\n+  };\n+\n+  // Wrap onDestinationsChange to support undo\n+  const handleDestinationsChange = (newDestinations: Destination[], pushUndo = true) => {\n+    if (pushUndo) pushToUndo(allDestinations);\n+    onDestinationsChange(newDestinations);\n+  };\n+\n+  // Undo handler\n+  const handleUndo = () => {\n+    if (undoStack.length === 0) return;\n+    setRedoStack((prev) => [allDestinations.map(d => ({ ...d })), ...prev]);\n+    const prevState = undoStack[undoStack.length - 1];\n+    setUndoStack((prev) => prev.slice(0, -1));\n+    onDestinationsChange(prevState);\n+  };\n+  // Redo handler\n+  const handleRedo = () => {\n+    if (redoStack.length === 0) return;\n+    setUndoStack((prev) => [...prev, allDestinations.map(d => ({ ...d }))]);\n+    const nextState = redoStack[0];\n+    setRedoStack((prev) => prev.slice(1));\n+    onDestinationsChange(nextState);\n+  };\n+\n   const sensors = useSensors(\n     useSensor(PointerSensor, {\n       activationConstraint: {\n         distance: 8,\n@@ -460,39 +492,36 @@\n   };\n \n   // Add logic for Copy to, Move to, and Delete actions\n   const handleBulkCopyTo = (dayNum: number) => {\n-    // Copy selected destinations to the chosen day\n     const toCopy = allDestinations.filter(dest => selectedPinIds.includes(dest.id));\n     const maxOrder = Math.max(0, ...tripDays.find(d => d.day === dayNum)?.destinations.map(d => d.orderIndex) || []);\n     const copied = toCopy.map((dest, i) => ({\n       ...dest,\n       id: `${dest.id}-copy-${Date.now()}-${i}`,\n       day: dayNum,\n       orderIndex: maxOrder + i + 1\n     }));\n-    onDestinationsChange([...allDestinations, ...copied]);\n+    handleDestinationsChange([...allDestinations, ...copied]);\n     setSelectedPinIds([]);\n     setBulkDropdown(null);\n   };\n   const handleBulkMoveTo = (dayNum: number) => {\n-    // Move selected destinations to the chosen day\n     const toMove = allDestinations.filter(dest => selectedPinIds.includes(dest.id));\n     const notMoved = allDestinations.filter(dest => !selectedPinIds.includes(dest.id));\n     const maxOrder = Math.max(0, ...tripDays.find(d => d.day === dayNum)?.destinations.map(d => d.orderIndex) || []);\n     const moved = toMove.map((dest, i) => ({\n       ...dest,\n       day: dayNum,\n       orderIndex: maxOrder + i + 1\n     }));\n-    onDestinationsChange([...notMoved, ...moved]);\n+    handleDestinationsChange([...notMoved, ...moved]);\n     setSelectedPinIds([]);\n     setBulkDropdown(null);\n   };\n   const handleBulkDelete = () => {\n-    // Delete selected destinations\n     const remaining = allDestinations.filter(dest => !selectedPinIds.includes(dest.id));\n-    onDestinationsChange(remaining);\n+    handleDestinationsChange(remaining);\n     setSelectedPinIds([]);\n     setBulkDropdown(null);\n   };\n \n@@ -552,9 +581,9 @@\n \n           // Renumber all destinations in both source and target days\n           const finalDestinations = renumberDestinationsInDays(updatedDestinations, [draggedDestination.day, targetDay]);\n           \n-          onDestinationsChange(finalDestinations);\n+          handleDestinationsChange(finalDestinations);\n         }\n       } else {\n         // Same day or destination-to-destination drop\n         const targetDestination = allDestinations.find(dest => dest.id === over.id);\n@@ -589,9 +618,9 @@\n             const updated = reorderedDestinations.find(rd => rd.id === dest.id);\n             return updated || dest;\n           });\n           \n-          onDestinationsChange(updatedAllDestinations);\n+          handleDestinationsChange(updatedAllDestinations);\n \n           // Save to database\n           const destinationIds = reorderedDestinations.map(dest => dest.id);\n           await reorderDestinations(trip.id, sourceDay, destinationIds);\n@@ -632,9 +661,9 @@\n \n           // Renumber all destinations in both affected days\n           const finalDestinations = renumberDestinationsInDays(updatedDestinations, [sourceDay, targetDay]);\n           \n-          onDestinationsChange(finalDestinations);\n+          handleDestinationsChange(finalDestinations);\n \n           // Reorder target day in database with proper sequential IDs\n           const targetDayDestinations = finalDestinations.filter(dest => dest.day === targetDay);\n           const targetDayIds = targetDayDestinations\n@@ -700,9 +729,31 @@\n     <div className=\"h-full flex flex-col min-h-0 bg-white\">\n       {/* Header */}\n       <div className=\"p-4 border-b border-gray-200 flex items-center\">\n         <h2 className=\"text-lg font-semibold text-gray-900\">Itinerary</h2>\n-        {renderViewToggle()}\n+        <div className=\"flex items-center gap-2 ml-auto\">\n+          <button\n+            className={`p-2 rounded-full hover:bg-gray-100 transition ${undoStack.length === 0 ? 'opacity-50 cursor-not-allowed' : 'text-gray-400'}`}\n+            onClick={handleUndo}\n+            disabled={undoStack.length === 0}\n+            title=\"Undo\"\n+            aria-label=\"Undo\"\n+            type=\"button\"\n+          >\n+            <ArrowUturnLeftIcon className=\"w-5 h-5\" />\n+          </button>\n+          <button\n+            className={`p-2 rounded-full hover:bg-gray-100 transition ${redoStack.length === 0 ? 'opacity-50 cursor-not-allowed' : 'text-gray-400'}`}\n+            onClick={handleRedo}\n+            disabled={redoStack.length === 0}\n+            title=\"Redo\"\n+            aria-label=\"Redo\"\n+            type=\"button\"\n+          >\n+            <ArrowUturnRightIcon className=\"w-5 h-5\" />\n+          </button>\n+          {renderViewToggle()}\n+        </div>\n       </div>\n       {/* In ItineraryPanel, render a gray overlay above the title if selectedPinIds.length > 0 */}\n       {/* Place this just before the header/title */}\n       {selectedPinIds.length > 0 && (\n"
                },
                {
                    "date": 1754150142016,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -27,21 +27,25 @@\n } from '@dnd-kit/sortable';\n import {\n   CSS,\n } from '@dnd-kit/utilities';\n-import { reorderDestinations, moveDestinationToDay } from '@/lib/destination-service';\n+import { reorderDestinations, moveDestinationToDay, updateDestination } from '@/lib/destination-service';\n import { PhotoIcon, Bars3Icon, ArrowUturnLeftIcon, ArrowUturnRightIcon } from '@heroicons/react/24/outline';\n+import UngroupedDestinations from './UngroupedDestinations';\n \n interface ItineraryPanelProps {\n   trip: Trip;\n-  tripDays: TripDay[];\n-  selectedDay: number;\n-  selectedDestination: Destination | null;\n-  onDaySelect: (day: number) => void;\n-  onDestinationSelect: (destination: Destination) => void;\n+  destinations: Destination[];\n   onDestinationsChange: (destinations: Destination[]) => void;\n-  onLocationSelect: (destination: Destination) => void;\n-  onDestinationDelete: (destinationId: string) => void;\n+  readOnly?: boolean;\n+  // Legacy props for backward compatibility\n+  tripDays?: TripDay[];\n+  selectedDay?: number;\n+  selectedDestination?: Destination | null;\n+  onDaySelect?: (day: number) => void;\n+  onDestinationSelect?: (destination: Destination) => void;\n+  onLocationSelect?: (destination: Destination) => void;\n+  onDestinationDelete?: (destinationId: string) => void;\n }\n \n // Droppable day container component\n function DroppableDay({ \n@@ -408,14 +412,17 @@\n }\n \n const ItineraryPanel = forwardRef(function ItineraryPanel({\n   trip,\n+  destinations,\n+  onDestinationsChange,\n+  readOnly = false,\n+  // Legacy props for backward compatibility\n   tripDays,\n   selectedDay,\n   selectedDestination,\n   onDaySelect,\n   onDestinationSelect,\n-  onDestinationsChange,\n   onLocationSelect,\n   onDestinationDelete,\n }: ItineraryPanelProps, ref) {\n   const [expandedDays, setExpandedDays] = useState<Set<number>>(new Set([1]));\n@@ -478,9 +485,9 @@\n     } else {\n       newExpanded.add(day);\n     }\n     setExpandedDays(newExpanded);\n-    onDaySelect(day);\n+    onDaySelect?.(day);\n   };\n \n   // 2. Add a checkbox to the left of each pin in both SortableDestination and SortableDestinationPicture\n   // 3. Checkbox is checked if the pin's id is in selectedPinIds\n@@ -493,9 +500,9 @@\n \n   // Add logic for Copy to, Move to, and Delete actions\n   const handleBulkCopyTo = (dayNum: number) => {\n     const toCopy = allDestinations.filter(dest => selectedPinIds.includes(dest.id));\n-    const maxOrder = Math.max(0, ...tripDays.find(d => d.day === dayNum)?.destinations.map(d => d.orderIndex) || []);\n+    const maxOrder = Math.max(0, ...(tripDays?.find(d => d.day === dayNum)?.destinations.map(d => d.orderIndex) || []));\n     const copied = toCopy.map((dest, i) => ({\n       ...dest,\n       id: `${dest.id}-copy-${Date.now()}-${i}`,\n       day: dayNum,\n@@ -507,9 +514,9 @@\n   };\n   const handleBulkMoveTo = (dayNum: number) => {\n     const toMove = allDestinations.filter(dest => selectedPinIds.includes(dest.id));\n     const notMoved = allDestinations.filter(dest => !selectedPinIds.includes(dest.id));\n-    const maxOrder = Math.max(0, ...tripDays.find(d => d.day === dayNum)?.destinations.map(d => d.orderIndex) || []);\n+    const maxOrder = Math.max(0, ...(tripDays?.find(d => d.day === dayNum)?.destinations.map(d => d.orderIndex) || []));\n     const moved = toMove.map((dest, i) => ({\n       ...dest,\n       day: dayNum,\n       orderIndex: maxOrder + i + 1\n@@ -524,11 +531,69 @@\n     setSelectedPinIds([]);\n     setBulkDropdown(null);\n   };\n \n-  // Get all destinations for sortable context\n-  const allDestinations = tripDays.flatMap(day => day.destinations);\n+  // Get all destinations for sortable context (support both new and legacy interfaces)\n+  const allDestinations = destinations || (tripDays ? tripDays.flatMap(day => day.destinations) : []);\n+  \n+  // Separate ungrouped destinations (day = 0) from grouped ones\n+  const ungroupedDestinations = allDestinations.filter(dest => dest.day === 0);\n+  const groupedDestinations = allDestinations.filter(dest => dest.day > 0);\n \n+  // Handler to convert ungrouped destination to timed destination\n+  const handleAddTimeToDestination = async (destination: Destination) => {\n+    // For now, move to day 1 and add basic times - in the future, show a modal to select day and times\n+    const targetDay = 1;\n+    const targetDayData = tripDays?.find(d => d.day === targetDay);\n+    const newOrderIndex = (targetDayData?.destinations.length || 0) + 1;\n+    \n+    try {\n+      // Update the destination with day, order, and default times\n+      const updatedDestination = {\n+        ...destination,\n+        day: targetDay,\n+        orderIndex: newOrderIndex,\n+        startTime: '09:00', // Default start time\n+        endTime: '10:00'    // Default end time\n+      };\n+\n+      // Update in database\n+      await updateDestination(destination.id, {\n+        day: targetDay,\n+        orderIndex: newOrderIndex,\n+        startTime: '09:00',\n+        endTime: '10:00'\n+      });\n+\n+      // Update local state\n+      const updatedDestinations = allDestinations.map(dest => \n+        dest.id === destination.id ? updatedDestination : dest\n+      );\n+      \n+      handleDestinationsChange(updatedDestinations);\n+    } catch (error) {\n+      console.error('Error converting ungrouped destination:', error);\n+    }\n+  };\n+\n+  // Handler to reorder ungrouped destinations\n+  const handleReorderUngroupedDestinations = async (newDestinations: Destination[]) => {\n+    const updatedAllDestinations = allDestinations.map(dest => {\n+      const updated = newDestinations.find(newDest => newDest.id === dest.id);\n+      return updated || dest;\n+    });\n+    \n+    handleDestinationsChange(updatedAllDestinations);\n+    \n+    // Update in database\n+    try {\n+      const destinationIds = newDestinations.map(dest => dest.id);\n+      await reorderDestinations(trip.id, 0, destinationIds); // Use day 0 for ungrouped\n+    } catch (error) {\n+      console.error('Error reordering ungrouped destinations:', error);\n+    }\n+  };\n+\n   const handleDragStart = (event: any) => {\n     setActiveId(event.active.id);\n   };\n \n@@ -557,9 +622,9 @@\n       \n       if (isDroppedOnDay) {\n         // Cross-day drop - move to end of target day\n         const targetDay = parseInt(over.id.toString().replace('day-', ''));\n-        const targetDayData = tripDays.find(d => d.day === targetDay);\n+        const targetDayData = tripDays?.find(d => d.day === targetDay);\n         \n         if (targetDayData && targetDay !== draggedDestination.day) {\n           // Calculate proper sequential order index\n           const newOrderIndex = targetDayData.destinations.length + 1;\n@@ -593,9 +658,9 @@\n         const targetDay = targetDestination.day;\n \n         if (sourceDay === targetDay) {\n           // Same day reordering\n-          const dayData = tripDays.find(d => d.day === sourceDay);\n+          const dayData = tripDays?.find(d => d.day === sourceDay);\n           if (!dayData) return;\n \n           const oldIndex = dayData.destinations.findIndex(dest => dest.id === active.id);\n           const newIndex = dayData.destinations.findIndex(dest => dest.id === over.id);\n@@ -625,9 +690,9 @@\n           const destinationIds = reorderedDestinations.map(dest => dest.id);\n           await reorderDestinations(trip.id, sourceDay, destinationIds);\n         } else {\n           // Cross-day drop next to specific destination\n-          const targetDayData = tripDays.find(d => d.day === targetDay);\n+          const targetDayData = tripDays?.find(d => d.day === targetDay);\n           if (!targetDayData) return;\n \n           const targetIndex = targetDayData.destinations.findIndex(dest => dest.id === over.id);\n           \n@@ -763,9 +828,9 @@\n               <div className=\"relative\">\n                 <button className=\"text-gray-700 text-base font-medium hover:underline hover:text-primary-600 transition\" onClick={() => setBulkDropdown(bulkDropdown === 'copy' ? null : 'copy')}>Copy to</button>\n                 {bulkDropdown === 'copy' && (\n                   <div className=\"absolute left-0 mt-2 bg-white border border-gray-300 rounded shadow z-40 min-w-[120px]\">\n-                    {tripDays.map(day => (\n+                    {tripDays?.map(day => (\n                       <button key={day.day} className=\"block w-full text-left px-4 py-2 text-gray-700 hover:bg-gray-100\" onClick={() => handleBulkCopyTo(day.day)}>\n                         Day {day.day}\n                       </button>\n                     ))}\n@@ -775,9 +840,9 @@\n               <div className=\"relative\">\n                 <button className=\"text-gray-700 text-base font-medium hover:underline hover:text-primary-600 transition\" onClick={() => setBulkDropdown(bulkDropdown === 'move' ? null : 'move')}>Move to</button>\n                 {bulkDropdown === 'move' && (\n                   <div className=\"absolute left-0 mt-2 bg-white border border-gray-300 rounded shadow z-40 min-w-[120px]\">\n-                    {tripDays.map(day => (\n+                    {tripDays?.map(day => (\n                       <button key={day.day} className=\"block w-full text-left px-4 py-2 text-gray-700 hover:bg-gray-100\" onClick={() => handleBulkMoveTo(day.day)}>\n                         Day {day.day}\n                       </button>\n                     ))}\n@@ -791,9 +856,46 @@\n         </div>\n       )}\n       {/* Days and Destinations */}\n       <div ref={scrollRef} className=\"flex-1 overflow-y-auto hide-native-scrollbar\">\n-        {tripDays.map((day) => (\n+        {/* Quick Add Location - Always visible for ungrouped destinations */}\n+        {!readOnly && (\n+          <div className=\"border-b border-gray-200 p-4 bg-white\">\n+            <LocationSearch\n+              onLocationSelect={(destination) => {\n+                // Add as ungrouped destination\n+                const ungroupedDestination = {\n+                  ...destination,\n+                  day: 0,\n+                  orderIndex: ungroupedDestinations.length + 1,\n+                };\n+                onLocationSelect?.(ungroupedDestination);\n+              }}\n+              selectedDay={0}\n+              tripId={trip.id}\n+              placeholder=\"Add a place to your trip (will be ungrouped initially)...\"\n+              className=\"w-full\"\n+              allowUngrouped={true}\n+            />\n+          </div>\n+        )}\n+\n+        {/* Ungrouped Destinations Section */}\n+        {ungroupedDestinations.length > 0 && (\n+          <UngroupedDestinations\n+            destinations={ungroupedDestinations}\n+            onDestinationSelect={onDestinationSelect}\n+            onDestinationDelete={onDestinationDelete}\n+            onAddTimeToDestination={handleAddTimeToDestination}\n+            onReorderDestinations={handleReorderUngroupedDestinations}\n+            selectedPinIds={selectedPinIds}\n+            handleCheckboxChange={handleCheckboxChange}\n+            viewMode={viewMode}\n+            readOnly={readOnly}\n+          />\n+        )}\n+\n+        {tripDays?.map((day) => (\n           <div key={day.day} className=\"border-b border-gray-100\">\n             {/* Day Header */}\n             <button\n               onClick={() => toggleDay(day.day)}\n@@ -863,22 +965,22 @@\n                           {viewMode === 'compact' ? (\n                             <SortableDestination\n                               destination={destination}\n                               dayColor={day.color}\n-                              selectedDestination={selectedDestination}\n-                              onDestinationSelect={onDestinationSelect}\n-                              onDestinationDelete={onDestinationDelete}\n+                              selectedDestination={selectedDestination || null}\n+                              onDestinationSelect={onDestinationSelect || (() => {})}\n+                              onDestinationDelete={onDestinationDelete || (() => {})}\n                               isLastItem={idx === day.destinations.length - 1}\n                               selectedPinIds={selectedPinIds}\n                               handleCheckboxChange={handleCheckboxChange}\n                             />\n                           ) : (\n                             <SortableDestinationPicture\n                               destination={destination}\n                               dayColor={day.color}\n-                              selectedDestination={selectedDestination}\n-                              onDestinationSelect={onDestinationSelect}\n-                              onDestinationDelete={onDestinationDelete}\n+                              selectedDestination={selectedDestination || null}\n+                              onDestinationSelect={onDestinationSelect || (() => {})}\n+                              onDestinationDelete={onDestinationDelete || (() => {})}\n                               isLastItem={idx === day.destinations.length - 1}\n                               selectedPinIds={selectedPinIds}\n                               handleCheckboxChange={handleCheckboxChange}\n                             />\n@@ -904,10 +1006,10 @@\n                         ...destination,\n                         day: day.day,\n                         orderIndex: day.destinations.length + 1,\n                       };\n-                      onLocationSelect(updatedDestination);\n-                      onDaySelect(day.day);\n+                      onLocationSelect?.(updatedDestination);\n+                      onDaySelect?.(day.day);\n                     }}\n                     selectedDay={day.day}\n                     tripId={trip.id}\n                     placeholder={`Search places for Day ${day.day}...`}\n@@ -919,12 +1021,12 @@\n                 \n                 {/* Smart Recommendations for this day */}\n                 <SmartRecommendations\n                   trip={trip}\n-                  tripDays={tripDays}\n+                  tripDays={tripDays || []}\n                   selectedDay={day.day}\n-                  onDestinationAdd={onLocationSelect}\n-                  existingDestinations={tripDays.flatMap(d => d.destinations)}\n+                  onDestinationAdd={onLocationSelect || (() => {})}\n+                  existingDestinations={tripDays?.flatMap(d => d.destinations) || []}\n                 />\n               </div>\n             )}\n           </div>\n"
                },
                {
                    "date": 1754150454427,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1024,9 +1024,9 @@\n                   trip={trip}\n                   tripDays={tripDays || []}\n                   selectedDay={day.day}\n                   onDestinationAdd={onLocationSelect || (() => {})}\n-                  existingDestinations={tripDays?.flatMap(d => d.destinations) || []}\n+                  existingDestinations={day.destinations}\n                 />\n               </div>\n             )}\n           </div>\n"
                }
            ],
            "date": 1752433683232,
            "name": "Commit-0",
            "content": "'use client';\r\n\r\nimport { useState } from 'react';\r\nimport { Trip, Destination, TripDay } from '@/types';\r\nimport { format, parseISO } from 'date-fns';\r\n\r\ninterface ItineraryPanelProps {\r\n  trip: Trip;\r\n  tripDays: TripDay[];\r\n  selectedDay: number;\r\n  selectedDestination: Destination | null;\r\n  onDaySelect: (day: number) => void;\r\n  onDestinationSelect: (destination: Destination) => void;\r\n  onDestinationsChange: (destinations: Destination[]) => void;\r\n}\r\n\r\nexport default function ItineraryPanel({\r\n  trip,\r\n  tripDays,\r\n  selectedDay,\r\n  selectedDestination,\r\n  onDaySelect,\r\n  onDestinationSelect,\r\n  onDestinationsChange,\r\n}: ItineraryPanelProps) {\r\n  const [expandedDays, setExpandedDays] = useState<Set<number>>(new Set([1]));\r\n\r\n  const toggleDay = (day: number) => {\r\n    const newExpanded = new Set(expandedDays);\r\n    if (newExpanded.has(day)) {\r\n      newExpanded.delete(day);\r\n    } else {\r\n      newExpanded.add(day);\r\n    }\r\n    setExpandedDays(newExpanded);\r\n    onDaySelect(day);\r\n  };\r\n\r\n  const formatTime = (time: string) => {\r\n    if (!time) return '';\r\n    try {\r\n      const [hours, minutes] = time.split(':');\r\n      const date = new Date();\r\n      date.setHours(parseInt(hours), parseInt(minutes));\r\n      return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });\r\n    } catch {\r\n      return time;\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"h-full flex flex-col\">\r\n      {/* Header */}\r\n      <div className=\"p-4 border-b border-gray-200\">\r\n        <h2 className=\"text-lg font-semibold text-gray-900\">Itinerary</h2>\r\n        <p className=\"text-sm text-gray-600\">\r\n          {tripDays.length} days • {tripDays.reduce((acc, day) => acc + day.destinations.length, 0)} destinations\r\n        </p>\r\n      </div>\r\n\r\n      {/* Days List */}\r\n      <div className=\"flex-1 overflow-y-auto\">\r\n        {tripDays.map((day) => (\r\n          <div key={day.day} className=\"border-b border-gray-100 last:border-b-0\">\r\n            {/* Day Header */}\r\n            <button\r\n              onClick={() => toggleDay(day.day)}\r\n              className={`w-full p-4 text-left hover:bg-gray-50 transition-colors ${\r\n                selectedDay === day.day ? 'bg-blue-50' : ''\r\n              }`}\r\n            >\r\n              <div className=\"flex items-center justify-between\">\r\n                <div className=\"flex items-center space-x-3\">\r\n                  <div \r\n                    className={`w-6 h-6 rounded-full flex items-center justify-center text-white text-sm font-medium`}\r\n                    style={{ backgroundColor: day.color.pin }}\r\n                  >\r\n                    {day.day}\r\n                  </div>\r\n                  <div>\r\n                    <h3 className=\"font-medium text-gray-900\">\r\n                      Day {day.day}\r\n                    </h3>\r\n                    <p className=\"text-sm text-gray-600\">\r\n                      {format(parseISO(day.date), 'MMM d, yyyy')}\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n                <div className=\"flex items-center space-x-2\">\r\n                  <span className=\"text-sm text-gray-500\">\r\n                    {day.destinations.length} stops\r\n                  </span>\r\n                  <svg \r\n                    className={`w-4 h-4 text-gray-400 transition-transform ${\r\n                      expandedDays.has(day.day) ? 'rotate-180' : ''\r\n                    }`}\r\n                    fill=\"none\" \r\n                    stroke=\"currentColor\" \r\n                    viewBox=\"0 0 24 24\"\r\n                  >\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\r\n                  </svg>\r\n                </div>\r\n              </div>\r\n            </button>\r\n\r\n            {/* Destinations List */}\r\n            {expandedDays.has(day.day) && (\r\n              <div className=\"bg-gray-50\">\r\n                {day.destinations.length === 0 ? (\r\n                  <div className=\"p-4 text-center text-gray-500\">\r\n                    <svg className=\"w-12 h-12 mx-auto mb-2 text-gray-300\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z\" />\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 11a3 3 0 11-6 0 3 3 0 016 0z\" />\r\n                    </svg>\r\n                    <p className=\"text-sm\">No destinations added yet</p>\r\n                    <p className=\"text-xs text-gray-400 mt-1\">Click on the map to add destinations</p>\r\n                  </div>\r\n                ) : (\r\n                  <div className=\"space-y-0\">\r\n                    {day.destinations.map((destination, index) => (\r\n                      <div key={destination.id || index}>\r\n                        <button\r\n                          onClick={() => onDestinationSelect(destination)}\r\n                          className={`w-full p-4 text-left hover:bg-gray-100 transition-colors ${\r\n                            selectedDestination?.id === destination.id ? 'bg-blue-100' : ''\r\n                          }`}\r\n                        >\r\n                          <div className=\"flex items-start space-x-3\">\r\n                            <div \r\n                              className=\"w-6 h-6 rounded-full flex items-center justify-center text-white text-xs font-medium flex-shrink-0 mt-0.5\"\r\n                              style={{ backgroundColor: day.color.pin }}\r\n                            >\r\n                              {destination.orderIndex}\r\n                            </div>\r\n                            <div className=\"flex-1 min-w-0\">\r\n                              <div className=\"flex items-center justify-between\">\r\n                                <h4 className=\"font-medium text-gray-900 truncate\">\r\n                                  {destination.locationName}\r\n                                </h4>\r\n                                {destination.startTime && (\r\n                                  <span className=\"text-sm text-gray-500 flex-shrink-0 ml-2\">\r\n                                    {formatTime(destination.startTime)}\r\n                                  </span>\r\n                                )}\r\n                              </div>\r\n                              <p className=\"text-sm text-gray-600 truncate\">\r\n                                {destination.address}\r\n                              </p>\r\n                              {destination.notes && (\r\n                                <p className=\"text-sm text-gray-500 mt-1 line-clamp-2\">\r\n                                  {destination.notes}\r\n                                </p>\r\n                              )}\r\n                              <div className=\"flex items-center space-x-4 mt-2\">\r\n                                {destination.category && (\r\n                                  <span className=\"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-700\">\r\n                                    {destination.category}\r\n                                  </span>\r\n                                )}\r\n                                {destination.rating && (\r\n                                  <div className=\"flex items-center space-x-1\">\r\n                                    <svg className=\"w-4 h-4 text-yellow-400\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                                      <path d=\"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z\" />\r\n                                    </svg>\r\n                                    <span className=\"text-sm text-gray-600\">{destination.rating}</span>\r\n                                  </div>\r\n                                )}\r\n                              </div>\r\n                            </div>\r\n                          </div>\r\n                        </button>\r\n                        \r\n                        {/* Connector line */}\r\n                        {index < day.destinations.length - 1 && (\r\n                          <div className=\"flex justify-start ml-7\">\r\n                            <div className=\"w-0.5 h-4 bg-gray-300\"></div>\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                )}\r\n                \r\n                {/* Add Destination Button */}\r\n                <div className=\"p-4 border-t border-gray-200\">\r\n                  <button\r\n                    onClick={() => onDaySelect(day.day)}\r\n                    className=\"w-full flex items-center justify-center space-x-2 p-3 border-2 border-dashed border-gray-300 rounded-lg hover:border-gray-400 hover:bg-gray-50 transition-colors\"\r\n                  >\r\n                    <svg className=\"w-5 h-5 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 6v6m0 0v6m0-6h6m-6 0H6\" />\r\n                    </svg>\r\n                    <span className=\"text-sm text-gray-600\">Add destination</span>\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n        ))}\r\n      </div>\r\n\r\n      {/* Footer */}\r\n      <div className=\"p-4 border-t border-gray-200\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <div className=\"flex items-center space-x-2\">\r\n            <svg className=\"w-4 h-4 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n            </svg>\r\n            <span className=\"text-xs text-gray-500\">Click on the map to add destinations</span>\r\n          </div>\r\n          <button className=\"text-xs text-primary-600 hover:text-primary-700\">\r\n            Export\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n} "
        }
    ]
}